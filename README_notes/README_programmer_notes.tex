\documentclass[12pt, twoside]{article}
% Make it possible to conditionally depend on the TeX engine used
\RequirePackage{ifluatex}
\RequirePackage{comment}

%\RequirePackage{silence}
%\WarningFilter{latexfont}{Font shape `U/stmry/m/n' in size <5.5> not available}
%\WarningFilter{latexfont}{Font shape}

\newif\ifinswedish
\inswedishfalse

\RequirePackage{etoolbox}

% The following toggles are needed because of kth/kthcolors.tex and lib/includes.tex
\newif\ifnomenclature
\nomenclaturefalse

\newif\ifdigitaloutput
\digitaloutputfalse

\makeatletter
%% Define a pair of commands to disable and reenable specific packages - see https://tex.stackexchange.com/questions/39415/unload-a-latex-package
\makeatletter
\newcommand{\disablepackage}[2]{%
  \disable@package@load{#1}{#2}%
}
\newcommand{\reenablepackage}[1]{%
  \reenable@package@load{#1}%
}
\makeatother

%% To avoid the warning: "Package transparent Warning: Loading aborted, because pdfTeX is not running in PDF mode."
\disablepackage{transparent}{}

% include a variety of packages that are useful
\input{lib/includes}
\RequirePackage{fancyhdr} % Take control of headers and footers

\begin{comment}
\ifinswedish
    \usepackage[english, main=swedish, bidi=basic]{babel}
\else
    \usepackage[swedish, main=english, provide+=*, bidi=basic]{babel}
\fi
\end{comment}
\ifinswedish
    \usepackage[main=swedish]{babel}
\else
    \usepackage[main=english, provide+=*]{babel}
\fi

% Set up to use biblatex
\newif\ifbiblatex
\biblatextrue

\usepackage[style=ieee,citestyle=numeric-comp, maxbibnames=99, giveninits=false]{biblatex}

% Use the chapter* style for the heading of the bibliography
\defbibheading{bibliography}[\bibname]{%
\section*{#1}%   skip \centering 
}
  
    \addbibresource{references.bib}    
\input{kth/kthcolors}



\input{lib/defines}  % load some additional definitions to make writing more consistent

\usepackage[plainpages=false, unicode=true]{hyperref}

\usepackage[acronym, style=super, toc=false, nonumberlist, nomain, nopostdot=true, notranslate]{glossaries-extra}
%% In overleaf, if this file is in a folder and not the root
%% using \makeglossaries will not work, as the Overleaf latexmk
%% will not run the program to take the output.acn file and make the output.acr file
%\makeglossaries
% However, you can get TeX to do the work with the following:
\makenoidxglossaries
% For details of the Overleaf make process, see https://www.overleaf.com/learn/how-to/How_does_Overleaf_compile_my_project%3F
%% Potentially, one could set up a latexmkrc file in the folder

\input{lib/acronyms}                %load the acronyms file

% Include Glossary ---
% Align the text expansion of the glossary entries
\newglossarystyle{mylong}{%
  \setglossarystyle{long}%
  \renewenvironment{theglossary}%
     {\begin{longtable}[l]{@{}p{\dimexpr 2cm-\tabcolsep}p{0.8\hsize}}}% <-- change the value here
     {\end{longtable}}%
 }
 
% define a left-aligned table cell that is ragged right
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

\usepackage{cleveref}           %% Replace Section with a symbol
\usepackage{metalogo}   % for \LuaLaTeX logo

%% Conventions for todo notes:
% Informational
%% \generalExpl{Comments/directions/... in English}
\newcommand*{\generalExpl}[1]{\todo[inline]{#1}}                

% Language-specific information (currently in English or Swedish)
\newcommand*{\engExpl}[1]{\todo[inline, backgroundcolor=kth-lightgreen40]{#1}} %% \engExpl{English descriptions about formatting}
\newcommand*{\sweExpl}[1]{\todo[inline, backgroundcolor=kth-lightblue40]{\foreignlanguage{swedish}{#1}}}  %% % \sweExpl{Text på svenska}

% warnings
\newcommand*{\warningExpl}[1]{\todo[inline, backgroundcolor=kth-lightred40]{#1}} %% \warningExpl{warnings}


  \RequirePackage{fontspec}
  \defaultfontfeatures{Ligatures={TeX}} % This enables TeX style ligatures such as ---, '', ``, and so on




    \babelfont{rm}{TeX Gyre Termes}
    \DeclareFontShape{TU}{TeXGyreTermes(0)}{md}{n}{<->sub * TeXGyreTermes(0)/m/n}{}
    \DeclareFontShape{TU}{TeXGyreTermes(0)}{sb}{n}{<->ssub * TeXGyreTermes(0)/b/n}{}
    \DeclareFontShape{TU}{TeXGyreTermes(0)}{sb}{it}{<->ssub * TeXGyreTermes(0)/b/it}{}
  
    %\setsansfont{TeX Gyre Heros}   %% Helvetica like font
    \babelfont{sf}{TeX Gyre Heros}
    %\setmonofont[Ligatures={NoCommon}, Numbers={Lining,Monospaced}]{TeX Gyre Cursor}  %% Courier like font
    \babelfont{tt}{TeX Gyre Cursor}
 \begin{comment}
    \babelfont[english]{rm}{TeX Gyre Termes}
    \babelfont[english]{sf}{TeX Gyre Heros}
    \babelfont[english]{tt}{TeX Gyre Cursor}
\end{comment}

 %  \setmathfont{TeX Gyre Termes Math} %% a math font
    \usepackage{mathtools}
 \usepackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
  % The [version=bold, FakeBold=1.2] is to avoid a warning about the lack of a bold font
  %\setmathfont{TeX Gyre Pagella Math}[version=bold, FakeBold=1.2] %% a font for math
  \setmathfont{STIX Two Math}[version=normal]
  %\setmathfont{TeX Gyre Pagella Math}[version=normal]
  %\setmathfont{TeX Gyre Pagella Math}[version=bold, BoldFeatures={FakeBold=1.5}]
  % For both XeLaTeX and LuaLatex for getting access to unicode symbols
  %\newfontfamily\myfont[CharacterVariant=1]{NewCM10-Regular.otf}
  % STIX Project (Scientific and Technical Information Exchange)
  % STIX Two Math does not have bold face - so we fake it
  %\newfontfamily\mystixmathfont[BoldFeatures={FakeBold=1.5}, BoldItalicFeatures={FakeBold=1.5}]{STIX Two Math}
  \newfontfamily\mystixmathfont{STIX Two Math}
  % STIX Two Math does not have a bold font, but it has bold symbols with an without serifs - but you manually have to use them, unless you are in math mode - then you can use \symbf{}
  % and this will return the bold serif version of the character
  \DeclareFontShape{TU}{STIXTwoMath(0)}{b}{n}{<->ssub * STIXTwoMath(0)/m/n}{}
  \DeclareFontShape{TU}{STIXTwoMath(0)}{sb}{n}{<->ssub * STIXTwoMath(0)/m/n}{}
  \newfontfamily\mystixtextfont{STIX Two Text}
  
    % To access the Stylistic Set 1 <ss01> such as ℋ
    \newfontfamily\mystixmathfontSSa{STIX Two Math}[StylisticSet=1]

    % use english as a fallback when in other languages
    \babelprovide[import, onchar=ids fonts]{english}

    
  % for new KTH cover
  % Load the Figtree font as it is used for the new KTH graphical profile
  % 

    \newfontfamily{\FigtreeFont}[Ligatures=TeX,
        Path=./Figtree/static/,
        Extension = .ttf,
        UprightFont=*-Regular,
        BoldFont=*-Bold,
        BoldItalicFont=*-BoldItalic,
        ItalicFont=*-Italic,
        %FontFace={l}{n}{*-Light},
        %FontFace={l}{it}{*-LightItalic},
        FontFace={md}{n}{*-Medium},
        FontFace={md}{it}{*-MediumItalic},
        FontFace={sb}{n}{*-Semibold},
        FontFace={sb}{it}{*-SemiBoldItalic},
        %FontFace={k}{n}{*-Black},
        %FontFace={k}{it}{*-BlackItalic},
        %FontFace={eb}{n}{Font=*-ExtraBold},
        %FontFace={eb}{it}{Font=*-ExtraBoldItalic}
        ]{Figtree}


\newfontfamily\pageNumberFont{Figtree} %% set the font to use for page numbering

\newfontfamily{\NotoEmojiFont}[Ligatures=TeX,
    Path=./Noto_Emoji/static/,
    Extension = .ttf,
    UprightFont=*-Regular,
    BoldFont=*-Bold,
    FontFace={l}{n}{*-Light.ttf},
    FontFace={md}{n}{*-Medium},
    FontFace={sb}{n}{*-SemiBold},
    ]{NotoEmoji}

\begin{comment}
   % To set the abstract headings in Figtree, we redefine the abstract environment to look at the language being used and use the appropriate font, with the default being Figtree
   % The languages that are automatically introduced by Polyglossia or Babel have a name of the form xxxfont and xxxfontsf; where xxxfont is the serif font and xxxfontsf is the sans serif font.
   % This means that for each language that Figtree does not support, you have to define the sans serif and serif font to use.

      \babelprovide[import, onchar=ids fonts]{greek}
      \babelprovide[import, onchar=ids fonts]{russian}
      \babelprovide[import, onchar=ids fonts]{vietnamese}
      \babelfont[greek, russian, vietnamese]{rm}{Noto Serif}
      \babelfont[greek, russian, vietnamese]{sf}{Noto Sans}
      \babelfont[greek, russian, vietnamese]{tt}{Noto Mono}

  
    \babelprovide[import, onchar=ids fonts]{hindi}
    \babelfont[hindi]{rm}{Noto Serif Devanagari}
    \babelfont[hindi]{sf}{Noto Sans Devanagari}
    \babelfont[hindi]{tt}{Noto Sans Devanagari} % Noto Mono does not have the glyphs

    %\babelprovide[import, onchar=ids fonts]{russian}
    %\babelfont[russian]{rm}{Noto Serif}
    %\babelfont[russian]{sf}{Noto Sans}
    %\babelfont[russian]{tt}{Noto Mono}

    \babelprovide[import, onchar=ids fonts]{chinese-simplified}
    \babelfont[chinese-simplified]{rm}{Noto Serif CJK SC}
    \babelfont[chinese-simplified]{sf}{Noto Sans CJK SC}
    \babelfont[chinese-simplified]{tt}{Noto Sans Mono CJK SC}
    
    \babelfont[chinese-traditional]{rm}{Noto Serif CJK TC}
    \babelfont[chinese-traditional]{sf}{Noto Sans CJK TC}
    \babelfont[chinese-traditional]{tt}{Noto Sans Mono CJK TC}
  
    \babelprovide[import, onchar=ids fonts]{japanese}
    \babelfont[japanese]{rm}{Noto Serif CJK JP}
    \babelfont[japanese]{sf}{Noto Sans CJK JP}
    \babelfont[japanese]{tt}{Noto Sans Mono CJK JP}
  
  % If you are going to use Arabic

    \babelprovide[import, onchar=ids fonts]{arabic}
    \babelprovide[import, onchar=ids fonts]{centralkurdish}
    \babelfont[arabic, centralkurdish]{rm}{Noto Naskh Arabic}
    \babelfont[arabic, centralkurdish]{sf}{Noto Sans Arabic}
    \babelfont[arabic, centralkurdish]{tt}{Noto Sans Arabic}
    % If one really needs a monospaced font, one might try Kawkab Mono
    % However, it seems that it is a work in progress - see https://makkuk.com/kawkab-mono/ and https://github.com/aiaf/kawkab-mono/tree/master

    %\babelprovide[import, onchar=ids fonts]{centralkurdish}
    %\babelfont[centralkurdish]{rm}{Noto Naskh Arabic}
    %\babelfont[centralkurdish]{sf}{Noto Sans Arabic}
    %\babelfont[centralkurdish]{tt}{Noto Sans Arabic}

      
  % If you are going to use Hebrew or Yiddish
\babelprovide[import, onchar=ids fonts]{hebrew}
\babelprovide[import, onchar=ids fonts]{yiddish}
\babelfont[hebrew, yiddish]{rm}{Noto Serif Hebrew}
\babelfont[hebrew, yiddish]{sf}{Noto Sans Hebrew}
\babelfont[hebrew, yiddish]{tt}{Noto Sans Hebrew}


    %\babelprovide[import, onchar=ids fonts]{vietnamese}
    %\babelfont[vietnamese]{rm}{Noto Serif}
    %\babelfont[vietnamese]{sf}{Noto Sans}
    %\babelfont[vietnamese]{tt}{Noto Mono}

\end{comment}
  
    % The Overleaf TeX Live includes these fonts, so there is little you have to do!
    % The list of such fonts is at https://www.overleaf.com/learn/latex/Questions%2FWhich_OTF_or_TTF_fonts_are_supported_via_fontspec%3F
    %
\newfontfamily{\NotoSansJPFont}[Ligatures=TeX,
    ]{Noto Sans Mono CJK JP Regular}

\newfontfamily{\NotoSansFont}[Ligatures=TeX,
Extension = .ttf,
    UprightFont = NotoSans-Regular,
    BoldFont = NotoSans-Bold,
    ItalicFont = NotoSans-Italic,
    BoldItalicFont = NotoSans-BoldItalic
    ]{NotoSansCustomA}
    
\newfontfamily{\NotoSerifFont}[Ligatures=TeX,
Extension = .ttf,
    UprightFont = NotoSerif-Regular,
    BoldFont = NotoSerif-Bold,
    ItalicFont = NotoSerif-Italic,
    BoldItalicFont = NotoSerif-BoldItalic
    ]{NotoSerifCustomA}

\newfontfamily{\DejaVuSansFont}[Ligatures=TeX,
    ]{DejaVu Sans}


% Set up the header and footer for plain style pages
\fancypagestyle{plain}{%
\fancyhf{}% clear all header and footer fields
\fancyfoot[C]{\pageNumberFont\small\selectfont\thepage}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{0pt}%
}
% Set up the header and footer
\fancyhead{}
%\fancyhead[RO]{\sffamily\small\leftmark\thinspace|\thinspace\thepage}
%\fancyhead[LE]{\sffamily\small\thepage\thinspace|\thinspace\leftmark}
% Without conversion to uppercase
% Note that we need to switch to the familydefault for the page numbers
\fancyhead[RO]{{\sffamily\small\nouppercase\leftmark}{\pageNumberFont\small\selectfont \thinspace|\thinspace \thepage}}
\fancyhead[LE]{{\pageNumberFont\small\selectfont\thepage \thinspace|\thinspace}{\sffamily\small\nouppercase\leftmark}}
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}
\renewcommand{\sectionmark}[1]{%
\markboth{#1}{}}


\setlength{\headheight}{15pt}
\addtolength{\topmargin}{-3pt}


\lstdefinestyle{latexExampleForAuthors}{
language=[LaTeX]{TeX},
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    basicstyle=\small\tt,
    keywordstyle=\color{blue}\sf,
    identifierstyle=\color{magenta},
    commentstyle=\color{cyan},
    backgroundcolor=\color{yellow!15},
    extendedchars=true,
    inputencoding=utf8,
    tabsize=2,
    columns=flexible,
    morekeywords={subtitle, alttitle, altsubtitle, hostcompany, courseCycle,
      courseCode, courseCredits, programcode, degreeName, subjectArea, educationSubjectcode,
      nationalsubjectcategories, todo, ifbiblatex, subsection}
}


\lstdefinestyle{latexExample}{
language=[LaTeX]{TeX},
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    basicstyle=\small\tt,
    keywordstyle=\color{blue}\sf,
    identifierstyle=\color{magenta},
    commentstyle=\color{cyan},
    backgroundcolor=\color{yellow!15},
    tabsize=2,
    columns=flexible,
}

%
% The commands below are to configure JSON listings
% 
% format for JSON listings
\colorlet{punct}{red!60!black}
\definecolor{delim}{RGB}{20,105,176}
\definecolor{numb}{RGB}{106, 109, 32}
\definecolor{string}{RGB}{0, 0, 0}

\lstdefinelanguage{json}{
    numbers=none,
    numberstyle=\small,
    frame=none,
    rulecolor=\color{black},
    showspaces=false,
    showtabs=false,
    breaklines=true,
    postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{gray}\hookrightarrow\space}},
    breakatwhitespace=true,
    basicstyle=\ttfamily\small,
    extendedchars=false,
    upquote=true,
    morestring=[b]",
    stringstyle=\color{string},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {\[}{{{\color{delim}{\[}}}}{1}
      {\]}{{{\color{delim}{\]}}}}{1}
      {’}{{\char13}}1,
}

\lstdefinelanguage{XML}
{
  basicstyle=\ttfamily\color{blue}\bfseries\small,
  morestring=[b]",
  morestring=[s]{>}{<},
  morecomment=[s]{<?}{?>},
  stringstyle=\color{black},
  identifierstyle=\color{blue},
  keywordstyle=\color{cyan},
  breaklines=true,
  postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{gray}\hookrightarrow\space}},
  breakatwhitespace=true,
  morekeywords={xmlns,version,type}% list your attributes here
}
\lstset{style=latexExample}
\newcommand{\dname}[1]{\textbf{#1}}
\newcommand{\fname}[1]{\texttt{#1}}

\lstdefinestyle{PDF}{
language=[LaTeX]{TeX},
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    basicstyle=\small\tt,
    keywordstyle=\color{blue}\sf,
    identifierstyle=\color{magenta},
    commentstyle=\color{cyan},
    backgroundcolor=\color{yellow!15},
    extendedchars=true,
    inputencoding=utf8,
    stringstyle=\ttfamily,
    morestring=[b]',
    tabsize=2,
    columns=flexible,
    morekeywords={Type, Action, JavaScript, obj, endobj, Length, Filter, FlateDecode, stream, endstream, JS, ASCIIHexDecode, startxref, xref, trailer, Size, Root, Catalog, OpenAction, AcroForm, Pages, Outlines, S,
    Kids, Count, Page, Parent, MediaBox, Contents, Resources, Font, ProcSet, PDF, Text, F1}
}

% Extend the XML style
\lstdefinestyle{myXML}{
    language=XML,
    columns=flexible,
    breaklines=true,
    showspaces=false,                       % Dont make spaces visible
    showtabs=false,                         % Dont make tabs visible
    breakatwhitespace=true,
    postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}},
    basicstyle=\ttfamily\small,
    columns=fixed,
    escapechar = £,
    postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}},
    morekeywords={dc:format, dc:title, dc:date, dc:type, dc:creator, dc:description, dc:subject, dc:source, dc:language, rdf:Alt, rdf:li, rdf:Bag, rdf:Seq, rdf:Description, rdf:Description, rdf:RDF, pdfaExtension:schemas, pdfaSchema:property, pdfaSchema:valueType, pdf:Producer, pdf:Keywords, pdf:PDFVersion, pdfaSchema:schema, pdfaSchema:prefix, pdfaSchema:namespaceURI, pdfaProperty:name, pdfaProperty:valueType, pdfaProperty:category, pdfaProperty:description,  xmp:CreateDate, xmp:ModifyDate, xmp:MetadataDate, xmp:CreatorTool, xmpMM:DocumentID, xmpMM:InstanceID, xmpMM:VersionID, xmpMM:RenditionClass, Iptc4xmpCore:CreatorContactInfo, Iptc4xmpCore:CiEmailWork, prism:complianceProfile, prism:pageCount, xmpTPg:NPages,  x:xmpmeta},
    %string=[bd]{|}      % Uncommenting this line eliminates the visible spaces in strings
% Support for Swedish, German and Portuguese umlauts
  literate=%
  {Ö}{{\"O}}1
  {Ä}{{\"A}}1
  {Å}{{\AA{}}}1
  {Ü}{{\"U}}1
  {ß}{{\ss}}1
  {ü}{{\"u}}1
  {ö}{{\"o}}1
  {ä}{{\"a}}1
  {å}{{\aa{}}}1
  {á}{{\'a}}1
  {ã}{{\~a}}1
  {é}{{\'e}}1
  {è}{{\`e}}1
  {€}{\euro}1%
  {’}{{\char13}}1
  {-}{{\textendash}}1
  {–}{{\textendash}}1
  {…}{{\ldots}}1,
  %{﻿}{{BOM}{\;}{0xfeff}}{10},
}

\usepackage{luacode}
% --- LUA BACKEND ---
\begin{luacode*}
-- Record start time
compilation_start_time = os.clock()

-- Function for logging an event with a timestamp
function log_event(message)
  local current_time = os.clock()
  local elapsed = current_time - compilation_start_time
  local log_message = string.format("[+%.3fs] %s", elapsed, message)
  tex.sprint("\\wlog{" .. log_message .. "}")
end
\end{luacode*}

% --- LATEX FRONTEND ---
% 1. Log the start time immediately
\directlua{log_wall_clock_time("Compilation started")}

% 2. Use the \AtEndDocument hook to log the end time
\AtEndDocument{%
  \directlua{log_wall_clock_time("Compilation finished")}%
}
% Command for explicit, manual logging
\newcommand{\ReportTimeStamp}[1]{\directlua{log_event("#1")}}

% Use the modern, built-in hook to log a message for each page
\AddToHook{shipout/before}{\ReportTimeStamp{Shipping out page \thepage}}



\title{README and notes about the template for programmers}

\author{Gerald Q. Maguire Jr.}
\date{October 2025}

\begin{document}
\pagenumbering{roman}
\glsresetall[]
\maketitle
\fancypagestyle{empty}{}
\warningExpl{\textbf{This document is a work in progress.}}

This document describes the thesis template that I have developed for use at \gls{KTH} and provides some background on why it is structured in this way. This document provides information for programmers about the template, particularly on how it can be utilized in conjunction with specific programs to facilitate the thesis process for students, faculty, and administrators. The document is primarily intended for readers who are comfortable with programming or who need to maintain or modify the template or the programs I have written.

\warningExpl{{\mystixmathfont ☡} This is a very deep dive that is probably only of interest to a \textit{very} small number of readers.}
\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Enable the following command the first time you compile this in a new session to give all of the time quanta to set up the font cache.
%% If the font cache is not built, you are likely to get a timeout.
%\end{document}

% Include Table of Contents (TOC) ---
\fancypagestyle{plain}{}
\renewcommand{\sectionmark}[1]{ \markboth{#1}{}}
\tableofcontents
\markboth{\contentsname}{}
\cleardoublepage
 
\setcounter{page}{1}
\pagenumbering{arabic}
\section{Introduction}
\label{sec:IntroForProgrammers}

The focus in the first part of this document is on how to use the information in the thesis and captured by the \LaTeX{}  template and stored in the \texttt{fordiva.json file} to do other tasks:
\begin{enumerate}
    \item The announcements and calendar events of thesis presentations or defenses. Moreover, thesis presentations and defenses are supposed to be public, so it would be useful and foster their visibility if it were easy to make such announcements (in both English and Swedish).
    
    \item Both the metadata and the thesis itself need to be entered into \foreignlanguage{swedish}{\gls{DiVA}}\footnote{There is a separate issue regarding whether the full-text is publicly available or not, but this is outside the scope of this document.}.
    
    \item Both English and Swedish titles will be reported along with the decision of the grading committee in \foreignlanguage{swedish}{\gls{LADOK}}.
\end{enumerate}

A high-level overview was given in the \texttt{README\_supervisor\_notes.tex} file. This document covered ``Accuracy and Economics'', ``Make it simple from the start'' by collecting the metadata, 
`Automating later steps in the degree project'',
`Making an announcement'',
`Making a cover and applying it'',
`Can someone else use these programs?'',
`\LaTeX{}~template in Overleaf'', and
`Put information into \LaTeX{}~template to generate a draft or final thesis''.

\Cref{sec:someEhnahncements} discusses some enhancements. Some readers may be interested in accessibility, see \Cref{sec:accessibility}. \Cref{sec:structureOfTheTemplate} discusses the structure of the template and the report. 
\Cref{sec:GeneratingLatexCommands} shows how one can generate \LaTeX{}  commands for use in the student’s thesis source file, specifically for the \texttt{custom\_configuration file.}
\Cref{sec:TheBiGPicture} presents the big picture of how the different data and programs interact.

\Cref{sec:copyrightOrCClicenseExaminer} presents how the copyright or Creative Commons License can be realized on the \texttt{bookinfo} page.
\Cref{sec:acronymsInForDIVAdata} describes how one can add the  \texttt{acronyms.tex} file to the \gls{PDF} both as text and attach it to the \gls{PDF} file.
\Cref{sec:addingMetadataToPDFfile} presents the details of how to add additional metadata to the \gls{PDF} file, such that human readers and other tools can access this data. This is a rather expansive area, as there are those who would like to be able to mechanically extract data about the thesis and extract data from it (\eg citation data).
Finally, \Cref{sec:futurework} suggests some future work, such as how to better exploit unicode, better math support in \gls{DiVA}, and Cora-based \gls{DiVA}.

I hope that this document contains sufficient information to enable someone else to address any remaining problems (that will inevitably occur) and extend it in new ways to better support the whole thesis process and the various readers.

\section{Overall flow with an extension}
The approach taken in the overall work was to make data readily available via the template and collect \& output it in a 
“For DIVA” set of information at the end of the \gls{PDF} document and a \texttt{fordiva.json} file. Additionally, we try to minimize the need to manually enter information by taking information from a Canvas course room (if one is relevant).

The overall flow is shown in \Cref{fig:LogicalOverviewOfWhatIsDone2}. Notice that this figure has been extended to include a JSON\_to\_Cora\_DiVA process that can use the Cora \gls{API} to directly create an entry in the new Cora-based \gls{DiVA}:
\tikzset{
    processBox/.style={rectangle, rounded corners, minimum width=3cm, minimum height=1cm,text centered, font=\sffamily, draw=black, fill=red!20},
    destinationBox/.style={rectangle, rounded corners, minimum width=3cm, minimum height=1cm,text centered, draw=black, fill=green!10},
    arrow/.style={thick,->,>=stealth}
}

\begin{figure}[!ht]
\resizebox{\textwidth}{!}{%
\begin{tikzpicture}
[align=left,node distance=2cm]


\node (latexFile) [tape,tape bend top=none,draw,font=\sffamily] {\LaTeX file};
\node (PDFfile) [tape,tape bend top=none,draw,font=\sffamily, above of=latexFile] {PDF file};
\node (DOCXFile) [tape,tape bend top=none,draw,font=\sffamily, below of=latexFile] {DOCX file};

\node (extractor) [processBox, right=1cm of latexFile] {Extractor};
\node (jsonFile) [tape,tape bend top=none,draw,font=\sffamily, right=0.5cm of extractor] {JSON file};
\node (start) [processBox, right=0.5cm of jsonFile] {JSON\_to\_calendar};

\node (jsontoMODS) [processBox, below of=start] {JSON\_to\_MODS};
\node (modsFile) [tape,tape bend top=none,draw,font=\sffamily, below of=jsontoMODS] {MODS file};
\node (diva) [destinationBox, right=1cm of modsFile] {Import into DiVA};


\node (jsontoCoraDiVA) [processBox, below= 3cm of modsFile] {JSON\_to\_Cora\_DiVA};
\node (DiVAentry) [destinationBox, right=1cm of jsontoCoraDiVA] {DiVA entry};

\node (calendarEvent) [destinationBox, right=1cm of start] {Canvas calendar event};
\node (announcement) [destinationBox,  above of =calendarEvent] {Canvas announcement};
\node (cortinaCalendarEvent) [destinationBox,  right=0.5cm of start, below of=calendarEvent] {KTH Cortina calendar event};
\draw [arrow] (latexFile) --  (extractor.west);
\draw [arrow] (PDFfile) --  (extractor.west);
\draw [arrow] (DOCXFile) --  (extractor.west);
\draw [arrow] (extractor) --  (jsonFile.west);
\draw [arrow] (jsonFile) --  (start.west);
\draw [arrow] (start.east) --  (announcement.west);
\draw [arrow] (start.east) -- (calendarEvent);
\draw [arrow] (start.east) -- (cortinaCalendarEvent.west);
\draw [arrow] (jsonFile) --  (jsontoMODS.west);
\draw [arrow] (jsontoMODS) --  (modsFile);
\draw [arrow] (modsFile) --  (diva);

\draw [arrow] (jsonFile) --  (jsontoCoraDiVA.north);
\draw [arrow] (jsontoCoraDiVA) --  (DiVAentry);
\end{tikzpicture}
}
\caption{From a \gls{PDF} file, a \LaTeX\;project, or \gls{DOCX} file -- generate an announcement, calendar entries, and a \gls{MODS} file for import into \gls{DiVA}}
  \label{fig:LogicalOverviewOfWhatIsDone2}
\end{figure}
\FloatBarrier

\warningExpl{☡  If you are still reading at this point, it is going to get deeper!}

\section{The big picture}
\label{sec:TheBiGPicture}

\Cref{tab:inforAndItsUses} shows the relationship between the information and the scripts that use it. The sections highlighted in yellow are optional. For example, only 1\textsuperscript{st} cycle theses will have a second author. While all theses will have two supervisors, some may have more (the scripts support up to 10).

Individuals can be associated with KTH, in this case, they have a Local User Id and an organization element (with the implicit top level (L0) being KTH). The organization levels of L1 == School and L2 == Department. It is possible to extend this further, but the programs currently only support L1 and L2. The Title and Alternative title fields are used to support the English and Swedish title (or visa versa) -– similarly, the abstracts and keywords must include English and Swedish versionss; with additional support for abstracts and keywords in many languages. Where a school should be specified, one can use \texttt{\textbackslash schoolAcronym\{xxxx\}}.

The Canvas course room’s course\_id is often an argument to my scripts. One reason for this is to be able to use the information in the course room to translate a local user ID (\ie a kthid) to an integration ID (\ie a LADOK user ID) or to be able to look up details of an author or supervisor.

Note that for third-cycle degrees, the degree information is a little different as there are no program codes, but rather education codes. Also there is a \texttt{\textbackslash degreeModifier\{Philosophy\}} macro to enable the user to specify Philosophy as a modifier to the degree name.

\begin{landscape}
\small{
\begin{longtable}{L{2cm}|L{4cm}|l|L{4cm}|L{4cm}|l l l l|}
\caption{Information and how it is used}\label{tab:inforAndItsUses}\\
    &  & & & \textbf{DOCX DocProperty} &  &  &  & \\
    \textbf{Top level} & \textbf{elements} & \textbf{subelements}	& \textbf{\LaTeX~Macro} & \textbf{or fields} & \begin{rotate}{60}\textbf{calendar}\end{rotate} & \begin{rotate}{60}\textbf{cover}\end{rotate} & \begin{rotate}{60} \textbf{LADOK}\end{rotate} & \begin{rotate}{60}\textbf{MODS}\end{rotate}\\
        \endfirsthead
    \multicolumn{9}{c}%
{\tablename\ \thetable\ -- \textit{Continued from previous page}} \\
    &  &	&  & \textbf{DOCX DocProperty} &  &  &  & \\
    \textbf{Top level} & \textbf{elements} & \textbf{subelements}	& \textbf{\LaTeX~Macro} & \textbf{or fields} & \begin{rotate}{60}\textbf{calendar}\end{rotate} & \begin{rotate}{60}\textbf{cover}\end{rotate} & \begin{rotate}{60} \textbf{LADOK}\end{rotate} & \begin{rotate}{60}\textbf{MODS}\end{rotate}\\
\hline
\endhead
      \hline
Author1	\\
&	Last name &	&	\textbackslash authorsLastname\{\} &	Author1\_Last\_name & x &	x &	x &	x\\
&	First name & &	\textbackslash authorsFirstname\{\} &	Author1\_First\_name & x & x & x & x\\
&	Local User Id &	& \textbackslash kthid\{\} &	Author1\_Local User Id &	& 		& x &	x \\
&	E-mail	& &	\textbackslash email\{\} &	Author1\_E-mail	&	& & &		x \\
 & organisation & \\
 &  & L1 & \textbackslash authorsSchool\{\} & Author1\_organization\_L1 &  &  &  & x\\
 &  &  &  & Author1\_organization\_L2 &  &  &  & \\
 & Other organisation &  &  & Author1\_Other\_organisation &  &  &  & \\
       \hline
\rowcolor{yellow}Author2 & \multicolumn{8}{l}{\cellcolor{yellow}}\\
\rowcolor{yellow} & Last name &  & \textbackslash secondAuthorsLastname\{\} & Author2\_Last\_name & x & x & x & x\\
\rowcolor{yellow} & First name &  & \textbackslash secondAuthorsFirstname\{\} & Author2\_First\_name & x & x & x & x\\
\rowcolor{yellow} & Local User Id &  & \textbackslash secondkthid\{\} & Author2\_Local User Id &  &  & x & x\\
\rowcolor{yellow} & E-mail &  & \textbackslash secondemail\{\} & Author2\_E-mail &  &  &  & x\\
\rowcolor{yellow} & organisation & \multicolumn{7}{l}{\cellcolor{yellow}}\\ 
\rowcolor{yellow} &  & L1 & \textbackslash secondAuthorsSchool{ } & Author2\_organization\_L1 &  &  &  & x\\
\rowcolor{yellow} &  &  &  & Author2\_organization\_L2 &  &  &  & \\
\rowcolor{yellow} & Other organisation &  &  & Author2\_Other\_organisation &  &  &  & \\
       \hline
Cycle &  &  & \textbackslash courseCycle\{\} & Cycle & x & x &  & \\
Course code &  &  & \textbackslash courseCode\{\} & Course\_code & i & i &  &  \\
Credits &  &  & \textbackslash courseCredits\{\} & Credits &  &  &  & \\
      \hline
Degree1 & \\
 & Educational program &  & Derived from programcode & Educational program &  & x &  & x \\
 & programcode &  & \textbackslash programcode\{\} & programcode &  & i &  & i \\
 & Degree &  & \textbackslash degreeName\{\} & Degree &  & x &  & x \\
 & subjectArea &  & \textbackslash subjectArea{ } & subjectArea &  & x &  & x \\
\rowcolor{yellow}Degree2 & \multicolumn{8}{l}{\cellcolor{yellow}}\\
\rowcolor{yellow}& Educational program &  & Derived from secondProgramcode & second\_Educational program &  & x &  & x \\
\rowcolor{yellow}& programcode &  & \textbackslash secondProgramcode\{\} & second\_Programcode &  & i &  & i \\
\rowcolor{yellow}& Degree &  & \textbackslash secondDegreeName\{\} & second\_Degree &  & x &  & x \\
\rowcolor{yellow}& subjectArea &  & \textbackslash secondSubjectArea\{\} & second\_subjectArea &  & x &  & x \\
       \hline
Title & \\
 & Main title &  & \textbackslash title\{\} & (exiting document property) & x & x & x & x \\
 & Subtitle &  & \textbackslash subtitle\{\} & Subtitle & x & x & o & x \\
 & Language &  & Derived from option to document class &  & x &  &  & x \\
Alternative title & \\
 & Main title &  & \textbackslash alttitle\{\} & Alternative\_main\_title & x & x & x & x \\
 & Subtitle &  & \textbackslash altsubtitle\{\} & Alternative\_subtitle & x & x & o & x \\
 & Language &  & Derived from option to documentclass &  & x &  &  & x \\
      \hline
Supervisor1 & \\
 & Last name &  & \textbackslash supervisorAsLastname\{\} & Supervisor1\_Last\_name & x &  &  & x \\
 & First name &  & \textbackslash supervisorAsFirstname\{\} & Supervisor1\_First\_name & x &  &  & x \\
 & Local User Id &  & \textbackslash supervisorAsKTHID\{\} & Supervisor1\_Local User Id &  &  &  & x \\
 & E-mail &  & \textbackslash supervisorAsEmail\{\} & Supervisor1\_E-mail &  &  &  & x \\
 & organisation & \\
 &  & L1 & \textbackslash supervisorAsSchool\{\} & Supervisor1\_organization\_L1 &  &  &  & x \\
 &  & L2 & supervisorAsDepartment\{\} & Supervisor1\_organization\_L2 &  &  &  & o \\
 & Other organisation &  & supervisorAsOrganization\{\} & Supervisor1\_Other\_organisation &  &  &  &  \\
\rowcolor{yellow}Supervisor2 &  \multicolumn{8}{l}{\cellcolor{yellow}}\\
\rowcolor{yellow} & Last name &  & \textbackslash supervisorBsLastname{ } & Supervisor2\_Last\_name & x &  &  & x \\
\rowcolor{yellow} & First name &  & \textbackslash supervisorBsFirstname\{\} & Supervisor2\_First\_name & x &  &  & x \\
\rowcolor{yellow} & Local User Id &  & \textbackslash supervisorBsKTHID\{\} & Supervisor2\_Local User Id &  &  &  & x \\
\rowcolor{yellow} & E-mail &  & \textbackslash supervisorBsEmail\{\} & Supervisor2\_E-mail &  &  &  & x \\
\rowcolor{yellow} & organisation & \multicolumn{7}{l}{\cellcolor{yellow}}\\
\rowcolor{yellow} &  & L1 & \textbackslash supervisorBsSchool\{\} & Supervisor2\_organization\_L1 &  &  &  & x \\
\rowcolor{yellow} &  & L2 & \textbackslash supervisorBsDepartment\{\} & Supervisor2\_organization\_L2 &  &  &  & o \\
\rowcolor{yellow} & Other organisation &  & \textbackslash supervisorBsOrganization\{\} & Supervisor2\_Other\_organisation &  &  &  & \\
\rowcolor{yellow}Supervisor3 & \multicolumn{8}{l}{\cellcolor{yellow}} \\
\rowcolor{yellow} & Last name &  & \textbackslash supervisorCsLastname\{\} & Supervisor3\_Last\_name & x &  &  & x \\
\rowcolor{yellow} & First name &  & \textbackslash supervisorCsFirstname\{\} & Supervisor3\_First\_name & x &  &  & x \\
\rowcolor{yellow} & Local User Id &  & \textbackslash supervisorCsKTHID\{\} &  &  &  &  & \\ 
\rowcolor{yellow} & E-mail &  & \textbackslash supervisorCsEmail\{\} & Supervisor3\_E-mail &  &  &  & o \\
\rowcolor{yellow} & organisation & \multicolumn{7}{l}{\cellcolor{yellow}}\\ 
\rowcolor{yellow} &  & L1 & \textbackslash supervisorCsSchool\{\} & Supervisor3\_organization\_L1 &  &  &  & x \\
\rowcolor{yellow} &  & L2 & \textbackslash supervisorCsDepartment\{\} & Supervisor3\_organization\_L2 &  &  &  & o \\
\rowcolor{yellow} & Other organisation &  & \textbackslash supervisorCsOrganization\{\} & Supervisor3\_Other\_organisation & x &  &  &  x \\
 \hline
\rowcolor{yellow}Cooperation & \multicolumn{8}{l}{\cellcolor{yellow}}\\
\rowcolor{yellow} & Partner\_name &  & \textbackslash hostcompany\{\}        or \textbackslash hostorganization\{\} & Cooperation\_Partner\_name &  &  &  & o \\
  \hline
National Subject Categories &  &  & \textbackslash nationalsubjectcategories\{\} & National Subject Categories &  &  &  & x \\
 \hline
Other information & \\
 & Year &  & \textbackslash the\textbackslash year & (derived from document property Date) &  &  &  & x \\
 & Number of pages &  & (derived from labels: pg:lastPageofPreface and pg:lastPageofMainmatter) & (derived from bookmarks: lastPageofPreface and lastPageofMainmatter) &  &  &  & x \\
Series & \\
 & Title of series &  & \textbackslash trita{TRITA-EECS-EX}{2021:00} & Series\_name &  & x &  & x \\
 & No. in series &  &  & Number\_in\_series &  & x &  & x \\
Opponents &  &  & \textbackslash opponentsNames\{\} & Opponents\_Name & x &  &  & \\
Presentation & \\
 & Date &  & \textbackslash presentationDateAndTimeISO\{\} & Presentation\_Date & x &  &  & x \\
 & Language &  & \textbackslash presentationLanguage{ } & Presentation\_Language & x &  &  & x \\
 & Room &  & \textbackslash presentationRoom\{\} & Presentation\_Room & x &  &  & x \\
 & Address &  & \textbackslash presentationAddress{ } & Presentation\_Address & x &  &  & x \\
 & City &  & \textbackslash presentationCity{ } & Presentation\_City & x &  &  & x \\
\hline
Number of lang instances &  &  &  & [Manually entered as 2, 3, 4, …] &  &  &  & \\
abstracts & \\
 & eng &  & (saved in Lua table) & (derived from bookmark: EnglishAbstract and then text inserted) & x &  &  & x \\
 & swe &  &  & (derived from bookmark: SwedishAbstract) & x &  &  & x \\
 & \cellcolor{yellow}fre &\cellcolor{yellow}  & & \multicolumn{4}{l}{\cellcolor{yellow}} & \cellcolor{yellow}o\\
 & \cellcolor{yellow}… & \cellcolor{yellow} & & \multicolumn{4}{l}{\cellcolor{yellow}} & \cellcolor{yellow}o\\
keywords & \\
 & eng &  & (saved in a Lua tables) & (derived from bookmark: EnglishKeywords) & x &  &  & x \\
 & swe &  &  & (derived from bookmark: SwedishKeywords) & x &  &  & x \\
 & \cellcolor{yellow}fre & \cellcolor{yellow} & & \multicolumn{4}{l}{\cellcolor{yellow}} & \cellcolor{yellow}o \\
 & \cellcolor{yellow}… & \cellcolor{yellow} & & \multicolumn{4}{l}{\cellcolor{yellow}} & \cellcolor{yellow}o\\
\hline
\end{longtable}
}
\end{landscape}


\section{Use of Lua and Babel}
One of the major changes introduced in this template is the use of Lua and Babel. Lua is a simple programming language. This language is available to the user of \LuaLaTeX{}. Lua's tables offer a very powerful way to store structured data. We use a Lua package (\fname{dkjson.lua}) to write a Lua table containing all of the metadata to a \fname{fordiva.json} file. The format of this file is \gls{JSON}. Not only is this file generated but it is both attached to the PDF file and included in a listing on the ``For DiVA'' page.

The primary use of the \fname{fordiva.json} file is to facilitate reporting the thesis in \gls{DiVA}. However, a secondary use of this information is to potentially automate many of the steps in announcing the oral presentation (as was described in the section ``Making an announcement'' in the file \texttt{README\_supervisor\_notes.tex}).
For example, the student's organization or main supervisor's organization is used to determine which local part of the KTH calendar a calendar announcement should appear in, as the Cortina calendar is divided by the school and then by department.

\warningExpl{Note that the department name must be in Swedish for Cortina. Ideally, this is something that a program using the JSON data should handle for the user.}

In addition to the English and Swedish abstracts and keywords information, there are a number of skeleton files in the folder \texttt{Additional\_Abstracts}. While not an exhaustive list of possibilities, they represent the languages for which I found several abstracts in DiVA\footnote{Except for Estonian, which had an entry but no longer has an entry.} Since 2000, the language code `scc' (for Serbo-Croatian) is considered deprecated and has been replaced by `srp' for Serbian and `hrv' for Croatian (for which I have not implemented a skeleton). Otherwise, there is a skeleton abstract for all of the langauge codes used in one or more abstracts in this language in \gls{DiVA}.

The \texttt{\textbackslash foreignlanguage\{xxxx\}\{xxxxxxx\}} command can be used to indicate that the string xxxxxxx is in language xxxx and the use of the \texttt{\textbackslash selectlanguage\{xxxx\}} command to switch to the language xxxx. The first command makes it easy to include text in a language that is not the main language of the thesis at any point in the thesis. The second command can be used to switch to a specific language at a certain point in the text. This second command is used to facilitate the inclusion of abstracts and keywords in various languages.

The \texttt{babel} package is used to handle different languages and automatically switch to the appropriate font for each language. 
If one does \textbf{not} use babel configured for the languages that you use, you will find messages in the \fname{output.log} file, such as those shown in \Cref{lst:missingCharactersFromLogExample}. While it is possible to work around this on a character-by-character basis by using suitable fonts and adding mappings, such as shown in \Cref{lst:newunicodeForAbstracts}, a better approach is described in \Cref{sec:BetterHandlingOfFonts}.


\begin{lstlisting}[style=latexExampleForAuthors,  escapechar=|, 
basicstyle=\footnotesize,
caption={Examples of missing characters from the output.log file},
label=lst:missingCharactersFromLogExample]
\end{lstlisting}
\begin{Verbatim}[breaklines=true]
Missing character: There is no 中 (U+4E2D) in font TeX Gyre Cursor/OT:script=latn;language=dflt;-liga;+lnum;+tnum; mapping=tex-text;!
Missing character: There is no 文 (U+6587) in font TeX Gyre Cursor/OT:script=latn;language=dflt;-liga;+lnum;+tnum; mapping=tex-text;!
Missing character: There is no 摘 (U+6458) in font TeX Gyre Cursor/OT:script=latn;language=dflt;-liga;+lnum;+tnum; mapping=tex-text;!
Missing character: There is no 要 (U+8981) in font TeX Gyre Cursor/OT:script=latn;language=dflt;-liga;+lnum;+tnum; mapping=tex-text;!
Missing character: There is no 个 (U+4E2A) in font TeX Gyre Heros/OT:script=latn;language=dflt;mapping=tex-text;!
Missing character: There is no 关 (U+5173) in font TeX Gyre Heros/OT:script=latn;language=dflt;mapping=tex-text;!
Missing character: There is no 键 (U+952E) in font TeX Gyre Heros/OT:script=latn;language=dflt;mapping=tex-text;!
Missing character: There is no 词 (U+8BCD) in font TeX Gyre Heros/OT:script=latn;language=dflt;mapping=tex-text;!
\end{Verbatim}


\begin{lstlisting}[style=latexExampleForAuthors,  escapechar=|, 
caption={Examples of new unicode character definitions},
label=lst:newunicodeForAbstracts]
\end{lstlisting}
\begin{Verbatim}[breaklines=true]
\newunicodechar{个}{\iffontchar\font`个 个\else{\cjkfonttt 个}\fi} % U+4E2A - CJK Unified Ideograph-4E2A
\newunicodechar{中}{\iffontchar\font`中 中\else{\cjkfonttt 中}\fi} % U+4E2D - CJK Unified Ideograph-4E2D
\newunicodechar{关}{\iffontchar\font`关 关\else{\cjkfonttt 关}\fi} % U+5173 - CJK Unified Ideograph-5173
\newunicodechar{摘}{\iffontchar\font`摘 摘\else{\cjkfonttt 摘}\fi} % U+6458 - CJK Unified Ideograph-6458
\newunicodechar{文}{\iffontchar\font`文 文\else{\cjkfonttt 文}\fi} % U+6587 - CJK Unified Ideograph-6587
\newunicodechar{要}{\iffontchar\font`要 要\else{\cjkfonttt 要}\fi} % U+8981 - CJK Unified Ideograph-8981
\newunicodechar{词}{\iffontchar\font`词 词\else{\cjkfonttt 词}\fi} % U+8BCD - CJK Unified Ideograph-8BCD
\newunicodechar{键}{\iffontchar\font`键 键\else{\cjkfonttt 键}\fi} % U+952E - CJK Unified Ideograph-952E
\end{Verbatim}

\FloatBarrier


If the user uses characters that require fonts other than \texttt{TeX Gyre Termes} and has not configured babel with a font for this language, the contents of the abstracts in these languages may not appear on the ``For DiVA'' page but will be in the \texttt{fordiva.json} file. This will occur because the file simply contains the UTF-8 encoded unicode for the abstracts.

\subsection{Better handling of fonts}
\label{sec:BetterHandlingOfFonts}

Manually or programmatically adding all of the missing characters to the relevant \texttt{unicode\_blocks} file was used to work with polyglossia and \XeLaTeX{}. However, it took a lot of work.

Therefore, a decision was made to switch to \LuaLaTeX{} and babel. This combination has well-integrated \texttt{fontspec} support for automatically switching language and fonts. \Cref{lst:BabelHindiExample} shows how easy it is to set up a font that can be used when setting content written in Hindi, \ie babel language hindi. This font will automatically be invoked when you issue a \texttt{\textbackslash selectlenguage\{hindi\}} \textbf{and} when you use one of the unicode characters with code points in the Devanagari range, \ie U+0900 to U+097F.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Establishing fonts to be used when setting content in Hindi}, label=lst:BabelHindiExample] 
\babelprovide[import, onchar=ids fonts]{hindi}
\babelfont[hindi]{rm}{Noto Serif Devanagari}
\babelfont[hindi]{sf}{Noto Sans Devanagari}
\end{lstlisting}

Similar functionality is utilized by the template with the babel languages: arabic, centralkurdish, chinese-simplified, chinese-traditional greek, hebrew, japanese, russian, and vietnamese.

One of the advantages of switching to babel is that it allows lazy loading of languages and lazy loading of fonts -- thus unless the language is used or the font is used, they do not have to be loaded.

Unfortunately, \texttt{luaotfload} program must still resolve the font name into a file to load the font from, then it transforms this font into Lua code and compiles it into bytecode (that later can be loaded -- if the font is used). The time required to do all of this can be considerable and may lead to timeouts. For this reason, I have introduced \fname{warmup.tex} that when compiled will cause the \texttt{luaotfload} program to load the fonts used by \fname{examplethesis.tex} into the working font cache. Addition, it will store a copy of these font files into a working directory. By following the directions in \fname{Saving\_and\_restoring\_font\_cache.tex} you can download the saved fonts and then upload them for use by the document \fname{restore\_font\_cache.tex} that when compiled will copy the uploaded saved fonts to the working font cache.

\subsubsection{Babel ranges}

The file \texttt{babel-data-bidi.lua} \footnote{Perhaps under \texttt{/usr/share/texmf/tex/generic/babel/}} defines the Babel table. This is shown in \Cref{lst:BabelTableandRanges}. The format of the entries is the starting codepoint of a range, the ending codepoint of a range (inclusive), and the direction. The direction is defined according to ``Table 4. Bidirectional Character Types'' in \textit{Unicode® Standard Annex \#9: The Bidirectional Algorithm}\,\cite{UAX9}. Accordingly, `r' is right-to-left, `l' is is left-to-right (the default), `al' is right-to-left Arabic, and `on' is other neutrals.

\begin{lstlisting}[language={[5.2]Lua}, caption={Babel table and Babel-ranges supplemented with additional comments about Unicode blocks}, label=lst:BabelTableandRanges]
Babel = Babel or {}

Babel.ranges={
 {0x0590, 0x05FF, 'r'}, -- Hebrew, U+0590 - U+05FF
 {0x0600, 0x07BF, 'al'}, -- Arabic, U+0600 - U+06FF;
                         -- Syriac, U+0700 - U+074F;
                         -- Arabic Supplement, U+0750 - U+077F;
                         -- Thaana, U+0780 - U+07BF
 {0x07C0, 0x085F, 'r'}, -- NKo, U+07C0 - U+07FF;
                        -- Samaritan, U+0800 - U+083F;
                        -- Mandaic, U+0840 - U+085F
 {0x0860, 0x086F, 'al'}, -- Syriac Supplement, U+0860 - U+086F
 {0x08A0, 0x08FF, 'al'}, -- Arabic Extended-A, U+08A0 - U+08FF
 {0xE000, 0xF8FF, 'on'}, -- PUA -- Private Use Area, U+E000 - U+F8FF
 {0xFB1D, 0xFB4F, 'r'},  -- Alphabetic Presentation Forms, U+FB00 - U+FB4F
 {0xFB50, 0xFDFF, 'al'}, -- Arabic Presentation Forms-A, U+FB50 - U+FDFF
 {0xFE70, 0xFEFF, 'al'}, -- Arabic Presentation Forms-B, U+FE70 - U+FEFF
 {0x10800, 0x10C4F, 'r'}, -- Cypriot Syllabary, U+10800 - U+1083F;
                          -- Imperial Aramaic, U+10840 - U+1085F;
                          -- Palmyrene, U+10860 - U+1087F;
                          -- Nabataean, U+10880 - U+108AF; 
                        -- hole U+108B0 - 108DF;
                         -- Hatran, U+108E0 - U+108FF;
                         -- Phoenician, U+10900 - U+1091F;
                         -- Lydian, U+10920 - U+1093F;
                         -- Meroitic Hieroglyphs, U+10980 - U+1099F;
                         -- Meroitic Cursive, U+109A0 - U+109FF;
                         -- Kharoshthi, U+10A00 - U+10A5F;
                         -- Old South Arabian, U+10A60 - U+10A7F;
                         -- Old North Arabian, U+10A80 - U+10A9F;
                         -- Manichaean, U+10AC0 - U+10AFF;
                         -- Avestan, U+10B00 - U+10B3F;
                         -- Inscriptional Parthian, U+10B40 - U+10B5F;
                         -- Inscriptional Pahlavi, U+10B60 - U+10B7F;
                         -- Psalter Pahlavi, U+10B80 - U+10BAF;
                         -- Old Turkic, U+10C00 - U+10C4F
 {0x1E800, 0x1E8DF, 'r'}, -- Mende Kikakui, U+1E800 - U+1E8DF
 {0x1E900, 0x1E95F, 'r'}, -- Adlam, U+1E900 - U+1E95F
 {0x1F300, 0x1F9FF, 'on'}, -- Miscellaneous Symbols and Pictographs, U+1F300 - U+1F5FF;
                           -- Emoticons, U+1F600 - U+1F64F;
                           -- Ornamental Dingbats, U+1F650 - U+1F67F;
                           -- Transport and Map Symbols, U+1F680 - U+1F6FF;
                           -- Alchemical Symbols, U+1F700 - U+1F77F;
                           -- Alchemical Symbols, U+1F700 - U+1F77F;
                           -- Supplemental Arrows-C, U+1F800 - U+1F8FF;
                           -- Supplemental Symbols and Pictographs, U+1F900 - U+1F9FF:
 {0xF0000, 0xFFFFD, 'on'}, -- PUA -- Supplementary Private Use Area-A, U+F0000 - U+FFFFF; does not include U+FFFFE and U+FFFFF 
 {0x100000, 0x10FFFD, 'on'} -- PUA -- Supplementary Private Use Area-B, U+100000 - U+10FFFF; does not include U+10FFFE or U+10FFFF
}
\end{lstlisting}

\Cref{lst:BabelTableChracters} shows part of the \texttt{Babel.characters} table. The direction table (with \texttt{d} in it) has additional character types:
`an' for Arabic number,
`b' for paragraph separator, 
`bn' for boundary neutral,
`cs' for common number separator,
`en'  for European number,
`es'  for European number separator,
`et' for European number terminator,
`fsi' for first strong isolate,
`lre' for left-to-right embedding,
`lri' for left-to-right isolate,
`lro' for left-to-right override,
`nsm' for nonspace mark,
`pdf' for pop directional format,
`pdi' for pop directional isolate,
`rle' for right-left embedding,
`rli' for right-left isolate,
`rlo' for right-left override,
`s' for segment separator, and
`ws' for white space.
\clearpage
\begin{lstlisting}[language={[5.2]Lua},  escapechar=£, caption={(part of) Babel table of characters}, label=lst:BabelTableChracters]
Babel.characters={
 [0x0]={d='bn'},
 £\quad$\vdots$£
 [0x8]={d='bn'},
 [0x9]={d='s'},
 [0xA]={d='b'},
 [0xB]={d='s'},
 [0xC]={d='ws'},
 [0xD]={d='b'},
 [0xE]={d='bn'},
 £\quad$\vdots$£
 [0x1B]={d='bn'},
 [0x1C]={d='b'},
 [0x1D]={d='b'},
 [0x1E]={d='b'},
 [0x1F]={d='s'},
 [0x20]={d='ws'},
 [0x21]={d='on'},
 [0x22]={d='on'},
 [0x23]={d='et'},
 [0x24]={d='et'},
 [0x25]={d='et'},
 [0x26]={d='on'},
 [0x27]={d='on'},
 [0x28]={d='on', m=0x29},
 [0x29]={d='on', m=0x28},
 [0x2A]={d='on'},
 [0x2B]={d='es'},
 [0x2C]={d='cs'},
 [0x2D]={d='es'},
 [0x2E]={d='cs'},
 [0x2F]={d='cs'},
 [0x30]={d='en'},
 £\quad$\vdots$£
 [0x39]={d='en'},
 [0x3A]={d='cs'},
 [0x3B]={d='on'},
 [0x3C]={d='on', m=0x3E},
 [0x3D]={d='on'},
 [0x3E]={d='on', m=0x3C},
 [0x3F]={d='on'},
 [0x40]={d='on'},
 [0x5B]={d='on', m=0x5D},
 [0x5C]={d='on'},
 [0x5D]={d='on', m=0x5B},
 [0x5E]={d='on'},
 [0x5F]={d='on'},
 [0x60]={d='on'},
 [0x7B]={d='on', m=0x7D},
 [0x7C]={d='on'},
 [0x7D]={d='on', m=0x7B},
 [0x7E]={d='on'},
 [0x7F]={d='bn'},
 £\quad$\vdots$£
 [0x84]={d='bn'},
 [0x85]={d='b'},
 [0x86]={d='bn'},
 £\quad$\vdots$£
 [0x9F]={d='bn'},
 [0xA0]={d='cs'},
 [0xA1]={d='on'},
 [0xA2]={d='et'},
 [0xA3]={d='et'},
 [0xA4]={d='et'},
 [0xA5]={d='et'},
 [0xA6]={d='on'},
 [0xA7]={d='on'},
 [0xA8]={d='on'},
 [0xA9]={d='on'},
 [0xAB]={d='on', m=0xBB},
 [0xAC]={d='on'},
 [0xAD]={d='bn'},
 [0xAE]={d='on'},
 [0xAF]={d='on'},
 [0xB0]={d='et'},
 [0xB1]={d='et'},
 [0xB2]={d='en'},
 [0xB3]={d='en'},
 [0xB4]={d='on'},
 [0xB6]={d='on'},
 [0xB7]={d='on'},
 [0xB8]={d='on'},
 [0xB9]={d='en'},
 [0xBB]={d='on', m=0xAB},
 [0xBC]={d='on'},
 [0xBD]={d='on'},
 [0xBE]={d='on'},
 [0xBF]={d='on'},
 [0xD7]={d='on'},
 [0xF7]={d='on'},
 [0x2B9]={d='on'},
 [0x2BA]={d='on'},
 [0x2C2]={d='on'},
 £\quad$\vdots$£
\end{lstlisting}

Entries of the form shown in \Cref{lst:BabelTableChractersMachedDelimiters} define \textbf{mirrored} characters.

\begin{lstlisting}[language={[5.2]Lua},  escapechar=£, caption={Some of the matching delimiters in Babel table of characters (with added comments)}, label=lst:BabelTableChractersMachedDelimiters]
 [0x28]={d='on', m=0x29}, -- Left Parenthesis
 [0x29]={d='on', m=0x28}, -- Right Parenthesis
 [0x3C]={d='on', m=0x3E}, -- Less-Than Sign
 [0x3E]={d='on', m=0x3C}, -- Greater-Than Sign
 [0x5B]={d='on', m=0x5D}, -- Left Square Bracket
 [0x5D]={d='on', m=0x5B}, -- Right Square Bracket
 [0x7B]={d='on', m=0x7D}, -- Left Curly Bracket
 [0x7D]={d='on', m=0x7B}, -- Right Curly Bracket
 [0xAB]={d='on', m=0xBB}, -- Left-Pointing Double Angle Quotation Mark
 [0xBB]={d='on', m=0xAB}, -- Right-Pointing Double Angle Quotation Mark
 [0xF3A]={d='on', m=0xF3B}, -- Tibetan Mark Gug Rtags Gyon
 [0xF3B]={d='on', m=0xF3A}, -- Tibetan Mark Gug Rtags Gyas
 [0xF3C]={d='on', m=0xF3D}, -- Tibetan Mark Ang Khang Gyon
 [0xF3D]={d='on', m=0xF3C}, -- Tibetan Mark Ang Khang Gyas
 [0x169B]={d='on', m=0x169C}, -- Ogham Feather Mark
 [0x169C]={d='on', m=0x169B}, -- Ogham Reversed Feather Mark
 £\quad$\vdots$£
\end{lstlisting}

\Needspace*{14\baselineskip}
The file \texttt{luababel.def} defines \texttt{Babel.script\_blocks}. These are shown in \Cref{lst:BabelTableScriptBlocks}.

\begin{lstlisting}[language={[5.2]Lua},  escapechar=£, caption={Babel table script\_blocks}, label=lst:BabelTableScriptBlocks]
Babel.script_blocks = {
  ['dflt'] = {},
  ['Arab'] = {{0x0600, 0x06FF}, {0x08A0, 0x08FF}, {0x0750, 0x077F},
              {0xFE70, 0xFEFF}, {0xFB50, 0xFDFF}, {0x1EE00, 0x1EEFF}},
  ['Armn'] = {{0x0530, 0x058F}},
  ['Beng'] = {{0x0980, 0x09FF}},
  ['Cher'] = {{0x13A0, 0x13FF}, {0xAB70, 0xABBF}},
  ['Copt'] = {{0x03E2, 0x03EF}, {0x2C80, 0x2CFF}, {0x102E0, 0x102FF}},
  ['Cyrl'] = {{0x0400, 0x04FF}, {0x0500, 0x052F}, {0x1C80, 0x1C8F},
              {0x2DE0, 0x2DFF}, {0xA640, 0xA69F}},
  ['Deva'] = {{0x0900, 0x097F}, {0xA8E0, 0xA8FF}},
  ['Ethi'] = {{0x1200, 0x137F}, {0x1380, 0x139F}, {0x2D80, 0x2DDF},
              {0xAB00, 0xAB2F}},
  ['Geor'] = {{0x10A0, 0x10FF}, {0x2D00, 0x2D2F}},
  % Don't follow strictly Unicode, which places some Coptic letters in
  % the 'Greek and Coptic' block
  ['Grek'] = {{0x0370, 0x03E1}, {0x03F0, 0x03FF}, {0x1F00, 0x1FFF}},
  ['Hans'] = {{0x2E80, 0x2EFF}, {0x3000, 0x303F}, {0x31C0, 0x31EF},
              {0x3300, 0x33FF}, {0x3400, 0x4DBF}, {0x4E00, 0x9FFF},
              {0xF900, 0xFAFF}, {0xFE30, 0xFE4F}, {0xFF00, 0xFFEF},
              {0x20000, 0x2A6DF}, {0x2A700, 0x2B73F},
              {0x2B740, 0x2B81F}, {0x2B820, 0x2CEAF},
              {0x2CEB0, 0x2EBEF}, {0x2F800, 0x2FA1F}},
  ['Hebr'] = {{0x0590, 0x05FF}},
  ['Jpan'] = {{0x3000, 0x303F}, {0x3040, 0x309F}, {0x30A0, 0x30FF},
              {0x4E00, 0x9FAF}, {0xFF00, 0xFFEF}},
  ['Khmr'] = {{0x1780, 0x17FF}, {0x19E0, 0x19FF}},
  ['Knda'] = {{0x0C80, 0x0CFF}},
  ['Kore'] = {{0x1100, 0x11FF}, {0x3000, 0x303F}, {0x3130, 0x318F},
              {0x4E00, 0x9FAF}, {0xA960, 0xA97F}, {0xAC00, 0xD7AF},
              {0xD7B0, 0xD7FF}, {0xFF00, 0xFFEF}},
  ['Laoo'] = {{0x0E80, 0x0EFF}},
  ['Latn'] = {{0x0000, 0x007F}, {0x0080, 0x00FF}, {0x0100, 0x017F},
              {0x0180, 0x024F}, {0x1E00, 0x1EFF}, {0x2C60, 0x2C7F},
              {0xA720, 0xA7FF}, {0xAB30, 0xAB6F}},
  ['Mahj'] = {{0x11150, 0x1117F}},
  ['Mlym'] = {{0x0D00, 0x0D7F}},
  ['Mymr'] = {{0x1000, 0x109F}, {0xAA60, 0xAA7F}, {0xA9E0, 0xA9FF}},
  ['Orya'] = {{0x0B00, 0x0B7F}},
  ['Sinh'] = {{0x0D80, 0x0DFF}, {0x111E0, 0x111FF}},
  ['Syrc'] = {{0x0700, 0x074F}, {0x0860, 0x086F}},
  ['Taml'] = {{0x0B80, 0x0BFF}},
  ['Telu'] = {{0x0C00, 0x0C7F}},
  ['Tfng'] = {{0x2D30, 0x2D7F}},
  ['Thai'] = {{0x0E00, 0x0E7F}},
  ['Tibt'] = {{0x0F00, 0x0FFF}},
  ['Vaii'] = {{0xA500, 0xA63F}},
  ['Yiii'] = {{0xA000, 0xA48F}, {0xA490, 0xA4CF}}
}

Babel.script_blocks.Cyrs = Babel.script_blocks.Cyrl
Babel.script_blocks.Hant = Babel.script_blocks.Hans
Babel.script_blocks.Kana = Babel.script_blocks.Jpan

\end{lstlisting}

\subsection{Generating a true JSON fordiva.json file}
\label{sec:avoidCleanup}

To understand if \LuaLaTeX{} could be used to directly emit a properly formed \gls{JSON} file, we used the programming features in the Lua programming language. \Cref{sec:LuaProofOfConcept} shows a simple proof-of-concept for doing this\footnote{Two of the keys to developing the various Lua functions were \first to interact with Google Gemini 2.5 Pro to generate Lua code for a given idea and \Second to create small Overleaf project to carry out small experiments with this code, rather than trying to put code directly into the template. There were three reasons for this: \first quite often the code proposed by Gemini was incorrect, \Second one can compile a small project quickly, thus increasing the speed of development, and \third quite often the process of prompt, get code, test code, tell Gemini the errors that were generated, and iterate -- would lead to a complete redesign of the mechanism to be used.}. \Cref{sec:LuaInPractice} describes how the template actually does the full job.

\subsubsection{Proof of concept}
\label{sec:LuaProofOfConcept}
\Cref{lst:luaExample1} shows an example of a Lua program that generates a JSON file named \texttt{output.json}. The idea would be to utilize Lua data tables to store the metadata, then write it out as a complete JSON file.

\begin{lstlisting}[language={[5.2]Lua}, caption={Using Lua code to write a JSON file}, label=lst:luaExample1] 
\documentclass{article}
\usepackage{luacode}

% Use the starred environment to handle backslashes correctly.
\begin{luacode*}
function write_my_json_data()
  -- This data table can now have any number of keywords.
  local myData = {
    author = "Fake A. Student",
    title = "This is the title in the language of the thesis",
    year = 2025,
    keywords = { "KeywordA", "KeywordB", "KeywordC", "A Fourth Keyword" }
  }

  -- 1. Create a new table to hold the formatted keywords.
  local quotedKeywords = {}
  
  -- 2. Loop through the original keywords using ipairs to preserve order.
  for _, keyword in ipairs(myData.keywords) do
    -- Wrap each keyword string in quotes and add it to the new table.
    table.insert(quotedKeywords, '"' .. keyword .. '"')
  end
  
  -- 3. Join the quoted keywords with a comma and a space.
  local keywordsString = table.concat(quotedKeywords, ', ')

  -- 4. Build the final JSON string using the dynamically created keyword list.
  local jsonString = string.format(
    '{\n  "author": "%s",\n  "title": "%s",\n  "year": %d,\n  "keywords": [%s]\n}',
    myData.author,
    myData.title,
    myData.year,
    keywordsString -- The placeholder is now filled by our joined string.
  )

  -- The file writing logic remains the same.
  local outputFile = io.open("output.json", "w")
  if outputFile then
    outputFile:write(jsonString)
    outputFile:close()
  end
end
\end{luacode*}

\begin{document}

This is a LuaLaTeX document.
\directlua{write_my_json_data()}
The JSON file has been created using a loop for the keywords.

\end{document}
\end{lstlisting}

\subsubsection{Using Lua in practice}
\label{sec:LuaInPractice}

Expanding on the proof of concept in \Cref{sec:avoidCleanup}, \Cref{lst:luaExample2} shows how Lua can be used to write the \texttt{fordiva.json} file with abstracts and keywords.
David Kolf's \textit{JSON module for Lua 5.1 - 5.4} from the file \texttt{dkjson.lua} handles the encoding of a Lua table into \gls{JSON}, including ordering of the top-level keys\footnote{Sorting is only done of the \textbf{top-level} keys. There is no facility for sorting the elements of the table.} and escaping of the \LaTeX{} commands. The JSON file is generated by invoking the \texttt{\textbackslash GenerateFordivaJSON} macro after filling in the table in the macro \texttt{\textbackslash divainfo}.

\begin{lstlisting}[language={[5.2]Lua}, caption={Lua code snippetto write fordiva.json file including abstracts and keywords}, label=lst:luaExample2] 
%
% --- Define the thesis abstract environment ---
\RequirePackage{environ}
\RequirePackage{verbatim}
\RequirePackage{luacode}

% --- Lua Backend ---
\begin{luacode*}
-- This global table will store the data
thesisData = {
  abstracts = {},
  keywords = {}
}

-- Generic function to add a value to our main data table
-- It can handle nested keys, e.g., set_data({"Author1", "Last name"}, "Student")
function set_data(keys, value)
  local t = thesisData
  for i = 1, #keys - 1 do
    local key = keys[i]
    if not t[key] then t[key] = {} end
    t = t[key]
  end
  t[keys[#keys]] = value
end

-- This function reads content from a specified filename and adds it to our table
function add_data_from_file(category, lang, filename)
  local file = io.open(filename, "r")
  if not file then return end
  local content = file:read("*a")
  file:close()

  if thesisData[category] then
    thesisData[category][lang] = content
  end
end

-- This function generates the final JSON file
function write_json_file()
  -- This requires the dkjson.lua library in your project folder
  local dkjson = require("dkjson")

  -- Define the desired order of keys
  local keyorder = {
    "Author1", "Author2", "Course Info", "Degree1", "Degree2", "Title", "Alternative title",
    "Supervisor1", "Supervisor2", "Supervisor3", "Supervisor4", "Supervisor5", 
    "Opponents",
    "National Subject Categories", "SDGs",
    "Other information", "Series", "Copyrightleft", "Presentation", 
    "abstracts", "keywords"
  }
  
  local jsonString = dkjson.encode(thesisData, { indent = true, keyorder = keyorder })
  local outputFile = io.open("fordiva.json", "w")
  if outputFile then
    outputFile:write(jsonString)
    outputFile:close()
  end
end
\end{luacode*}

% --- LaTeX Frontend ---
% Helper commands to pass LaTeX macro values to the Lua set_data function
% Helper commands that NOW evaluate the last argument before passing it to Lua.
\newcommand{\SetValue}[2]{\directlua{set_data({"#1"}, \luastring{\expanded{#2}})}}
\newcommand{\SetNestedValue}[3]{\directlua{set_data({"#1", "#2"}, \luastring{\expanded{#3}})}}
\newcommand{\SetDeepNestedValue}[4]{\directlua{set_data({"#1", "#2", "#3"}, \luastring{\expanded{#4}})}}


\newwrite\tempfile

\NewEnviron{ThesisAbstract}[1]{%
  % 1. Write the raw content to a temporary file
  \immediate\openout\tempfile=abstract.tmp
  \immediate\write\tempfile{\unexpanded\expandafter{\BODY}}
  \immediate\closeout\tempfile
  % 2. Tell Lua to read the data from that file
  \directlua{add_data_from_file("abstracts", "#1", "abstract.tmp")}%
  % 3. Typeset the content in the document as normal
  \par
  \BODY
}

\NewEnviron{ThesisKeywords}[1]{%
  \immediate\openout\tempfile=keywords.tmp
  \immediate\write\tempfile{\expanded{\BODY}} %<-- This evaluates commands first
  \immediate\closeout\tempfile
  \directlua{add_data_from_file("keywords", "#1", "keywords.tmp")}%
  \par
  \BODY
}

% This command triggers the final JSON write
\newcommand{\GenerateFordivaJSON}{\directlua{write_json_file()}}
\end{lstlisting}

\Needspace*{7\baselineskip}
\subsubsection{Two new environments for capturing abstract and keywords}
\label{sec:TwoEnvironmentsForAbstractAndKeywords}
Also shown in \Cref{lst:luaExample2} are two new environments: ThesisAbstract and ThesisKeywords. The first of these captures the raw \LaTeX{} in the environment, while the second first expands the \LaTeX{} and then saves it. These environments must be followed by the three-letter ISO 639-2 Code – specifically the "B" (bibliographic) variant of these codes.

This leads to a new style of writing abstract, as shown in \Cref{lst:FrenchAbstract}. The first step is to select the language and when using babel this will also potentially select the correct font to use. The second step is to update the term \texttt{\textbackslash abstractname} to use for this abstract (as it could be an abstract or summary). While babel (or polyglossia) often provides definitions of this term, doing it as shown makes it simple for the author to change it is they need to. The whole abstract is in an \texttt{abstract} environment. This environment is important for several reason. \first entering this environment formats the heading in the Figtree font (or a language-specific font if Figtree does not have the requisite glyphs) and \Second it enables the macros that warn if a citation or cross-reference has been used. The \texttt{\textbackslash markboth} sets up the page heading. Next the \texttt{\textbackslash begin\{ThesisAbstract\}\{fre\}} begins the environment for the thesis abstract. Following this the \texttt{\textbackslash keywordHeading} macro defines the heading to be used for the keywords (in the proper typeface). The ThesisKeywords environment handles the keywords. Finally, a \texttt{\textbackslash cleardoublepage} is done to advance to the next odd-numbered (i.e., right-hand) page. Note that the running heading will also be used on the page (if needed) to get to the next odd-numbered page.

As noted above, the ThesisAbstract and ThesisKeywords environments serve two purposes: to capture content for later use and to output the thesis abstract and keywords in place.

\Needspace*{15\baselineskip}
\begin{lstlisting}[language={[LaTeX]TeX}, caption={Example of the abstract\_french.tex file}, label=lst:FrenchAbstract]
\selectlanguage{french}
\setlocalecaption{french}{abstract}{Résumé}
\begin{abstract}
    \markboth{\abstractname}{}
\begin{ThesisAbstract}{fre}
Résumé en français.
\end{ThesisAbstract}

\keywordHeading{Mots-clés}
\begin{ThesisKeywords}{fre}
5-6 mots-clés
\end{ThesisKeywords}
\end{abstract}
\cleardoublepage
\end{lstlisting}
\subsubsection{Generating the For DiVA pages}
\label{sec:generatingForDiVApage}

The \texttt{\textbackslash divainfo} command generates the ``For DiVA'' information pages by putting the metadata into a Lua table and then writing the whole table out as JSON. The \fname{fordiva.json} file is subsequently read back into a listing.

\Cref{lst:setupForDiVAlistingEnv} shows how to configure the listings environment that you will put the \fname{fordiva.json} contents into. One of the tricks here is that it was essential to reduce the hyphenation penalty to enable the abstract text to wrap lines nicely on the page. As an added benefit, the \LaTeX{}~syntax highlighting is on –- so one can easily see the \LaTeX~commands that are used –- as they might need manual editing before the event is announced or the data imported into DIVA.


\begin{lstlisting}[language={[LaTeX]TeX}, caption={Code in the document file to configure the listing environment to put the abstract into}, label=lst:setupForDiVAlistingEnv] 
\makeatletter
\let\verbatimsc\@undefined
\let\endverbatimsc\@undefined
\lst@AddToHook{Init}{\hyphenpenalty=50\relax}
\makeatother

\lstnewenvironment{verbatimsc}
    {
    \lstset{%
        basicstyle=\ttfamily\tiny,
        %basicstyle=\tiny,
        %columns=fullflexible,
        columns=[l]fixed,
        language=[LaTeX]TeX,
        %numbers=left,
        %numberstyle=\tiny\color{gray},
        keywordstyle=\color{red},
        breaklines=true,                 % sets automatic line breaking
        breakatwhitespace=true,          % sets if automatic breaks should only happen at whitespace
        %keepspaces=false,
        breakindent=0em,
        %fancyvrb=true
    }
}{}
\end{lstlisting}
\FloatBarrier

\subsubsection{Attach the fordiva.json file}
\label{sec:optimizeJSONToMods}
To facilitate making use of the \texttt{fordiva.json} file, this file is attached to the \gls{PDF} file along with the \texttt{acronyms.tex} file. Once the \texttt{fordiva.json} and \texttt{acronyms.tex} files are attached to the \gls{PDF} file, you can later extract these\linebreak[4] attached files using various existing tools or my program: \linebreak[4]\texttt{extract\_embedded\_files\_from\_PDF.py}.

\subsubsection{Issues due to generating proper JSON}
\label{sec:IssuesOfDirectlyGeneratingJSON}

While the above code generates proper JSON, this comes with a cost -- the need to use Lua and hence \LuaLaTeX{}. Moreover, to make the handling of fonts easier requires a change to using \textbf{only} babel.

A positive benefit of adopting both Lua and babel is that generating the \textit{For DiVA} information is much easier and it should be easier to process the resulting files. An additional benefit is that it makes the code much simpler, especially with respect to dealing with different fonts. However, all is not perfect, as one will get warnings, such as \texttt{Font shape `TU/NotoSerifDevanagari(0)/m/it' undefined}. Thus far, I have not been able to find how to do silent substitutions of the font shapes, as the languages are dynamically loaded when needed.

\warningExpl{The above choice means elimination of support for \XeLaTeX{}.}

\warningExpl{There is a need to dig more deeply into the babel and fontspec code to understand when the fonts are dynamically loaded and see whether it is possible to change the font shape for the font being loaded. I suspect that there is probably a hook that one could use.}

\subsection[Adding acronyms.tex to For DIVA info]{Adding acronyms.tex to For DIVA info}
\label{sec:acronymsInForDIVAdata}
If the author has used acronyms in the abstract(s), then these acronym definitions need to be available in some way to the person (or program) that makes the \gls{MODS} file. One solution is to add them at the end of the For DIVA information. This can be done using the code shown in~\Cref{lst:includeAcronymsFile}. This code simply checks for the file and if it is present, then appends the contents of this file to the text as a listing. An important part to note is the option \texttt{nolol} - this prevents this listing from appearing in the list of listings.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Code for adding acronyms.tex at the end of the For DIVA data}, label=lst:includeAcronymsFile]
% If there is an acronyms.tex file,
% add it to the end of the For DIVA information
% so that it can be used with the abstracts
% Note that the option "nolol" stops it from being listed in the List of Listings
\IfFileExists{lib/acronyms.tex}{
\section*{acronyms.tex}
\lstinputlisting[language={[LaTeX]TeX}, nolol, basicstyle=\ttfamily\color{black},
commentstyle=\color{black}, backgroundcolor=\color{white}]{lib/acronyms.tex}
}
{}
\end{lstlisting}

\generalExpl{This is \textbf{not} used in the current template, the acronyms.tex file is simply attached to the PDF file.}

\subsection{Cleaning up JSON should be \textit{transforming} JSON}
\label{sec:cleaaningUpJSON}
If you save the \fname{fordiva.json} and \fname{acronyms.tex} files locally\footnote{Either by extracting them from the PDF file or you can download the acronyms.tex file from your project and can download the \fname{fordiva.json} with the ```Other logs and files'' button shown at the bottom of the log output window.}, then you can clean up and transform the \fname{fordiva.json} file. After having done this, you can make a \gls{MODS} file with the following commands:
\Needspace*{4\baselineskip}
\begin{lstlisting}[language={bash}, caption={cleanup\_pseudo\_JSON-from\_LaTeX and JSON\_to\_MODS.p},label=lst:cleanPseudoJSONandConvertToMODS]
./cleanup_pseudo_JSON-from_LaTeX.py --json xxx_fordiva.json --acronyms acronyms.tex
./JSON_to_MODS.py --json xxx_fordiva.json
\end{lstlisting}

Now all you have to do is rename the \gls{XML} file that was produced to \texttt{xxx.mods} and you are all set to upload it into \gls{DiVA}!


In my earlier code and writing, I have referred to cleaning up the pseudo-JSON or the actual JSON. However, this is not really the correct approach to take. It would be better to talk about a transformation from \gls{JSON} that contains \LaTeX{} to JSON that contains \gls{HTML}. Doing this once would be better than putting this work into each of the different programs that take in \gls{JSON} to produce calendar entries, \gls{MODS}, or Cora-DiVA \gls{API} calls. It will also be interesting because one of the data formats that the Cora-DiVA \gls{API} calls can accept is \gls{JSON}. Logically, this transformation could take place in the magic ``Extractor'' that was shown in \Cref{fig:LogicalOverviewOfWhatIsDone2} on page \pageref{fig:LogicalOverviewOfWhatIsDone2}.

\generalExpl{This transformation process has to transform the equations. While my various programs attempt to handle some simple equations, a more comprehensive and general solution is needed. At present, it is unknown if the Cora-based DIVA will support MathJax or something similar. If it were to support MathJax, then the solution is rather simple -- just pass the \LaTeX{} equation on and let MathJax render it in the browser when someone views it.}

\warningExpl{The programs have \textbf{not} yet been updated to move the common transformation code into an explicit JSON transformer. Moreover, doing so would simplify the maintenance of these programs, as the transformations would only need to take place in one program or perhaps in one library.}


\subsection{Generating plain text titles and subtitles}
\label{sec:generatingPlainText}

Many administrative systems, such as LADOK, getting an ISBN, \etc, require
plain Unicode text in UTF-8 encoding \ie \textit{without} markup. Therefore, I have developed some Lua code to enable \LuaLaTeX{} to help the author with this transformation.

Compiling \fname{Generate\_titles\_in\_plain\_text.tex} will generate a file named \texttt{extra\_plaintext.tex} containing plain text versions of the \mbox{titles} and subtitles (both main and alternate). (It is named this to avoid overwriting your existing custom\_configuration\_plaintext.tex file during the process.) Additionally, the plain text is set \textit{without} ligatures.

There is another Overleaf project that provides more details on this and gives examples of additional testing; see \url{https://www.overleaf.com/read/dfsjdqmcjmtp#0043d3}.

I believe that this code can handle a large fraction of all of the titles and subtitles that have previously been used at KTH. 


\section{What can we do with the JSON file?}
\label{sec:whatCanweDoWithTheJSONfile}
Once you are happy with the JSON file’s contents, the next step is to generate something interesting with this data –- for example, we can use the program JSON\_to\_calendar.py to create a calendar entry. 

\begin{figure}[!ht]
\begin{tikzpicture}
[align=left,node distance=2cm]
\node (jsonFile) [tape,tape bend top=none,draw,font=\sffamily] {JSON file};
\node (start) [processBox, right=1cm of jsonFile] {JSON\_to\_calendar};

\node (calendarEvent) [destinationBox, right=2cm of start] {Canvas calendar event};
\node (announcement) [destinationBox,  above of =calendarEvent] {Canvas announcement};
\node (cortinaCalendarEvent) [destinationBox,  right=0.5cm of start, below of=calendarEvent] {KTH Cortina calendar event};
\draw [arrow] (jsonFile) --  (start.west);
\draw [arrow] (start.east) --  (announcement.west);
\draw [arrow] (start.east) -- (calendarEvent);
\draw [arrow] (start.east) -- (cortinaCalendarEvent.west);

\end{tikzpicture}
\caption{The several outputs of JSON\_to\_calendar.py given a JSON file}
  \label{fig:foo}
\end{figure}
\FloatBarrier

We can produce all three outputs with the command shown in \Cref{lst:JSONtoCalendarThreeoutputs}. Note that the program was run with the \texttt{event.json} file (a JSON file containing HTML) to produce a Canvas course announcement.
\Needspace*{3\baselineskip}
\begin{lstlisting}[language={bash}, caption={Running JSON\_to\_calendar.py to produce all three outputs}, label=lst:JSONtoCalendarThreeoutputs]
JSON_to_calendar.py -c 11 --config config-test.json
\end{lstlisting}

Note that in this case, the \fname{config-test.json} configuration file was used to make use of the \textbf{test} Canvas course room instance as well as the \textbf{test} Cortina instance. To use this with the production instances, you would use your usual \texttt{config.json} configuration file. In either case, your configuration file needs to include a KTH API key to access Cortina.



\Needspace*{10\baselineskip}
\section{Other variants of JSON\_to\_calendar.py}
\label{sec:otherVariantsofJSONtoCalendar}
For testing purposes, I also created functionality in \texttt{JSON\_to\_calendar.py} to insert a fixed event (this was my first test) and to take as input a \gls{MODS} file. The MODS file was created from a \gls{DiVA} feed of theses presented in 2020 through to the 25\textsuperscript{th} of April 2021. However, one limitation that I found is that, other than myself, few people have been entering the date and time for the oral presentation. Unfortunately, since I wanted to test making calendar announcements, I needed the date and time!

\Needspace*{2\baselineskip}
\textbf{NB}: I have assumed that each degree project presentation lasts one hour. This assumption was made since the KTH Cortina calendar API needs both a starting and ending time. There is currently no support for specifying the duration of third-cycle presentations. However, looking at a calendar event for a doctoral defense on 2025-06-05, only the starting time appears in the event.

These other variants probably should \textbf{not} be kept, but rather the architecture should be similar to that shown in \Cref{fig:severalPossibleInputs}. Additionally, when taking data from other types of sources, one can take advantage of the data that is in a Canvas degree project course room to help when processing the source data.

\begin{figure}[!ht]
\resizebox{\textwidth}{!}{%
\begin{tikzpicture}
[align=left,node distance=2cm]


\node (latexFile) [tape,tape bend top=none,draw,font=\sffamily] {\LaTeX file};
\node (PDFfile) [tape,tape bend top=none,draw,font=\sffamily, above of=latexFile] {PDF file};
\node (DOCXFile) [tape,tape bend top=none,draw,font=\sffamily, below of=latexFile] {DOCX file};

\node (extractor) [processBox, right=1cm of latexFile] {Extractor};
\node (jsonFile) [tape,tape bend top=none,draw,font=\sffamily, right=0.5cm of extractor] {JSON file};
\node (start) [processBox, right=0.5cm of jsonFile] {JSON\_to\_calendar};
\node (MODSFile) [tape,tape bend top=none,draw,font=\sffamily, above of=jsonFile] {MODS file};

\node (calendarEvent) [destinationBox, right=1cm of start] {Canvas calendar event};
\node (announcement) [destinationBox,  above of =calendarEvent] {Canvas announcement};
\node (cortinaCalendarEvent) [destinationBox,  right=0.5cm of start, below of=calendarEvent] {KTH Cortina calendar event};
\draw [arrow] (latexFile) --  (extractor.west);
\draw [arrow] (PDFfile) --  (extractor.west);
\draw [arrow] (DOCXFile) --  (extractor.west);
\draw [arrow] (extractor) --  (jsonFile.west);
\draw [arrow] (jsonFile) --  (start.west);
\draw [arrow] (start.east) --  (announcement.west);
\draw [arrow] (start.east) -- (calendarEvent);
\draw [arrow] (start.east) -- (cortinaCalendarEvent.west);
\draw [arrow, dashed] (MODSFile) --  node[right] {only for testing} (start.west);
\end{tikzpicture}
}
\caption{Several possible inputs to JSON\_to\_calendar.py  and its outputs}
  \label{fig:severalPossibleInputs}
\end{figure}

\section{Request an ISBN}
\label{sec:requestISBN}
The web page at \href{https://www.kth.se/en/biblioteket/publicera-analysera/vagledning-for-publicering/bestall-isbn-1.854778}{Create an ISBN number} and be used to request an \gls{ISBN}.

This form requires the TRITA series and number, as well \first, as whether the request is for a Doctoral/licentiate thesis or Report, \Second the title of publication, and \third first authors': (a) last name, (b) first name, (c) KTH id, and (d) e-mail address. Fortunately, all of this information should be available in the \fname{fordiva.json}  file, so it should be possible to use this to request assignment of an \gls{ISBN}.

As all the required information is in the \fname{fordiva.json} file, the program \texttt{request-ISBN-with-JSON.py} at \url{https://github.com/gqmaguirejr/E-learning} can be used to automate the process of making a request for an ISBN. The program generates a \fname{assigned-ISBN.tex} file containing the assigned ISBN. This file can be uploaded to the project and will automatically be used rather than the placeholder in \fname{custom\_configuration.tex}.
It can be run as shown in \Cref{lst:requestISBN}.
\begin{lstlisting}[language={bash}, caption={Example of using request-ISBN-with-JSON.py}, label=lst:requestISBN]
    \texttt{./request-ISBN-with-JSON.py --json /tmp/fordiva.json}
\end{lstlisting}

\textbf{NB} This program should probably be changed to use the plain text version of the title and subtitle (if they are available).

\section{JSON to MODS file}
\label{sec:JSONtoMODSfile}
In keeping with the idea of using the JSON file to drive other applications, the program \texttt{JSON\_to\_MODS.py} creates a \gls{MODS} file using the information from the arguments and a \gls{JSON} file.
The program is patterned after the \texttt{JSON\_to\_calendar} program. The program outputs a \gls{MODS} file called: \texttt{modsXML.xml}. The program is run as shown in \Cref{lst:jsonToMods}.
\Needspace*{5\baselineskip}
\begin{lstlisting}[language={bash}, caption={Example of using JSON\_to\_MODS.py}, label=lst:jsonToMods]
./JSON_to_MODS.py -c 11   --json test12.json --trita "TRITA-EECS-EX-2021:219" --testing
\end{lstlisting}


Currently, the Canvas course information is \textbf{not} used. Note also that the “—testing” flag forces the report series to be  "TRITA-ICT-EX" overriding the actual series that is in the input version of the DiVA data. This is needed for testing with the test instance of \gls{DiVA}  -- as the test instance only has the old series names.

If acronyms are used in the abstracts, you can also add the ``\texttt{-\,-acronyms acronyms.tex}'' argument to the command line and the program will process the acronyms.

As noted above, you will get a file named \fname{modsXML.xml} that you can manually import into \gls{DiVA}. This process is shown in \Cref{sec:importingMODSfiletoDiVA}. I seem to be able to import these files into the test instance of \gls{DiVA}:	\url{https://kth.test.diva-portal.org/dream/import/importList.jsf}. Another side-effect of the testing flag is to use the test instance of DiVA. \textbf{NB}: The organization units are different between the production and test versions of \gls{DiVA}. When run without the testing flag set, the \gls{MODS} file can be imported into the production version of \gls{DiVA}.

This program has been extended to take the TRITA number information from the \gls{MODS} file.

\subsection{Example of JSON to MODS}
The process of importing the \gls{MODS} data into \gls{DiVA} begins with the extracted \gls{JSON} file (note that I have changed some of the formatting of the pseudo-JSON information and added the export of the program code). An example of the \gls{JSON} information is shown in \Cref{lst:test12.json}. The resulting \gls{MODS} file is shown in \Cref{lst:test12.mods}. [Note that there are errors in the order of unicode characters due to the use of \texttt{lstlisting}.]

\begin{lstlisting}[language={json}, caption={test12.json (manually reformatted)}, label=lst:test12.json]
{"Author1": {"Last name": "Student", "First name": "Fake A.", "Local User Id": "u100001", "E-mail": "a@kth.se", "organisation": {"L1": "School of Electrical Engineering and Computer Science "}}, 
"Author2": {"Last name": "Student", "First name": "Fake B.", "Local User Id": "u100002", "E-mail": "b@kth.se", "organisation": {"L1": "School of Architecture and the Built Environment "}}, 
"Degree": {"Educational program": "Bachelor’s Programme in Information and Communication Technology", "programcode": "TCOMK", "Level": "1", "Course code": "IA150X", "Credits": "15.0", "Exam": "Bachelors degree", "subjectArea": "Information and Communication Technology"},
"Title": {"Main title": "This is the title in the language of the thesis", "Subtitle": "An subtitle in the language of the thesis", "Language": "eng"},
"Alternative title": {"Main title": "Detta är den svenska översättningen av titeln", "Subtitle": "Detta är den svenska översättningen av undertiteln", "Language": "swe"},
"Supervisor1": {"Last name": "Supervisor", "First name": "A. Busy", "Local User Id": "u100003", "E-mail": "sa@kth.se", "organisation": {"L1": "School of Electrical Engineering and Computer Science ", "L2": "Computer Science"}},
"Supervisor2": {"Last name": "Supervisor", "First name": "Another Busy", "Local User Id": "u100003", "E-mail": "sb@kth.se", "organisation": {"L1": "School of Architecture and the Built Environment ", "L2": "Public Buildings"}}, 
"Supervisor3": {"Last name": "Supervisor", "First name": "Third Busy", "E-mail": "sc@tu.va", "Other organisation": "Timbuktu University, Department of Pseudoscience"},
"Examiner1": {"Last name": "Maguire Jr.", "First name": "Gerald Q.", "Local User Id": "u1d13i2c", "E-mail": "maguire@kth.se", "organisation": {"L1": "School of Electrical Engineering and Computer Science ", "L2": "Computer Science"}},
"Cooperation": {"Partner_name": "Företaget AB"}, "National Subject Categories": "10201, 10206", "Other information": {"Year": "2021", "Number of pages": "xxxiii,35"}, "Opponents": {"Name": "A. B. Normal & A. X. E. Normalè"}, "Presentation": {"Date": "2021-03-15 13:00", "Language": "eng", "Room": "via Zoom https://kth-se.zoom.us/j/ddddddddddd", "Address": "Isafjordsgatan 22 (Kistagången 16)", "City": "Stockholm"},
"Number of lang instances": "10", "abstracts": {"eng": "<p>All theses at KTH are <bold>required</bold> to have an abstract in both <i>English</i> and <i>Swedish</i>.</p><p>Exchange students many want to include one or more abstracts in the language(s) used in their home institutions to avoid the need to write another thesis when returning to their home institution.</p><p>Keep in mind that most of your potential readers are only going to read your <tt>title</tt> and <tt>abstract</tt>. This is why it is important that the abstract give them enough information that they can decide is this document relevant to them or not. Otherwise the likely default choice is to ignore the rest of your document.</p><p>A abstract should stand on its own, i.e., no citations, cross references to the body of the document, acronyms must be spelled out, … .</p><p>Write this early and revise as necessary. This will help keep you focused on what you are trying to do.</p><p>Write an abstract with the following components: </p><ul><li> What is the topic area? (optional) Introduces the subject area for the project. </li><li> Short problem statement </li><li> Why was this problem worth a Bachelor’s/’Masters thesis project? (i.e., why is the problem both significant and of a suitable degree of difficulty for a Bachelor’s/’Masters thesis project? Why has no one else solved it yet?) </li><li> How did you solve the problem? What was your method/insight? </li><li> Results/Conclusions/Consequences/Impact: What are your key results/conclusions? What will others do based upon your results? What can be done now that you have finished - that could not be done before your thesis project was completed?</li></ul><p>announcement of the oral presentation and for entering data into DiVA</p><p>\\pi \\cdot r$ or \\[ \\int_{a}^{b} x^2 \\,dx \\]</p><p></p><p> A<sup>*</sup>, A<sup>&reg;</sup>, and A&trade;.</p><p> first chemical formula can be handled, while the second will require hand editing</p>",
"swe": "<p>Alla avhandlingar vid KTH <bold>måste ha</bold> ett abstrakt på både <i>engelska</i> och <i>svenska</i>.</p><p>Om du skriver din avhandling på svenska ska detta göras först (och placera det som det första abstraktet) - och du bör revidera det vid behov.</p><p>If you are writing your thesis in English, you can leave this until the draft version that goes to your opponent for the written opposition. In this way you can provide the English and Swedish abstract/summary information that can be used in the announcement for your oral presentation.</p><p>If you are writing your thesis in English, then this section can be a summary targeted at a more general reader. However, if you are writing your thesis in Swedish, then the reverse is true – your abstract should be for your target audience, while an English summary can be written targeted at a more general audience.</p><p>This means that the English abstract and Swedish sammnfattning or Swedish abstract and English summary need not be literal translations of each other.</p><p>The abstract in the language used for the thesis should be the first abstract, while the Summary/Sammanfattning in the other language can follow.</p>",
"fre": "<p>Résumé en français.</p>", "spa": "<p>Résumé en espagnol.</p>", "ita": "<p>Sommario in italiano.</p>",
"nor": "<p>Sammendrag på norsk.</p>", "ger": "", "dan": "<p>Abstrakt på dansk.</p>",
"dut": "<p>Zusammenfassung in Deutsch.</p><p>Samenvatting in het Nederlands.</p><p>Eesti keeles kokkuvõte.</p>", "est": ""},
"keywords": {"eng": "Canvas Learning Management System, Docker containers, Performance tuning ",
"swe": "Canvas Lärplattform, Dockerbehållare, Prestandajustering\nNyckelord som beskriver innehållet i uppsatsrapporten\n",
"fre": "5-6 mots-clés ", "spa": "5-6 Palabras claves ", "ita": "5-6 parole chiave ",
"nor": "5-6 nøkkelord ", "ger": "5-6 Schlüsselwörter ", "dan": "5-6 Søgeord ",
"dut": "5-6 trefwoorden ", "est": "5-6 Märksõnad "}}
\end{lstlisting}

\clearpage

\begin{lstlisting}[language={XML}, caption={test12.mods (reformatted in EMACS using XML mode)}, label=lst:test12.mods]
<modsCollection xmlns="http://www.loc.gov/mods/v3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.loc.gov/mods/v3 http://www.loc.gov/standards/mods/v3/mods-3-2.xsd">
  <mods xmlns="http://www.loc.gov/mods/v3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" version="3.2" xsi:schemaLocation="http://www.loc.gov/mods/v3 http://www.loc.gov/standards/mods/v3/mods-3-2.xsd">
    <genre authority="diva" type="publicationTypeCode">studentThesis
    </genre>
    <genre authority="diva" type="publicationType" lang="swe">Studentuppsats (Examensarbete)
    </genre>
    <genre authority="diva" type="publicationType" lang="eng">Student thesis
    </genre>
    <genre authority="diva" type="publicationType" lang="nor">Oppgave
    </genre>
    <name type="personal" authority="kth" xlink:href="u100001">
      <namePart type="family">Student
      </namePart>
      <namePart type="given">Fake A.
      </namePart>
      <description>email=a@kth.se
      </description>
      <role>
	<roleTerm type="code" authority="marcrelator">aut
	</roleTerm>
      </role>
    </name>
    <name type="personal" authority="kth" xlink:href="u100002">
      <namePart type="family">Student
      </namePart>
      <namePart type="given">Fake B.
      </namePart>
      <description>email=b@kth.se
      </description>
      <role>
	<roleTerm type="code" authority="marcrelator">aut
	</roleTerm>
      </role>
    </name>
    <name type="personal" authority="kth" xlink:href="u1d13i2c">
      <namePart type="family">Maguire Jr.
      </namePart>
      <namePart type="given">Gerald Q.
      </namePart>
      <description>email=maguire@kth.se
      </description>
      <affiliation>KTH, School of Electrical Engineering and Computer Science, Computer Science
      </affiliation>
      <role>
	<roleTerm type="code" authority="marcrelator">mon
	</roleTerm>
      </role>
    </name>
    <name type="personal" authority="kth" xlink:href="u100003">
      <namePart type="family">Supervisor
      </namePart>
      <namePart type="given">A. Busy
      </namePart>
      <affiliation>School of Electrical Engineering and Computer Science, Computer Science
      </affiliation>
      <description>email=sa@kth.se
      </description>
      <role>
	<roleTerm type="code" authority="marcrelator">ths
	</roleTerm>
      </role>
    </name>
    <name type="personal" authority="kth" xlink:href="u100003">
      <namePart type="family">Supervisor
      </namePart>
      <namePart type="given">Another Busy
      </namePart>
      <affiliation>School of Architecture and the Built Environment, Public Buildings
      </affiliation>
      <description>email=sb@kth.se
      </description>
      <role>
	<roleTerm type="code" authority="marcrelator">ths
	</roleTerm>
      </role>
    </name>
    <name type="personal">
      <namePart type="family">Supervisor
      </namePart>
      <namePart type="given">Third Busy
      </namePart>
      <affiliation>Timbuktu University, Department of Pseudoscience
      </affiliation>
      <description>email=sc@tu.va
      </description>
      <role>
	<roleTerm type="code" authority="marcrelator">ths
	</roleTerm>
      </role>
    </name>
    <name>
      <namePart>KTH
      </namePart>
      <namePart> School of Electrical Engineering and Computer Science
      </namePart>
      <namePart> Computer Science
      </namePart>
      <role>
	<roleTerm type="code" authority="marcrelator">pbl
	</roleTerm>
      </role>
    </name>
    <titleInfo  lang="eng">
      <title>This is the title in the language of the thesis
      </title>
      <subTitle>An subtitle in the language of the thesis
      </subTitle>
    </titleInfo >
    <titleInfo  lang="swe" type="alternative">
      <title>Detta är den svenska översättningen av titeln
      </title>
      <subTitle>Detta är den svenska översättningen av undertiteln
      </subTitle>
    </titleInfo >
    <subject  lang="eng">
      <topic>Canvas Learning Management System
      </topic>
      <topic>Docker containers
      </topic>
      <topic>Performance tuning
      </topic>
    </subject >
    <subject  lang="swe">
      <topic>Canvas Lärplattform
      </topic>
      <topic>Dockerbehållare
      </topic>
      <topic>Prestandajustering Nyckelord som beskriver innehållet i uppsatsrapporten
      </topic>
    </subject >
    <subject  lang="fre">
      <topic>5-6 mots-clés
      </topic>
    </subject >
    <subject  lang="spa">
      <topic>5-6 Palabras claves
      </topic>
    </subject >
    <subject  lang="ita">
      <topic>5-6 parole chiave
      </topic>
    </subject >
    <subject  lang="nor">
      <topic>5-6 nøkkelord
      </topic>
    </subject >
    <subject  lang="ger">
      <topic>5-6 Schlüsselwörter
      </topic>
    </subject >
    <subject  lang="dan">
      <topic>5-6 Søgeord
      </topic>
    </subject >
    <subject  lang="dut">
      <topic>5-6 trefwoorden
      </topic>
    </subject >
    <subject  lang="est">
      <topic>5-6 Märksõnad
      </topic>
    </subject >
    <abstract  lang="eng">&lt;p&gt;All theses at KTH are &lt;bold&gt;required&lt;/bold&gt; to have an abstract in both &lt;i&gt;English&lt;/i&gt; and &lt;i&gt;Swedish&lt;/i&gt;.&lt;/p&gt;&lt;p&gt;Exchange students many want to include one or more abstracts in the language(s) used in their home institutions to avoid the need to write another thesis when returning to their home institution.&lt;/p&gt;&lt;p&gt;Keep in mind that most of your potential readers are only going to read your &lt;tt&gt;title&lt;/tt&gt; and &lt;tt&gt;abstract&lt;/tt&gt;. This is why it is important that the abstract give them enough information that they can decide is this document relevant to them or not. Otherwise the likely default choice is to ignore the rest of your document.&lt;/p&gt;&lt;p&gt;A abstract should stand on its own, i.e., no citations, cross references to the body of the document, acronyms must be spelled out, … .&lt;/p&gt;&lt;p&gt;Write this early and revise as necessary. This will help keep you focused on what you are trying to do.&lt;/p&gt;&lt;p&gt;Write an abstract with the following components: &lt;/p&gt;&lt;ul&gt;&lt;li&gt; What is the topic area? (optional) Introduces the subject area for the project. &lt;/li&gt;&lt;li&gt; Short problem statement &lt;/li&gt;&lt;li&gt; Why was this problem worth a Bachelor’s/’Masters thesis project? (i.e., why is the problem both significant and of a suitable degree of difficulty for a Bachelor’s/’Masters thesis project? Why has no one else solved it yet?) &lt;/li&gt;&lt;li&gt; How did you solve the problem? What was your method/insight? &lt;/li&gt;&lt;li&gt; Results/Conclusions/Consequences/Impact: What are your key results/conclusions? What will others do based upon your results? What can be done now that you have finished - that could not be done before your thesis project was completed?&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;announcement of the oral presentation and for entering data into DiVA&lt;/p&gt;&lt;p&gt;\pi \cdot r$ or &lt;span class='math-tex'&gt;\[ \int_{a}^{b} x^2 \,dx \]&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt; A&lt;sup&gt;*&lt;/sup&gt;, A&lt;sup&gt;&amp;reg;&lt;/sup&gt;, and A&amp;trade;.&lt;/p&gt;&lt;p&gt; first chemical formula can be handled, while the second will require hand editing&lt;/p&gt;
    </abstract >
    <abstract  lang="swe">&lt;p&gt;Alla avhandlingar vid KTH &lt;bold&gt;måste ha&lt;/bold&gt; ett abstrakt på både &lt;i&gt;engelska&lt;/i&gt; och &lt;i&gt;svenska&lt;/i&gt;.&lt;/p&gt;&lt;p&gt;Om du skriver din avhandling på svenska ska detta göras först (och placera det som det första abstraktet) - och du bör revidera det vid behov.&lt;/p&gt;&lt;p&gt;If you are writing your thesis in English, you can leave this until the draft version that goes to your opponent for the written opposition. In this way you can provide the English and Swedish abstract/summary information that can be used in the announcement for your oral presentation.&lt;/p&gt;&lt;p&gt;If you are writing your thesis in English, then this section can be a summary targeted at a more general reader. However, if you are writing your thesis in Swedish, then the reverse is true – your abstract should be for your target audience, while an English summary can be written targeted at a more general audience.&lt;/p&gt;&lt;p&gt;This means that the English abstract and Swedish sammnfattning or Swedish abstract and English summary need not be literal translations of each other.&lt;/p&gt;&lt;p&gt;The abstract in the language used for the thesis should be the first abstract, while the Summary/Sammanfattning in the other language can follow.&lt;/p&gt;
    </abstract >
    <abstract  lang="fre">&lt;p&gt;Résumé en français.&lt;/p&gt;
    </abstract >
    <abstract  lang="spa">&lt;p&gt;Résumé en espagnol.&lt;/p&gt;
    </abstract >
    <abstract  lang="ita">&lt;p&gt;Sommario in italiano.&lt;/p&gt;
    </abstract >
    <abstract  lang="nor">&lt;p&gt;Sammendrag på norsk.&lt;/p&gt;
    </abstract >
    <abstract  lang="ger" />
    <abstract  lang="dan">&lt;p&gt;Abstrakt på dansk.&lt;/p&gt;
    </abstract >
    <abstract  lang="dut">&lt;p&gt;Zusammenfassung in Deutsch.&lt;/p&gt;&lt;p&gt;Samenvatting in het Nederlands.&lt;/p&gt;&lt;p&gt;Eesti keeles kokkuvõte.&lt;/p&gt;
    </abstract >
    <abstract  lang="est" />
    <physicalDescription>
      <form authority="marcform">electronic
      </form>
      <extent>xxxiii,35
      </extent>
    </physicalDescription>
    <originInfo>
      <place>
	<placeTerm>Stockholm
	</placeTerm>
      </place>
      <publisher>KTH Royal Institute of Technology
      </publisher>
      <dateIssued>2021
      </dateIssued>
      <dateOther type="defence">2021-03-15T13:00:00
      </dateOther>
    </originInfo>
    <typeOfResource>text
    </typeOfResource>
    <relatedItem  type="series">
      <titleInfo>
	<title>TRITA-ICT-EX
	</title>
	<identifier type="local">5952
	</identifier>
	<identifier type="issue number">2021:219
	</identifier>
      </titleInfo>
    </relatedItem >
    <note lang="swe" type="level">Självständigt arbete på grundnivå (kandidatexamen)
    </note>
    <note lang="eng" type="degree">Bachelors degree
    </note>
    <note lang="swe" type="universityCredits">10 poäng / 15 hp
    </note>
    <subject lang="swe" xlink:href="10329">
      <topic>Informations- och kommunikationsteknik
      </topic>
      <genre>Subject/course
      </genre>
    </subject>
    <subject lang="eng" xlink:href="10329">
      <topic>Information and Communication Technology
      </topic>
      <genre>Subject/course
      </genre>
    </subject>
    <subject lang="swe" xlink:href="9925">
      <topic>Teknologie kandidatexamen - Informations- och kommunikationsteknik
      </topic>
      <genre>Educational program
      </genre>
    </subject>
    <subject lang="eng" xlink:href="9925">
      <topic>Bachelor of Science - Information and Communication Technology
      </topic>
      <genre>Educational program
      </genre>
    </subject>
    <language objectPart="defence">
      <languageTerm type="code" authority="iso639-2b">eng
      </languageTerm>
    </language>
    <note type="venue">via Zoom https://kth-se.zoom.us/j/ddddddddddd,Isafjordsgatan 22 (Kistagången 16),Stockholm
    </note>
    <note type="cooperation">Företaget AB
    </note>
    <subject lang="eng" authority="hsv" xlink:href="10201">
      <topic>Natural Sciences
      </topic>
      <topic>Computer and Information Sciences
      </topic>
      <topic>Computer Sciences
      </topic>
    </subject>
    <subject lang="swe" authority="hsv" xlink:href="10201">
      <topic>Naturvetenskap
      </topic>
      <topic>Data- och informationsvetenskap
      </topic>
      <topic>Datavetenskap (datalogi)
      </topic>
    </subject>
    <subject lang="eng" authority="hsv" xlink:href="10206">
      <topic>Natural Sciences
      </topic>
      <topic>Computer and Information Sciences
      </topic>
      <topic>Computer Engineering
      </topic>
    </subject>
    <subject lang="swe" authority="hsv" xlink:href="10206">
      <topic>Naturvetenskap
      </topic>
      <topic>Data- och informationsvetenskap
      </topic>
      <topic>Datorteknik
      </topic>
    </subject>
  </mods>
</modsCollection>
\end{lstlisting}
	
\subsection{Importing MODS file to DiVA}
\label{sec:importingMODSfiletoDiVA}

\Cref{fig:divaImport1} to \Cref{fig:divaImport4} show the process of importing the \gls{MODS} file into \gls{DiVA}. Note that it skips the first user interface form (as this differs between users).

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/import-1-Screenshot_20210626_234259.png}}
  \end{center}
  \caption[The import process – step 1]{The import process – step 1 – click on the “Import from external database” button on the upper right corner}
  \label{fig:divaImport1}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.9\textwidth]{README_notes/README-examiner-figures/import-2-Screenshot_20210626_234414.png}}
  \end{center}
  \caption[The import process – step 2]{The import process – step 2 – choose the MODV3 format and select a file to import}
  \label{fig:divaImport2}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.95\textwidth]{README_notes/README-examiner-figures/import-3-Screenshot_20210626_234447.png}}
  \end{center}
  \caption[The import process – step 3]{The import process – step 3 – after clicking “Import” – it says that the file was successfully uploaded
Click on “Import” again to load the file. The \gls{MODS} file is loaded and shown in \Cref{fig:divaImport4}.}
  \label{fig:divaImport3}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/import-4-Screenshot_20210626_234519.png}}
  \end{center}
  \caption[The import process – step 4]{The import process – step 4 – after clicking “Import” once more – you can see the file has been added to the list of imported files The imported document is shown in \Cref{fig:divaImport5} to \Cref{fig:divaImport12}.}
  \label{fig:divaImport4}
\end{figure}
\FloatBarrier
\clearpage
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.75\textwidth]{README_notes/README-examiner-figures/import-a-Screenshot_20210626_234606.png}}
  \end{center}
  \caption[Imported document (part 1)]{Imported document (part 1)}
  \label{fig:divaImport5}
\end{figure}
\FloatBarrier
\clearpage

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.55\textwidth]{README_notes/README-examiner-figures/import-b-Screenshot_20210626_234640.png}}
  \end{center}
  \caption[Imported document (part 2)]{Imported document (part 2) – Note that both the English and Swedish titles are shown as well as the information about which level, the number of university credits, the educational program, and the subject.- Additionally, the year and number of pages are shown.}
  \label{fig:divaImport6}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.6\textwidth]{README_notes/README-examiner-figures/import-c-Screenshot_20210626_234710.png}}
  \end{center}
  \caption[Imported document (part 3)]{Imported document (part 3) – Note that the number in the series is not being shown. The nation subject catergies specified in the JSON file are shown. Additionally, a number of the keyoards in different languages are shown.}
  \label{fig:divaImport7}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.55\textwidth]{README_notes/README-examiner-figures/import-d-Screenshot_20210626_234735.png}}
  \end{center}
  \caption[Imported document (part 4)]{Imported document (part 4) – more keywords are shown as well as the abstract in English}
  \label{fig:divaImport8}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.6\textwidth]{README_notes/README-examiner-figures/import-e-Screenshot_20210626_235408.png}}
  \end{center}
  \caption{[Imported document (part 5)]Imported document (part 5) – the bottom of the Engish abstract is shown .- showing some of the formatted information that can be shown. Additionally, the Swedish and other abstracts are shown.}
  \label{fig:divaImport9}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.6\textwidth]{README_notes/README-examiner-figures/import-f-Screenshot_20210626_235447.png}}
  \end{center}
  \caption[Imported document (part 6)]{Imported document (part 6) – yet more abstracts}
  \label{fig:divaImport10}
\end{figure}
\FloatBarrier
\Cref{fig:divaImport11} shows the three supervisors. The first two have KTH affiliations and the third is from an external organization.
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.6\textwidth]{README_notes/README-examiner-figures/import-g-Screenshot_20210626_235510.png}}
  \end{center}
  \caption[Imported document (part 7)]{Imported document (part 7) – the supervisors are shown}
  \label{fig:divaImport11}
\end{figure}
\newpage

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/import-h-Screenshot_20210626_235557.png}}
  \end{center}
  \caption[Imported document (part 8)]{Imported document (part 8) – the examiner is shown along with the information about the oral presentation}
  \label{fig:divaImport12}
\end{figure}
\clearpage


\subsection{Limitations}
I was initially unable to get the KTH affiliations correctly entered. I did not understand the description of how to do this at: \url{ https://wiki.epc.ub.uu.se/pages/viewpage.action?pageId=27466001}  where it says:
\selectlanguage{swedish}
\begin{quote}
    För att göra en sådan koppling skall dels ”affiliation” finnas i personelementet dels ett name-element med ID i xlink:href samt ett namePart-element med samma namn som affiliation. Om man har bägge nedanstående element i exemplet kommer Urban Ericsson automatiskt att kopplas till Universitetsbiblioteket i Uppsala vid importen. Om enbart personelementet finns men inte det andra kommer Urban Ericsson att få Uppsala universitet, Universitetsbiblioteket som ”Annat lärosäte” vid imported.
\end{quote}

\selectlanguage{english}
I did not find any examples of how to do what they describe. The result is that all of my affiliation information ended up in the "Other university" field.

I was also unable to get the issue number to appear, even though it seems to be set, since if you click on the box after the \gls{MODS} import, it knows the value.  Note that for testing, I forced the TRITA series to be "TRITA-ICT-EX" since this is the actual series that is in the earlier (test) version of DiVA.

Finally, it seems that DiVA does not import the cooperation data at all: according to \url{https://wiki.epc.ub.uu.se/display/divainfo/Externt+samarbete}.

The first two limitations were overcome as described in \Cref{sec:limitationsOvercome}.

\warningExpl{The current version of the program does not support the UN's Sustainable Development Goals (SDGs) metadata (as this metadata field was introduced after the program was written).}

\subsection{Limitations overcome}
\label{sec:limitationsOvercome}
This section describes how two of the limitations were overcome.

\subsubsection{Entering number in series}
The first limitation to be overcome was entering the particular number in the series for a TRITA number. \Cref{fig:numberInSeriesCorrectlyEntered} shows the value being entered. The error was in the structure of the object, the working version is shown in \Cref{lst:seriesNumber}. My earlier error was due to having the \texttt{<identifier type="issue number">2021:00</identifier>} \textit{within} the \texttt{<titleInfo>}.
 
 
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/Number_in_series_correctly_entered.png}}
  \end{center}
  \caption{Number in series correctly entered}
  \label{fig:numberInSeriesCorrectlyEntered}
\end{figure}
\Needspace*{8\baselineskip}
\begin{lstlisting}[language={XML}, caption={MODS data for series}, label=lst:seriesNumber]
<relatedItem  type="series">
	      <titleInfo><title>TRITA-EECS-EX</title>
		<identifier type="local">16855</identifier>
	      </titleInfo>
	      <identifier type="issue number">2021:00</identifier>
</relatedItem >
\end{lstlisting}

\FloatBarrier

\subsubsection{Including KTH affiliations}
Earlier, those with KTH affiliations were appearing in the “Other organization” field. The error in my understanding was how the controlled fields for KTH authors was being used\footnote{These so-called "controlled" fields have specific values that are permitted and these have numeric IDs assigned by the DiVA Consortium.}. We will start by looking at the two KTH-affiliated supervisors (see \Cref{fig:twoKTHsupervisors}), the third supervisor (see \Cref{fig:thirdSupervisor}), and the examiner (see \Cref{fig:examiner}). The \gls{MODS} data for these four people is shown in \Cref{lst:reducedModesExaminerAndSupervisors} and the “magic” \textbf{corporate name} \gls{MODS} data is shown in \Cref{lst:reducedModesCorpNames}. The trick is that there needs to be corporate name \gls{MODS} data for each of the possible affiliations – as this is the way that one passes the \gls{DiVA} numeric code via the \texttt{xlink} information. Note that in the case of the examiner, two different affiliations were specified and there was a corporate name entry for each of them. Moreover, the key is just to have test extra corporate name entries, only one is needed for the publishers, as shown in \Cref{lst:reducedModesCorpNames} – with the results in \Cref{fig:twoSupervisorsReducedMODS} and shown \Cref{fig:examinerReducedMODS}.

\textbf{NB}: The ICT affiliations (and \gls{DiVA} codes) were used and the pictures are all from the test DiVA environment: \url{https://kth.test.diva-portal.org/dream/import/importList.jsf}.

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.85\textwidth]{README_notes/README-examiner-figures/two_KTH_supervisors_in_different_schools.png}}
  \end{center}
  \caption{Two KTH supervisors in different schools}
  \label{fig:twoKTHsupervisors}
\end{figure}
\FloatBarrier
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/third_supervisor.png}}
  \end{center}
  \caption{Third supervisor}
  \label{fig:thirdSupervisor}
\end{figure}
\FloatBarrier
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/examiner_affiliation.png}}
  \end{center}
  \caption{Examiner}
  \label{fig:examiner}
\end{figure}
\clearpage

\begin{lstlisting}[language={XML}, caption={MODS data for the supervisors and examiners}, label=lst:reducedModesExaminerAndSupervisors]
<name type="personal" authority="kth" xlink:href="u1d13i2c">
      <namePart type="family">Maguire Jr.</namePart>
      <namePart type="given">Gerald Q.</namePart>
      <description>email=maguire@kth.se</description>
      <affiliation>KTH, Skolan för informations- och kommunikationsteknik (ICT), Kommunikationssystem, CoS</affiliation>
      <affiliation>KTH, Skolan för informations- och kommunikationsteknik (ICT)</affiliation>
      <role><roleTerm type="code" authority="marcrelator">mon</roleTerm></role>
</name>

<name type="personal" authority="kth" xlink:href="u100003">
      <namePart type="family">Supervisor</namePart>
      <namePart type="given">A. Busy</namePart>
      <affiliation>KTH, Skolan för informations- och kommunikationsteknik (ICT)</affiliation>
      <description>email=sa@kth.se</description>
      <role><roleTerm type="code" authority="marcrelator">ths</roleTerm></role>
</name>

<name type="personal" authority="kth" xlink:href="u100003">
      <namePart type="family">Supervisor</namePart>
      <namePart type="given">Another Busy</namePart>
      <affiliation>KTH, Skolan för arkitektur och samhällsbyggnad (ABE)</affiliation>
      <description>email=sb@kth.se</description>
      <role><roleTerm type="code" authority="marcrelator">ths</roleTerm></role>
</name>

<name type="personal">
      <namePart type="family">Supervisor</namePart>
      <namePart type="given">Third Busy</namePart>
      <affiliation>Timbuktu University, Department of Pseudoscience</affiliation>
      <description>email=sc@tu.va</description>
      <role><roleTerm type="code" authority="marcrelator">ths</roleTerm></role>
</name>
\end{lstlisting}
\clearpage

\begin{lstlisting}[language={XML}, caption={Corporate name data in MODS data for the affiliations}, label=lst:reducedModesCorpNames]
<name type="corporate" authority="kth" xlink:href="5994">
      <namePart>KTH</namePart>
      <namePart>Skolan för informations- och kommunikationsteknik (ICT)</namePart>
      <role><roleTerm type="code" authority="marcrelator">pbl</roleTerm></role>
</name>

<name type="corporate" authority="kth" xlink:href="5998">
      <namePart>KTH</namePart>
      <namePart>Skolan för informations- och kommunikationsteknik (ICT)</namePart>
      <namePart>Kommunikationssystem, CoS</namePart>
      <role><roleTerm type="code" authority="marcrelator">pbl</roleTerm></role>
</name>

<name type="corporate" authority="kth" xlink:href="5850">
      <namePart>KTH</namePart>
      <namePart>Skolan för arkitektur och samhällsbyggnad (ABE)</namePart>
      <role><roleTerm type="code" authority="marcrelator">pbl</roleTerm></role>
</name>
\end{lstlisting}

\begin{lstlisting}[language={XML}, caption={Reduced MODS for corporate names more}, label=lst:reducedModesCorpNamesMore]
<name type="corporate" authority="kth" xlink:href="5994">
      <namePart>KTH</namePart>
      <namePart>Skolan för informations- och kommunikationsteknik (ICT)</namePart>
      <role><roleTerm type="code" authority="marcrelator">pbl</roleTerm></role>
</name>
<name type="corporate" authority="kth" xlink:href="5998">
      <namePart>KTH</namePart>
      <namePart>Skolan för informations- och kommunikationsteknik (ICT)</namePart>
      <namePart>Kommunikationssystem, CoS</namePart>
</name>
<name type="corporate" authority="kth" xlink:href="5850">
      <namePart>KTH</namePart>
      <namePart>Skolan för arkitektur och samhällsbyggnad (ABE)</namePart>
</name>
\end{lstlisting}
\clearpage

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.9\textwidth]{README_notes/README-examiner-figures/two_supervisors_reduced_mods.png}}
  \end{center}
  \caption{The two supervisors with the reduced MODS for corporate names}
  \label{fig:twoSupervisorsReducedMODS}
\end{figure}

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.9\textwidth]{README_notes/README-examiner-figures/examiner_with_reduced_mods.png}}
  \end{center}
  \caption{The examiner with the reduced MODS for corporate names}
  \label{fig:examinerReducedMODS}
\end{figure}
\clearpage


\section{Accessibility}
\label{sec:accessibility}
The discussion of accessibility has been divided into accessibility of the calendar entries (see \Cref{sec:accessibilityOfCalendarEntries}), the cover and \gls{PDF} files (see \Cref{sec:ccessibilityOfCoverandPDF}), and the template itself (see \Cref{sec:ccessibilityOfTemplateItself}). There is also a subsection regarding improving accessibility (see \Cref{sec:improvingAccessibility}).

\subsection{Calendar entries}
\label{sec:accessibilityOfCalendarEntries}
The calendar entries that are generated in the Canvas course room are as accessible as all content in Canvas (as Instructure tries to follow the W3C \gls{WCAG}). The European standard EN 301 549 V2.1.2 (based upon WACG 2.1) are the accessibility guidelines for web content that are recommended in Sweden by \gls{DIGG}, based upon the presentation by Tommy Olsson of \gls{DIGG} to the SUNET SALSA group\footnote{\url{https://wiki.sunet.se/pages/viewpage.action?pageId=30441654}} on 2021-06-03. Moreover, the contents are \gls{HTML} language-tagged, so that a text-to-speech program that has access within Canvas (such as ReaderSpaker (when run as an \gls{LTI} app)) could read the content with the correct pronunciation for each of the two languages. Note that KTH’s current screen reader solution does \textbf{not} access the \gls{HTML} of the page and hence it does not use the language tags, thus the user must manually choose the language for output.

The calendar entries in the \gls{KTH} Calendar are in the same format as the current calendar entries. The structure of these entries has been developed in consultation with XXXXXX (who works with the \gls{KTH} Web) and the \gls{KTH} Calendar \gls{API} developer XXXXX, together with the additional help of XXXXXX. Note that the last of these was the original developer of the \gls{KTH} cover generator.

\subsection{Cover and PDF file}
\label{sec:ccessibilityOfCoverandPDF}
The \gls{PDF} metadata (author(s), title(s), keywords, \etc) is accessible to any programs that use the \gls{PDF} metadata (this is a standard feature of \gls{PDF} files). Unfortunately, there are no provisions for language markup for this data.

No investigation has been made of the accessibility of the KTH cover nor of the contents of the \gls{PDF} file (\ie the thesis itself). The \gls{PDF} output by Overleaf appears to be \gls{PDF} version 1.5 (\ie thus it is accessible via Acrobat version 6 or later). The \fname{examplethesis.tex} file has code to change this version.

The template utilizes color in conjunction with the \texttt{hyperref} colors and \texttt{todonotes}. The \texttt{hyperref} colors are defined as shown in \Cref{lst:colors}.
\Needspace*{12\baselineskip}
\begin{lstlisting}[language={[LaTeX]TeX}, caption={\textbackslash hypersetup}, label=lst:setupHyperRef]
\hypersetup{
	colorlinks  = true,
	breaklinks  = true,
	linkcolor   = \linkscolor,
	urlcolor    = \urlscolor,
	citecolor   = \refscolor,
	anchorcolor = black
}
\end{lstlisting}
Where the colors are defined as (note that the ForestGreen lacks sufficient contrast for readability -- so another color should be used to replace it) as shown in \Cref{lst:colors}.

\Needspace*{6\baselineskip}
\begin{lstlisting}[language={[LaTeX]TeX}, caption={Some colors for hyper references }, label=lst:colors]
\definecolor{ForestGreen} {RGB}{34,  139,  34}
\definecolor{HeraldRed2}   {rgb}{0.81, 0.12, 0.15}

\newcommand{\refscolor} {blue}
\newcommand{\linkscolor}{HeraldRed2}
\newcommand{\urlscolor} {ForestGreen}
\end{lstlisting}

Note that the colors do \textbf{not} encode any essential meaning (\ie they could all be turned to black), since the citations are recognizable by their format, the URL (and URI) by linking to an external document, and the links (by linking within the document).

Some additional colors are defined and used for \texttt{todonotes} – they should, of course, be removed before the thesis is finalized (as of course all of these issues should have been resolved!). The default background color for todonotes is orange (which is predefined as \#FF7F00). The other colors are shown in \Cref{lst:todonotesColors}. The KTH colors are defined in \texttt{kthcolors.tex}.
\begin{lstlisting}[style=latexExampleForAuthors, caption={Defines for todo notes}, label=lst:todonotesColors]
%% Conventions for todo notes:
% Informational
%% \generalExpl{Comments/directions/... in English}
\newcommand*{\generalExpl}[1]{\todo[inline]{#1}}

% Language-specific information (currently in English or Swedish)
\newcommand*{\engExpl}[1]{\todo[inline, backgroundcolor=kth-lightgreen40]{#1}} %% \engExpl{English descriptions about formatting}
\newcommand*{\sweExpl}[1]{\todo[inline, backgroundcolor=kth-lightblue40]{\foreignlanguage{swedish}{#1}}}  %% % \sweExpl{Text på svenska}

% warnings
\newcommand*{\warningExpl}[1]{\todo[inline, backgroundcolor=kth-lightred40]{#1}} %% \warningExpl{warnings}
\end{lstlisting}

\subsection{Template itself}
\label{sec:ccessibilityOfTemplateItself}
The template itself is written in \LaTeX{}~using UTF-8 characters. The template uses packages from \textit{TeX Live version 2024}. It must be compiled with \LuaLaTeX{}  (which natively supports UTF-8 input).

The template is designed with a set of options to generate a thesis in English or Swedish\footnote{The option names for both languages are must be given in title case, \ie with initial capital letters.} and to use either \textsc{Bib}\TeX~ or \textsc{Bib}\LaTeX, as explained at the top of the \fname{examplethesis.tex} file (see \Cref{lst:document}).
\Needspace*{8\baselineskip}
\begin{lstlisting}[language={[LaTeX]TeX}, caption={\textbackslash documentclass}, label=lst:document]
% --- Configure the documentclass ---
%% The template is designed to handle a thesis in English or Swedish
%%
\documentclass[
English,                 % the language of the body of the document: English or Swedish
biblatex,                % the bibliographic processor to use: biblatex or bibtex
%includepublications,    % uncomment - if you want to include publications for a compilation thesis - also creates divider pages
%includeExtraAbstracts, % uncomment to allow abstracts in languages beyond English & Swedish
%nomenclature,           % add the option nomenclature
%digitaloutput,          % optimize for digital output (this changes the color palette)
%final,                   % turn off all of the todo notes
]{kththesis}

\end{lstlisting}

The template is available from Overleaf (via a share URL).

The text in the template itself (\ie the \texttt{examplethesis.tex} file) is in Swedish and English. The notes regarding the \LaTeX{}~class file, the various \fname{lib} files, and the various \fname{README} files are currently only in English.

The default bibliographic style when using \textsc{Bib}\TeX~is my own adaptation of the IEEE Transactions format (\ie numbered citations, numbered references, references in order of use) with the extension of adding DOIs, URLs, and ISBNs (when relevant).

\subsection{Improving accessibility}
\label{sec:improvingAccessibility}
One method for improving accessibility would be to include the accessibility package, \ie \textbackslash usepackage\{axessibility\} as this would include a comment in the \gls{PDF} file for each equation with the \LaTeX that generated the equation. However, this package is no longer maintained and is incompatible with many other packages. For an introduction to what the \LaTeX{}-project has been working on, see ``LATEX Tagged PDF -- A blueprint for a large Project''\cite{MittelbachRowley2020}. Based upon this article and the status of the \texttt{tagpdf} package, I conclude that it is too early to worry about properly tagging \gls{PDF} files; thus, doing so will have to await the release of a package designed for production use.

\section{The structure of the template and the report}
\label{sec:structureOfTheTemplate}
The report in itself (\ie the thesis in \fname{examplethesis.tex}) has a classical \gls{IMRAD} structure. In some subject areas, such as mathematics there is a tradition for another structure.
The files and folders in Overleaf have the form shown in \Cref{fig:overleafFoldersAndFiles}. Some students add folders per chapter and reduce the main document to a skeleton that includes the other parts of the document.
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.5\textwidth]{README_notes/README-examiner-figures/Overleaf-files-and-folders-20250605.png}}
  \end{center}
  \caption{Files and folders in Overleaf template}
  \label{fig:overleafFoldersAndFiles}
\end{figure}
\FloatBarrier

There are currently instructions concerning the template in the \texttt{README\_notes/README\_notes\_reduced.tex} file\footnote{You will need to compile it separately.}. 
Ideally, these instructions should be available in both English and Swedish; however, a Swedish version remains as future work.

Most students will only need to add acronyms to the \texttt{acronyms.tex} file and perhaps additional packages to \texttt{includes.tex} (in some cases, these packages may need to be added to the \texttt{includes-after-hyperref.tex} file if there is a conflict with \texttt{hyperref}).

The \texttt{school\_subjects\_3rdcycle.ins} contents were generated from the data in LADOK. Students should not have to change this file.



\section[Generating LaTeX commands for in the student’s thesis source files]{Generating LaTeX commands for in the\linebreak[4] student’s thesis source files}
\label{sec:GeneratingLatexCommands}
The thesis makes use of a set of \LaTeX{}~commands to collect information about the student and the supervisor(s) in the \texttt{custom\_configuration.tex} file. However, how can a student know what their KTHID and other necessary information is?

There are two alternatives:
\begin{itemize}
    \item The main supervisor or someone can use the method described in section ``Make it simple from the start'' in the file \texttt{README\_supervisor\_notes}.

    \item One can use the program: \texttt{whoami\_for\_latex.py} - see the command shown in \Cref{lst:swhoamiInfo}\footnote{As this version of the program only uses Canvas and does not use LADOK, it excludes program information}; as Canvas does not currently have any source for the student's program information.
\end{itemize}

\begin{lstlisting}[style=latexExampleForAuthors, caption={Getting information regarding supervisor}, label=lst:swhoamiInfo]
./whoami_for_latex.py email course_id [supervisor_index]
\end{lstlisting}
The course\_id has to be the canvas\_id of a course where the supervisor is enrolled (as student, teacher, $\ldots$ ). If supervisor\_index is not specified, it defaults to "A".

\warningExpl{While it might seem desirable to incorporate this diretly in the \LaTeX{} project, there are two reasons to avoid this: \first I am not sure that student's would want to or should put their Canvas access token into a project in Overleaf -- as this seems to be a security issue (since others will potentially access this project.) and \Second this only needs to be done at the start of the project and then does not need to be done again.}

\section[Copyright or Creative Commons License]{Copyright or Creative Commons\\ License}
\label{sec:copyrightOrCClicenseExaminer}
It is possible to have several variants of the bookinfo page:
\begin{enumerate}[labelwidth =\widthof{\textbf{Creative Commons (CC)}}, leftmargin = !]
    \item[copyright] If you want to have a bookinfo page, include the line saying \texttt{\textbackslash bookinfopage}.
    \item[Creative Commons (CC)] If you want to have a bookinfo page but want to have a Creative Commons license, then include \texttt{\textbackslash bookinfopage} and use and configure the \texttt{doclicense} package as shown in Listings \ref{lst:CCBY-NC-ND}, \ref{lst:CCBY-NC-ND-euro}, and \ref{lst:CCzero}.
    \item[none] If you do \textbf{not} want to have a bookinfo page, comment the line saying \texttt{\textbackslash bookinfopage} and add a \texttt{\textbackslash cleardoublepage}.
\end{enumerate}

For background about Creative Commons licenses, see:
\url{https://www.kb.se/samverkan-och-utveckling/oppen-tillgang-och-bibsamkonsortiet/open-access-and-bibsam-consortium/open-access/creative-commons-faq-for-researchers.html} and \url{https://kib.ki.se/en/publish-analyse/publish-your-article-open-access/open-licence-your-publication-cc}.

Note that the lowercase version of the license has to be used in the modifier, \ie one of: by, by-nc, by-nd, by-nc-nd, by-sa, by-nc-sa, or zero. For the list of supported licenses, see the documentation for the \texttt{doclicense} package.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Example configuration to have a CC BY-NC-ND license}, label=lst:CCBY-NC-ND]
\usepackage[
    type={CC},
    modifier={by-nc-nd},
    version={4.0},
    hyphenation={RaggedRight},
]{doclicense}
\end{lstlisting}

Note that the option ``hyphenation={RaggedRight}'' can be used with the configuration of the package to set the license information with a ragged right margin rather that as a filled and justified paragraph.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Example configuration to have a CC BY-NC-ND license with a Euro symbol rather than a Dollar sign}, label=lst:CCBY-NC-ND-euro]
\usepackage[
    type={CC},
    modifier={by-nc-nd},
    version={4.0},
    imagemodifier={-eu-88x31},  % to get Euro symbol rather than Dollar sign
    hyphenation={RaggedRight},
]{doclicense}
\end{lstlisting}

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Example configuration to have a CC0 license}, label=lst:CCzero]
\usepackage[
    type={CC},
    modifier={zero},
    version={1.0},
]{doclicense}
\end{lstlisting}


For someone who is maintaining or modifying the template, it is important to know that the \texttt{\textbackslash bookinfopageCC} command has a case statement in it that uses an internal variable (\texttt{\textbackslash doclicense@modifier}) set by \texttt{doclicense} as shown in~\Cref{lst:bookinfopageCCcaseSTMT}. This case statement will need to be modified if there is a change in the set of Creative Commons licenses. While it might be possible to replace this case statement with \texttt{\textbackslash doclicenseModifier} to directly produce the capitalized version of the license names or perhaps even \texttt{\textbackslash doclicenseName} or \texttt{\textbackslash doclicenseNameRef} to include the capitalized license name as well as the version number (the latter also including a URL to the license). However, I think that these alternatives are unnecessary given the \texttt{\textbackslash doclicenseThis} that generates the display of the license with logo(s). More importantly, using these other commands rather than the unprocessed \texttt{\textbackslash doclicense@modifier} leads to problems when writing out the \texttt{fordiva.json} file.

Note that if the \texttt{doclicense} package is used it automatically redefines \texttt{\textbackslash bookinfopage} to be \texttt{\textbackslash bookinfopageCC}.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Case statement in \textbackslash bookinfopageCC}, label=lst:bookinfopageCCcaseSTMT]
  \IfEqCase{\doclicense@modifier}{%
    {by}{CC BY}%
    {by-nc}{CC BY-NC}%
    {by-nd}{CC BY-ND}%
    {by-nc-nd}{CC BY-NC-ND}%
    {by-sa}{CC BY-SA}%
    {by-nc-sa}{CC BY-NC-SA}%
    {zero}{CC0}%
  }[\typeout{Creative Commons code  \doclicense@modifier not found}\copyright]
\end{lstlisting}

There is a new \texttt{\textbackslash thesiscopyrightleft} command added to the \texttt{\textbackslash bookinfopage} and \texttt{\textbackslash bookinfopageCC} pages to store the value of the copyright or copyleft information that the user chose (if any). This information is later output as information for DiVA in the form shown in \Cref{lst:bookinfoCopyrightselected,lst:bookinfoCopyleftselected,lst:bookinfoNoneselected}
\begin{lstlisting}[language=json, caption={If the user chose to have a copyright on the bookinfo page}, label=lst:bookinfoCopyrightselected]
"Copyrightleft": "copyright"
\end{lstlisting}

\begin{lstlisting}[language=json, caption={If the user chose to have a CC BY-NC license on the bookinfo page}, label=lst:bookinfoCopyleftselected]
"Copyrightleft": "by-nc"
\end{lstlisting}

\begin{lstlisting}[language=json, caption={If the user chose \textbf{not} to have a bookinfo page}, label=lst:bookinfoNoneselected]
"Copyrightleft": "None"
\end{lstlisting}

As a result of adding support for the \gls{PDF} metadata for the copyright, the template now uses the \texttt{hyperxmp} package. Details of the code to set the value of the pdfcopyright metadata can be seen in \Cref{lst:bookinfopageCopyrightPDFmetadata}.
The use of \texttt{hyperxmp} caused a change in how the author's name is processed - for details about this see \Cref{sec:addingKeywordsAndMetaDataToPDF} starting on page~\pageref{sec:addingKeywordsAndMetaDataToPDF}.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Processing copyright PDF metadata information in \textbackslash bookinfopageCC}, label=lst:bookinfopageCopyrightPDFmetadata]
% Command to print out the standardized document information page
\newcommand{\bookinfopage}{
\ifgfivepaper
  \newgeometry{top=140mm,bottom=30mm,left=12.25mm,right=35mm}
\else
  \newgeometry{top=250mm,bottom=30mm,left=74pt,right=35mm}
\fi
\thispagestyle{empty}
\begin{flushleft}
  \sffamily
  \copyright\enspace\the\year\quad\@authorsFirstname\space\@authorsLastname 
  \ifx\@secondAuthorsLastname\@empty\relax
  \else
    \ifinswedish
      \enspace och\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \else
      \enspace and\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \fi
  \fi
\end{flushleft}
\thesiscopyrightleft{copyright}
\newcommand{\mycopyright}{%
  {Copyright (c)}\ \the\year\ \@authorsFirstname\ \@authorsLastname %
  \ifx\@secondAuthorsLastname\@empty\relax%
  \else%
    \ifinswedish%
      \  och\ \@secondAuthorsFirstname\ \@secondAuthorsLastname%
    \else%
      \  and\ \@secondAuthorsFirstname\ \@secondAuthorsLastname%
    \fi%
  \fi%
}
\hypersetup{
     pdfcopyright={\mycopyright} 
}
\restoregeometry
\clearpage
}

% bookinfo page with CC license
% CC BY (Attribution)
% CC BY-NC (Attribution + Non-commercial)
% CC BY-ND (Attribution + No derivatives)
% CC BY-NC-ND (Attribution + Non-commercial + No derivatives)
% CC BY-SA (Attribution + ShareAlike)
% CC BY-NC-SA (Attribution + Non-commercial + ShareAlike)
% CC0 (Zero)
\newcommand{\bookinfopageCC}{
\ifgfivepaper
  \newgeometry{top=130mm,bottom=30mm,left=12.25mm,right=35mm}
\else
  \newgeometry{top=220mm,bottom=30mm,left=74pt,right=35mm}
\fi
\thispagestyle{empty}
\begin{flushleft}
  \sffamily
  \IfEqCase{\doclicense@modifier}{%
    {by}{CC BY}%
    {by-nc}{CC BY-NC}%
    {by-nd}{CC BY-ND}%
    {by-nc-nd}{CC BY-NC-ND}%
    {by-sa}{CC BY-SA}%
    {by-nc-sa}{CC BY-NC-SA}%
    {zero}{CC0}%
  }[\typeout{Creative Commons code  \doclicense@modifier not found}\copyright]
  \enspace\the\year\quad\@authorsFirstname\space\@authorsLastname 
  \ifx\@secondAuthorsLastname\@empty\relax
  \else
    \ifinswedish
      \enspace och\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \else
      \enspace and\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \fi
  \fi
  \doclicenseThis
\end{flushleft}
\thesiscopyrightleft{\doclicense@modifier}

\let\@myCC\@empty
\ifdefstring{\doclicense@modifier}{by}{\def\@myCC{CC BY}}
\ifdefstring{\doclicense@modifier}{by-nc}{\def\@myCC{CC BY-NC}}
\ifdefstring{\doclicense@modifier}{by-nd}{\def\@myCC{CC BY-ND}}
\ifdefstring{\doclicense@modifier}{by-nc-nd}{\def\@myCC{CC BY-NC-ND}}
\ifdefstring{\doclicense@modifier}{by-sa}{\def\@myCC{CC BY-SA}}
\ifdefstring{\doclicense@modifier}{by-nc-sa}{\def\@myCC{CC BY-NC-SA}}
\ifdefstring{\doclicense@modifier}{zero}{\def\@myCC{CC0}}

\newcommand{\mycopyright}{%
 \@myCC\ \the\year\ \@authorsFirstname\ \@authorsLastname%
  \ifx\@secondAuthorsLastname\@empty\relax%
  \else%
    \ifinswedish%
      \  och\ \@secondAuthorsFirstname\ \@secondAuthorsLastname%
    \else%
      \ and\ \@secondAuthorsFirstname\ \@secondAuthorsLastname %
    \fi%
  \fi%
}

\hypersetup{
     pdfcopyright={\mycopyright} 
}
\restoregeometry
\clearpage
}

% If the doclicense package is installed, then use the \bookinfoCC when encountering a \bookinfo command
\AtBeginDocument{\@ifpackageloaded{doclicense}
  {%
    \renewcommand{\bookinfopage}{\bookinfopageCC}
  }
  {\relax}
}
\end{lstlisting}



\section[Inserting information into LADOK]{Inserting information into LADOK}
\label{sec:JSONtoLADOK}
As part of the effort to minimize the effort of cutting and pasting. I have made a program JSON\_to\_ladok.py that takes the extracted JSON information and uses the information about the author(s) and the title and alternative title to try to insert this information into LADOK for the module (\ie ``moment'' in Swedish) that requires a project title, \ie, '\foreignlanguage{swedish}{KravPaProjekttitel}' is True. \Cref{lst:usingExtractedJSONtoProduceLADOKentry} shows an example of using this program to try to put the title and alternative title into LADOK. Basically, the program logic should work, but I do \textbf{not} have the required permission to make entries of this sort of data for a degree project.

Note that this program uses the \texttt{ladok3} python library but extends it with some features that are not (yet) in the library. It should be regarded as very much a work in progress.
\begin{lstlisting}[language={bash}, caption={Using the extracted JSON to produce a LADOK entry}, label=lst:usingExtractedJSONtoProduceLADOKentry]
./JSON_to_ladok.py -c 11   --json xxx.json   --code DA213X
testing=False
d={'Author1': {'Last name': ‘xxx’, 'First name': 'xxx', 'Local User Id': 'yyyyy', 'E-mail': 'xxx@kth.se', 'organisation': {'L1': 'School of Electrical Engineering and Computer Science '}}, 'Degree': {'Educational program': 'Master’s Programme, Computer Science, 120 credits', 'programcode': 'TCSCM', 'Level': '2', 'Course code': 'DA231X', 'Credits': '30.0', 'Exam': 'Master’s Programme, Computer Science, 120 credits', 'subjectArea': 'Computer Science'}, 'Title': {'Main title': 'xxx', 'Subtitle': yyyy', 'Language': 'eng'}, 'Alternative title': {'Main title': 'zzzz', 'Subtitle': wwwww', 'Language': 'swe'}, 'Supervisor1': {'Last name': 'x', 'First name': 'y', 'Local User Id': 'xx', 'E-mail': 'xxxxx@kth.se', 'organisation': {'L1': 'School of Electrical Engineering and Computer Science ', 'L2': 'Computer Science'}}, 'Supervisor2': {'Last name': 'yyy', 'First name': 'xxx', 'E-mail': 'xxx@zzzz.com', 'Other organisation': ‘zzzz'}, 'Examiner1': {'Last name': 'Maguire Jr.', 'First name': 'Gerald Q.', 'Local User Id': 'u1d13i2c', 'E-mail': 'maguire@kth.se', 'organisation': {'L1': 'School of Electrical Engineering and Computer Science ', 'L2': 'Computer Science'}}, 'Cooperation': {'Partner_name': 'xxx'}, 'National Subject Categories': '10201, 10206', 'Other information': {'Year': '2021', 'Number of pages': 'xix,99'}, 'Opponents': {'Name': 'A. B. Normal & A. X. E. Normalè'}, 'Presentation': {'Date': '2021-03-15 13:00', 'Language': 'eng', 'Room': 'via Zoom', 'Address': 'Isafjordsgatan 22 (Kistagången 16)', 'City': 'Stockholm'}, 'Number of lang instances': '2', 'abstracts': {'eng': xxxx", 'swe': 'yyyy'}, 'keywords': {'eng': 'x, y z', 'swe': x, y, z'}}
course_code=DA231X
author={'Last name': 'xxx', 'First name': 'yyy', 'Local User Id': 'u1xxxx', 'E-mail': 'oxxx@kth.se', 'organisation': {'L1': 'School of Electrical Engineering and Computer Science '}}
sortable name=X,Y
Canvas user_id=dddd
integration_id=gggggg-gggg-gggg-gggg-ggggggg
ladoK_course_info={'id': '6683207e-5a5d-11eb-9b32-eeb44fb14647', 'round_id': '8e15ae14-1d86-11ea-a622-3565135944de', 'education_id': '374ea085-73d8-11e8-afa7-8e408e694e54', 'instance_id': '8eee8da9-dd0a-11e8-bb7a-19f8cd1a470e', 'swe_name': 'Examensarbete i datalogi och datateknik, avancerad nivå', 'eng_name': 'Degree Project in Computer Science and Engineering, Second Cycle'}
moment code=PRO1, requires title=False
moment code=PRO2, requires title=False
moment code=PRO3, requires title=True
trying to store a passing grade for moment=PRO3
Traceback (most recent call last):
  File "./JSON_to_ladok.py", line 533, in <module>
    sys.exit(main(sys.argv[1:]))
  File "./JSON_to_ ladok.py", line 519, in main
    status=save_result_degree_project3(ladok, integration_id, course_code, mom['Utbildningskod'], '2021-07-14', 'P', "PF", main_title, alternative_main_title)
  File "./JSON_to_ ladok.py", line 374, in save_result_degree_project3
    raise Exception("Couldn't register " + course_moment + "=" + grade_raw + " " + result_date_raw + ": " + r.json()["Meddelande"])
Exception: Couldn't register PRO3=P 2021-07-14: Hinder mot skapa resultat påträffat: Rapporteringsrättighet saknas
\end{lstlisting}

\section{Extending the set of languages supported for abstracts}
\label{sec:newLanguagesFOrAbstracts}
\textbf{Note for maintainers}: The code that implements the \texttt{abstract} command, shown in \Cref{lst:abstractCMD}, may need to be extended if an additional language that requires a special font is added for abstracts. This is necessary for languages that use characters not available in Figtree. The basic approach is to look at the value of \texttt{\textbackslash localename} (this is set when there is a call to \texttt{\textbackslash selectlanguage\{x\}}), then use the sans serif font that babel has set up for this language; otherwise, set the heading using Figtree.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={Modified abstract command}, columns=fullflexible, showstringspaces=false, label=lst:abstractCMD]
% This environment is to overcome the problem that babel changes the fomts and chapter heading formatting in language specific ways
% The method used here is to simply set the heading without using a heading command.
\renewenvironment{abstract}{%
    %\typeout{kththesisChip \f@encoding\  \f@family\  \f@series\  \f@shape}%
  \vspace*{178pt}% Space before the title - the ^is needed because \vspace is removed at page breaks
  \noindent
  \IfEqCase{\localename}{% \languagename
    {hindi}   {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont  \abstractname}}%
    {russian} {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    {ukrainian} {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    {greek}   {{\sffamily \fontsize{24}{26}\fontseries{m}\selectfont \abstractname}}%
    {chinese-simplified} {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    {arabic}  {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    {centralkurdish}  {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    {hebrew}  {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    %{hebrew}  {{\hebrewfontsf \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    {japanese}  {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    % We have to use \NotoSansFont as Figtree is missing "ắ" and "ộ" from "Tóm tắt nội dung"
    {vietnamese}  {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    {yiddish}  {{\sffamily \fontsize{24}{26}\fontseries{m}\fontshape{n}\selectfont \abstractname}}%
    % Add other specific languages here if they don't use FigtreeFont
  }[% Default case: If none of the above special languages match, use FigtreeFont.
    % This covers: english, swedish, french, spanish, norwegian, german, italian, danish, dutch, estonian, finnish, icelandic, romanian, turkish, latin, latvian, hungarian
    {\FigtreeFont \fontsize{24}{26}\fontseries{m}\selectfont \abstractname}%
  ]%

  \vspace{20pt}% Space after the title, before the abstract content begins
  \normalsize\normalfont % Reset font size for the content of the abstract
}{%
  % No specific code needed after the abstract content ends, unless you have closing commands.
  % The 'abstract' environment typically handles its own vertical spacing at the end.
}
\end{lstlisting}



\section{Language codes}
\label{sec:LanguageCodes}
The US Library of Congress has a table of the language codes at \url{https://www.loc.gov/standards/iso639-2/php/code_list.php}.

Based upon the US Library of Congress ``Codes for the Representation of Names of Languages: Codes arranged alphabetically by alpha-3/ISO 639-2 Code'', I have eliminated all of the rows that did not have both a three-letter ISO 639-2 Code \textbf{and} a two-letter ISO 639-1 Code. For the three-letter ISO 639-2 Codes, I used only the  ``B'', \ie bibliographic codes. I split the table into two parts: Languages already implemented (\Cref{tab:languagesImplemented}) and those remaining to be implemented (\Cref{tab:languagesNotImplemented}). The term ``implemented'' means that I have considered it in the current template, at least to some extent (but do not necessarily have a skeleton abstract in the language\footnote{For example, I do not have a skeleton abstract in Belarusian - but babel supports belarusian and the template supports the use of the Cyrillic alphabet. However, I have not done an investigation of whether the font supports all of the glyphs used in Belarusian.}).  For example, babel supports northernsami and yiddish as languages you can select, and I have created skeleton abstracts for both languages. In the case of Yiddish, I added it to the language switch in the code described in \Cref{sec:newLanguagesFOrAbstracts}. For Norwegian Bokmål, one can use the ``nob'' code for an abstract and specify the babel language Norwegian. In contrast, for Norwegian Nynorsk one uses the ``nno'' code for an abstract and the babel language nynorsk. However, I have only implemented a skeleton abstract for Norwegian.

I have a skeleton abstract in Kurdish Sorani (babel language centralkurdish) with language code ``cbk'', I do not have any support for Kurmanji. However, as Kurmanji uses a Latin-based alphabet, it should not be a problem to add an abstract with the ``kur'' code.

According to SCB (\url{https://www.scb.se/contentassets/221c69e399f0424b852b21236952e300/sprakkoder.xlsx}), there are also ISO 639-2 codes for Yiddish with regions (see \Cref{tab:SCByiddish}). For Romanian, the ISO 639-2 B code is "rum" and the ISO 639-1 code is  "ro". However, SCB gives additional ISO 639-2 codes (see \Cref{tab:SCBromani}). For Northern Sami (Samiska, (norra)), the ISO 639-2 is "sme" and the ISO 639-1 code is "se", but is there a region code that should be used? (See \Cref{tab:SCBsami}) For Tornedalen Finnish (\foreignlanguage{swedish}{Meänkieli}), the ISO 639-2 code is "fit", but I am unable to determine what ISO 639-1 code should be used (see \Cref{tab:languagesMissing}). Is it "fi" with some region code? If so, what region code? 

\generalExpl{I have added a skeleton abstract for Tornedalen Finnish (\foreignlanguage{swedish}{Meänkieli}). It is probably incorrect, but it provides a starting point. My assumption is that the spacing, hyphenation, \etc follow that of Finnish, but that there is a difference in words.}

\begin{table}[!htp]
    \caption{SCB table - Yiddish with regions}
    \label{tab:SCByiddish}
    \begin{tabular}{L{3cm}|L{6.5cm}}
      \textbf{ISO 639-2 Code} &\textbf{Swedish name of Language}\\
      \hline
YIH  &  Jiddisch (Väst)\\
YDD  &  Jiddisch (Öst)\\
\end{tabular}
\end{table}

\begin{table}[!htp]
    \caption{SCB table - Romainian with regions}
    \label{tab:SCBromani}
    \begin{tabular}{L{3cm}|L{6.5cm}}
      \textbf{ISO 639-2 Code} &\textbf{Swedish name of Language}\\
      \hline
ROM &   Romani chib\\
RMO &   Romani, Abbruzzesi, Serbisk romani, Slovensk-kroatisk romani\\
RMN &   Romani, Arli, Dzambasi, Gurbeti\\
RMC &   Romani, Bashaldo, Ungersk-slovakisk romani, Romungro\\
RMF &   Romani, Kale, Kalo\\
RMY &   Romani, Lovara, Kalderash\\
RML &   Romani, Polsk romani, Estnisk, Lettisk, Nordrysk, Vitrysk\\
RMU &   Romani, resande romani, Svensk romani, Romani tavringer\\
RMW &   Romani, Walesisk\\
\end{tabular}
\end{table}

\begin{table}[!htp]
    \caption{SCB table - Sami with regions}
    \label{tab:SCBsami}
    \begin{tabular}{L{3cm}|L{6.5cm}}
      \textbf{ISO 639-2 Code} &\textbf{Swedish name of Language}\\
      \hline
SMI &   Samiska\\
SIA &   Samiska, Akkalasamiska\\
SMN &   Samiska, Enaresamiska\\
SJK &   Samiska, Kemisamiska\\
SJD &   Samiska, Kildinsamiska\\
SMJ &   Samiska, Lulesamiska(Luleå)\\
SJE &   Samiska, Pitesamiska\\
SMS &   Samiska, Skoltsamiska\\
SMA &  Samiska, sydsamiska (södra)\\
SJT &  Samiska, Tersamiska\\
SJU &  Umesamiska\\
\end{tabular}
\end{table}
\clearpage
\begin{table}[!htp]
    \caption{Languages already implemented}
    \label{tab:languagesImplemented}
    \begin{footnotesize}

    \begin{tabular}{L{3cm}|L{3cm}|L{6.5cm}}
      \textbf{ISO 639-2 Code} & \textbf{ISO 639-1 Code} & \textbf{English name of Language}\\
      \hline
alb & sq & Albanian\\
ara & ar & Arabic\\
bel & be & Belarusian\\
bul & bg & Bulgarian\\
cat & ca & Catalan; Valencian\\
chi & zh & Chinese\\
cze & cs & Czech\\
dan & da & Danish\\
dut & nl & Dutch; Flemish\\
eng & en & English\\
est & et & Estonian\\
fin & fi & Finnish\\
fre & fr & French\\
ger & de & German\\
gre & el & Greek, Modern (1453-)\\
heb & he & Hebrew\\
hin & hi & Hindi\\
hun & hu & Hungarian\\
ice & is & Icelandic\\
ita & it & Italian\\
jpn & ja & Japanese\\
lat & la & Latin\\
lav & lv & Latvian\\
lit & lt & Lithuanian\\
nno & nn & Norwegian Nynorsk; Nynorsk, Norwegian\\
nob & nb & Bokmål, Norwegian; Norwegian Bokmål\\
nor & no & Norwegian\\
per & fa & Persian\\
pol & pl & Polish\\
por & pt & Portuguese\\
rum & ro & Romanian; Moldavian; Moldovan\\
rus & ru & Russian\\
sme & se & Northern Sami\\
srp & sr & Serbian\\
slo & sk & Slovak\\
spa & es & Spanish; Castilian\\
swe & sv & Swedish\\
swa & sw & Swahili\\
tur & tr & Turkish\\
ukr & uk & Ukrainian\\
vie & vi & Vietnamese\\
yid & yi & Yiddish\\
\hline
   \end{tabular}  
    \end{footnotesize}
\end{table}
\FloatBarrier

\begin{table}[!ht]
    \caption{Missing ISO 639-1 Code from the Library of Congress list}
    \label{tab:languagesMissing}
    \begin{tabular}{L{3cm}|L{3cm}|L{6.5cm}}
      \textbf{ISO 639-2 Code} & \textbf{ISO 639-1 Code} & \textbf{English name of Language}\\
      \hline
fit & ??? & Meänkieli\\
\hline
   \end{tabular}
\end{table}
\FloatBarrier

As to the language tag to use for Meänkieli, one can simply skip the ISO 639-1 Code and use "fit" - as done in \url{https://www.msb.se/sv/om-msb/information-pa-andra-sprak/meankieli/om-msb/}.
However, it seems strange that there is no ISO 639-1 Code. Interestingly, they use 'smi' for Lule Sami (\foreignlanguage{swedish}{lulesamiska}) in \url{https://www.msb.se/sv/om-msb/information-pa-andra-sprak/lulesamiska/om-msb/}.
\generalExpl{I have added a skeleton abstract for \foreignlanguage{swedish}{Meänkieli}. I had help from a former professor at Stockholm's university and sprakcentrummeankieli@isof.se for the abstract and keywords in Meänkieli (although there is a small difference between their spellings of two words).}

\begin{longtable}{|L{3cm}|L{3cm}|L{5cm}|}
\caption{Remaining languages to implement}
\label{tab:languagesNotImplemented}\\
\hline \multicolumn{1}{|c|}{\textbf{ISO 639-2 Code}} & \multicolumn{1}{c|}{\textbf{ISO 639-1 Code}} & \multicolumn{1}{c|}{\textbf{English name of Language}} \\
\endfirsthead
\multicolumn{3}{c}%
{{\bfseries \tablename\ \thetable{} -- continued from previous page}} \\
\hline \multicolumn{1}{|c|}{\textbf{ISO 639-2 Code}} & \multicolumn{1}{c|}{\textbf{ISO 639-1 Code}} & \multicolumn{1}{c|}{\textbf{English name of Language}} \\
\hline 
\endhead
\hline \multicolumn{3}{|r|}{{Continued on next page}} \\
\hline
\endfoot
\hline
\hline
\endlastfoot
aar & aa & Afar\\
abk & ab & Abkhazian\\
afr & af & Afrikaans\\
aka & ak & Akan\\
amh & am & Amharic\\
arg & an & Aragonese\\
arm & hy & Armenian\\
asm & as & Assamese\\
ava & av & Avaric\\
ave & ae & Avestan\\
aym & ay & Aymara\\
aze & az & Azerbaijani\\
bak & ba & Bashkir\\
bam & bm & Bambara\\
baq & eu & Basque\\
ben & bn & Bengali\\
bih & bh & Bihari languages\\
bis & bi & Bislama\\
bos & bs & Bosnian\\
bre & br & Breton\\
bur & my & Burmese\\
cha & ch & Chamorro\\
che & ce & Chechen\\
chu & cu & Church Slavic; Old Slavonic; Church Slavonic; Old Bulgarian; Old Church Slavonic\\
chv & cv & Chuvash\\
cor & kw & Cornish\\
cos & co & Corsican\\
cre & cr & Cree\\
div & dv & Divehi; Dhivehi; Maldivian\\
dzo & dz & Dzongkha\\
epo & eo & Esperanto\\
ewe & ee & Ewe\\
fao & fo & Faroese\\
fij & fj & Fijian\\
fry & fy & Western Frisian\\
ful & ff & Fulah\\
geo & ka & Georgian\\
gla & gd & Gaelic; Scottish\\
gle & ga & Irish\\
glg & gl & Galician\\
glv & gv & Manx\\
grn & gn & Guarani\\
guj & gu & Gujarati\\
hat & ht & Haitian; Haitian\\
hau & ha & Hausa\\
her & hz & Herero\\
hmo & ho & Hiri Motu\\
hrv & hr & Croatian\\
ibo & ig & Igbo\\
ido & io & Ido\\
iii & ii & Sichuan Yi; Nuosu\\
iku & iu & Inuktitut\\
ile & ie & Interlingue; Occidental\\
ina & ia & Interlingua (International Auxiliary Language Association)\\
ind & id & Indonesian\\
ipk & ik & Inupiaq\\
jav & jv & Javanese\\
kal & kl & Kalaallisut; Greenlandic\\
kan & kn & Kannada\\
kas & ks & Kashmiri\\
kau & kr & Kanuri\\
kaz & kk & Kazakh\\
khm & km & Central Khmer\\
kik & ki & Kikuyu; Gikuyu\\
kin & rw & Kinyarwanda\\
kir & ky & Kirghiz; Kyrgyz\\
kom & kv & Komi\\
kon & kg & Kongo\\
kor & ko & Korean\\
kua & kj & Kuanyama; Kwanyama\\
kur & ku & Kurdish\\
lao & lo & Lao\\
lim & li & Limburgan; Limburger; Limburgish\\
lin & ln & Lingala\\
ltz & lb & Luxembourgish; Letzeburgesch\\
lub & lu & Luba-Katanga\\
lug & lg & Ganda\\
mac & mk & Macedonian\\
mah & mh & Marshallese\\
mal & ml & Malayalam\\
mao & mi & Maori\\
mar & mr & Marathi\\
may & ms & Malay\\
mlg & mg & Malagasy\\
mlt & mt & Maltese\\
mon & mn & Mongolian\\
nau & na & Nauru\\
nav & nv & Navajo; Navaho\\
nbl & nr & Ndebele, South; South Ndebele\\
nde & nd & Ndebele, North; North Ndebele\\
ndo & ng & Ndonga\\
nep & ne & Nepali\\
nya & ny & Chichewa; Chewa; Nyanja\\
oci & oc & Occitan (post 1500)\\
oji & oj & Ojibwa\\
ori & or & Oriya\\
orm & om & Oromo\\
oss & os & Ossetian; Ossetic\\
pan & pa & Panjabi; Punjabi\\
pli & pi & Pali\\
pus & ps & Pushto; Pashto\\
que & qu & Quechua\\
roh & rm & Romansh\\
run & rn & Rundi\\
sag & sg & Sango\\
san & sa & Sanskrit\\
sin & si & Sinhala; Sinhalese\\
slv & sl & Slovenian\\
smo & sm & Samoan\\
sna & sn & Shona\\
snd & sd & Sindhi\\
som & so & Somali\\
sot & st & Sotho, Southern\\
srd & sc & Sardinian\\
ssw & ss & Swati\\
sun & su & Sundanese\\
tah & ty & Tahitian\\
tam & ta & Tamil\\
tat & tt & Tatar\\
tel & te & Telugu\\
tgk & tg & Tajik\\
tgl & tl & Tagalog\\
tha & th & Thai\\
tib & bo & Tibetan\\
tir & ti & Tigrinya\\
ton & to & Tonga (Tonga Islands)\\
tsn & tn & Tswana\\
tso & ts & Tsonga\\
tuk & tk & Turkmen\\
twi & tw & Twi\\
uig & ug & Uighur; Uyghur\\
urd & ur & Urdu\\
uzb & uz & Uzbek\\
ven & ve & Venda\\
vol & vo & Volapük\\
wel & cy & Welsh\\
wln & wa & Walloon\\
wol & wo & Wolof\\
xho & xh & Xhosa\\
yor & yo & Yoruba\\
zha & za & Zhuang; Chuang\\
zul & zu & Zulu\\
\end{longtable}
\FloatBarrier



\section{Adding keywords and other data to PDF metadata}
\label{sec:addingKeywordsAndMetaDataToPDF}
In an effort to add the \gls{PDF} metadata via the \texttt{hyperref} package, I decided to add the English and Swedish keywords part of the \gls{PDF} metadata. However, in order to do this, I had to know the keywords \textit{before} the \textbackslash begin\{document\} command in the \LaTeX{}~file. To do so, I added three new commands to the \texttt{kththesis.cls} file, as shown in \Cref{lst:keywords}. The commands are used in the \texttt{examplethesis.tex} file to set up the keywords in both English and Swedish as well as include a new set of \LaTeX{}~commands to store the \gls{PDF} metadata (as shown in \Cref{lst:storingkeywords}) using a file called \texttt{lib/pdf\_related\_includes.tex} (shown in \Cref{lst:informationforPDFfile}). Later, the keywords that have been stored are inserted into the \LaTeX{}~after their respective language abstracts. The title page of the thesis and the PDF metadata are shown in \Cref{fig:pdfMetadata}. Note that both the English and Swedish versions of the keywords are included in the metadata. Finally, the keywords appear (as expected) in the ``For DiVA'' data at the end of the \gls{PDF} file.

\Needspace*{7\baselineskip}
Note that \texttt{\textbackslash makeatlette} and \texttt{\textbackslash makeatother} are used to include the character “@” as a letter and then return “@” to being a punctuation code. This use of “@” protects the internal names from being accessed outside of these two commands. More explicitly, \texttt{\textbackslash EnglishKeywords} is a function that takes one argument, the text of the English keywords, and then stores them into ``\texttt{@EnglishKeywords}''. Later, the text can be retrieved with the command \texttt{\textbackslash InsertKeywords\{english\}} or \texttt{\textbackslash InsertKeywords\{swedish\}}.
\Needspace*{15\baselineskip}
\begin{lstlisting}[language={[LaTeX]TeX}, caption={New commands in kththesis.cls}, label=lst:keywords]
% Keywords
\let\@EnglishKeywords\@empty
\newcommand{\EnglishKeywords}[1]{\def\@EnglishKeywords{#1}}

\let\@SwedishKeywords\@empty
\newcommand{\SwedishKeywords}[1]{\def\@SwedishKeywords{#1}}

\makeatletter
\newcommand{\InsertKeywords}[1]{
    \IfEqCase{#1}{%
    {english}{\@EnglishKeywords}
    {swedish}{\@SwedishKeywords}
  }[\typeout{argument must be english or swedish}]
}
\end{lstlisting}
\Needspace*{12\baselineskip}
\Cref{lst:storingkeywords} shows the storing of the keywords using the above commands and the include of the library to set up the \gls{PDF} metadata.

\begin{lstlisting}[language={[LaTeX]TeX}, caption={shows the storing of the keywords using the above commands and the include of the library to set up the PDF metadata}, label=lst:storingkeywords]
% Enter the English and Swedish keywords here for use in the PDF metadata _and_ for later use
% following the respective abstract.
% Try to put the words in the same order in both to facilitate matching.
\EnglishKeywords{Canvas Learning Management System, Docker containers, performance tuning}
\SwedishKeywords{Canvas Lärplattform, Dockerbehållare, prestandajustering}

% Put the title, author, and keyword information into the PDF meta information
\include{lib/pdf_related_includes}
\end{lstlisting}


The \texttt{lib/pdf\_related\_includes.tex} file contains the \LaTeX{} ~- to add information
to the \gls{PDF} file (specifically, author(s), title(s), and keywords). It uses the
\texttt{hyperref} package and should be included before the \texttt{\textbackslash begin\{document\}}.
I want to acknowledge the inspiration of Karl Voit's template for TU Graz which inspired me to add the \gls{PDF} document information. For more information about his template, see \url{https://github.com/novoid/LaTeX-KOMA-template}
Note that my template does not use anything from his template other than the names of the information for the \gls{PDF} meta fields, \ie \texttt{mytitle}, \texttt{myauthor}, and \texttt{mykeywords}, together with the idea of defining the corresponding \texttt{newcommand} to set the relevant \texttt{hyperref} parameters. A result of both these decisions is that these command names are visible to the rest of the \LaTeX{}~file. See \Cref{lst:informationforPDFfile} for the code.

In keeping with the Swedish standard (\foreignlanguage{swedish}{Svenska skrivregler [Språkrådet 1.6.3 och 12.11.5]}) a ``\foreignlanguage{swedish}{mellanslag tankstreck}'' with a space before and after, \ie `` – '' is used to separate the title and subtitle when in Swedish, this leads to a condition based on whether the document is in Swedish or not in the computation of \texttt{mytitle} and \texttt{myalttitle}.

As a result of adding support for the \gls{PDF} metadata for the copyright notice, the template now uses the \texttt{hyperxmp} package. Because of this, if the author's name includes a suffix such as ``, Jr.'' or `` Jr.'', \ie the suffix can be separated with a comma or not as the author prefers to write their name; thus, there was a need to change the processing of \texttt{pdfauthor} information, as \texttt{hyperxmp} treats comma-separated strings in the author or keywords fields as being a list and converts these into a sequence of data in the metadata. This change is shown in \Cref{lst:informationforPDFfile} where the \texttt{\textbackslash hyxmp@comma} macro is used to insert something that is later replaced by a comma but is not treated as a comma when processing the \texttt{pdfauthor} information. The command \texttt{\textbackslash xmpquote} is used to wrap the whole name.
\clearpage

\begin{lstlisting}[language={[LaTeX]TeX}, caption={lib/pdf\_related\_includes.tex
    (edited for readability and to avoid problems when rendering)}, columns=fullflexible, showstringspaces=false, label=lst:informationforPDFfile]
% This file contains the LaTeX to add information to the PDF file (specifically, author(s), title(s), and keywords
% It uses the hyperref package and should be included before the \begin{document}
%
% I want to acknowledge the inspiration of Karl Voit's template for TU Graz that inspired me to add the PDF document information
% For more information about his template see https://github.com/novoid/LaTeX-KOMA-template
% Note that this template does not use anything from his template other than the names of the information for the PDF meta fields, i.e., mytitle, myauthor, and mykeywords together with the idea of defining the corresponding newcommand to set the relevant hyperref parameters.

\makeatletter
\ifx\@subtitle\@empty
    \newcommand{\mytitle}{\@title}
\else
    \ifinswedish
        \newcommand{\mytitle}{\@title\xspace–\xspace\@subtitle}
    \else
        \newcommand{\mytitle}{\@title: \@subtitle}
    \fi
\fi
\makeatother

% Put the alternative title (and subtitle) into the PDF Subject meta
\makeatletter
\ifx\@altsubtitle\@empty\relax
    \newcommand{\myalttitle}{\@alttitle}
\else
    \ifinswedish
        \newcommand{\myalttitle}{\@alttitle: \@altsubtitle}
    \else
    \newcommand{\myalttitle}{\@alttitle\xspace–\xspace\@altsubtitle}
    \fi
    
\fi
\makeatother
\hypersetup{
     pdfsubject={\myalttitle}        % Subject field
}

\ifinswedish
\XMPLangAlt{en}{pdfsubject={\myalttitle}}
\else
\XMPLangAlt{sv}{pdfsubject={\myalttitle}}
\fi


\ifinswedish
\hypersetup{%
    pdflang={sv},
    pdfmetalang={sv},
    pdftitle={\mytitle}        % Title field
}
\XMPLangAlt{en}{pdftitle={\myalttitle}}
\else
\hypersetup{%
    pdflang={en},
    pdfmetalang={en},
    pdftitle={\mytitle}        % Title field
}
\XMPLangAlt{sv}{pdftitle={\myalttitle}}
\fi

\makeatletter
\ltx@ifpackageloaded{hyperxmp}{
\ifx\@secondAuthorsLastname\@empty
% Note that \hyxmp@comma is used explicitly rather than \xmpcomma
% As the later will simply turn into a comma in this context.
\StrSubstitute{\@authorsLastname}{,}{\hyxmp@comma}[\@authorsLastnameXMP]
    \newcommand{\myauthor}{\xmpquote{\@authorsFirstname\space\@authorsLastnameXMP}} 
\else
% Note that \hyxmp@comma is used explicitly rather than \xmpcomma
% As the later will simply turn into a comma in this context.
\StrSubstitute{\@authorsLastname}{,}{\hyxmp@comma}[\@authorsLastnameXMP]
\StrSubstitute{\@secondAuthorsLastname}{,}{\hyxmp@comma}[\@secondAuthorsLastnameXMP]
    \newcommand{\myauthor}{\xmpquote{\@authorsFirstname\space\@authorsLastnameXMP},
\xmpquote{\@secondAuthorsFirstname\space\@secondAuthorsLastnameXMP}}
\fi
}{
\ifx\@secondAuthorsLastname\@empty
    \newcommand{\myauthor}{\@authorsFirstname\space\@authorsLastname} 
\else
    \newcommand{\myauthor}{\@authorsFirstname\space\@authorsLastname,
\space\@secondAuthorsFirstname\space\@secondAuthorsLastname}
\fi
}% end of ifpackage conditional
\makeatother

\hypersetup{
     pdfauthor={\myauthor}      % Author field
}


\makeatletter
\ifx\@EnglishKeywords\@empty
    \ifx\@SwedishKeywords\@empty
        \newcommand{\mykeywords}{}
    \else
    \newcommand{\mykeywords}{\@SwedishKeywords}
    \fi
\else
    \ifx\@SwedishKeywords\@empty
        \newcommand{\mykeywords}{\@EnglishKeywords}
    \else
        \ifinswedish
            \newcommand{\mykeywords}{\@SwedishKeywords, \@EnglishKeywords}
        \else
            \newcommand{\mykeywords}{\@EnglishKeywords, \@SwedishKeywords}
        \fi
    \fi
\fi
\makeatother

\hypersetup{
     pdfkeywords={\mykeywords}        % Keywords field
}        
% I have _not_ set the following fields:
%    pdfcreator             % Creator field
%    pdfproducer            % Producer field

%% Note that the copyright information is added to the PDF file inside bookinfo{}
%% as until then, the copyright information is unknown.

% Put the alternative title (and subtitle) into the PDF Subject meta
\makeatletter
\ifx\@secondkthid\@empty\relax
    \newcommand{\mykthids}{author: \@kthid}
\else
    \newcommand{\mykthids}{author: \@kthid,\xspace
    secondauthor: \@secondkthid}
\fi
\makeatother

\hypersetup{
     pdfcontactemail={\mykthids}        % Subject field
}

% Add the TRITA number to the metadata
% Get and store information about the series and the number within this series, i.e, TRITA numbers
%"Series": \{
%	"Title of series": "TRITA-ICT-EX"
%	"No. in series": "2019:00"
\makeatletter
\ifinswedish
\hypersetup{
        pdfvolumenum={\@thesisSeries},        % put the series in the volume field
        pdfissuenum={\@thesisSeriesNumber},
        pdfpublisher={Kungliga Tekniska högskolan (KTH)},
        pdfpubtype={report}
}
\else
\hypersetup{
        pdfvolumenum={\@thesisSeries},        % put the series in the volume field
        pdfissuenum={\@thesisSeriesNumber},
        pdfpublisher={KTH Royal Institute of Technology},
        pdfpubtype={report}
}
\fi
\makeatother  
\end{lstlisting}


\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/PDF-file-metadata-Screenshot_20220330_085854.png}}
  \end{center}
  \caption[{The title page of the thesis and the PDF metadata}]{The title page of the thesis and the \gls{PDF} metadata. This title page is from a first-cycle thesis. What is relevant here is the metadata shown as part of the \gls{PDF} document description.}
  \label{fig:pdfMetadata}
\end{figure}
\FloatBarrier



\Needspace*{10\baselineskip}
\subsection{Adding additional metadata to the PDF file}
\label{sec:addingMetadataToPDFfile}
Increasingly metadata is being embedded into digital objects to provide information about the creator (author, photographer, \etc), date of creation, copyright notices, \etc. In a typical \gls{PDF} file produced by \LaTeX{}~there is both PDF-specific metadata and additional metadata. This additional metadata is stored using Adobe's \glsfirst{XMP}. \gls{XMP} is a means of embedding metadata in \gls{XMP} format into \gls{PDF} documents so that tools can extract it mechanically.

An early paper about automatically extracting the title, authors(s), and abstract from theses was written by Mao Ni of the University of North Carolina at Chapel Hill, School of Library and Information Science in 2004\,\cite{Mao_Ni_2004}. The idea was to collect the metadata from the thesis using an Adobe Acrobat plugin and then write this data to \gls{XMP} (which could be embedded into the \gls{PDF} file). The schema used for the metadata\cite{hickey_pavani_suleman_2010} \footnote{\url{https://ndltd.org/metadata/}} was that of Networked Digital Library of Theses and Dissertations\footnote{\url{https://ndltd.org/}}.

More recently, Elsevier's Digital Commons \footnote{\url{https://www.elsevier.com/solutions/digital-commons}} uses an extension of the Dublin Core\footnote{\url{https://www.dublincore.org/}} shown in \Cref{tab:dublicCoreDigitalCommons} to collect metadata. We will see the Dublin Core elements and other metadata schema used in XMP in the remainder of this section.

Bepress has written about Elsevier's Digital Commons in a webpage ``Digital Commons and OAI-PMH: Outbound Harvesting of Repository Records'' \url{https://bepress.com/reference_guide_dc/digital-commons-oai-harvesting/}. The\gls{OAI-PMH} is to foster interoperability between repositories\footnote{\url{https://www.openarchives.org/pmh/}} to enable harvesters to collect metadata from a repository. Over the last 20 years, there has been an evolution from simply having metadata in a database that is associated with a publication to an entire ecosystem of metadata and applications -- see for example, the twentieth International Conference on Dublin Core and Metadata Applications (DCMI 2022) - \url{https://www.dublincore.org/conferences/2022/programme/}.
\clearpage

\begin{table}[!ht]
    \caption{Dublin Core Elements in Digital Commons\cite{digital_commons_metadata_2016} - items in bold are from the so-called ``simple Dublic Core''}
    \label{tab:dublicCoreDigitalCommons}
    \begin{scriptsize}   
    \begin{tabular}{l | l }
      \textbf{Element} & \textbf{Element} \\
      \hline
\textbf{dc.contributor} & \textbf{dc.rights}\\
dc.contributor.role & dc.rights.accessRights\\
\textbf{dc.coverage} & dc.rights.license\\
dc.coverage.spatial & \textbf{dc.source}\\
dc.coverage.spatial.lat & \textbf{dc.subject}\\
dc.coverage.spatial.long & \textbf{dc.title}\\
dc.coverage.temporal & dc.title.alternative\\
\textbf{dc.creator} & \textbf{dc.type}\\
\textbf{dc.date} & dcam.memberOf\\
dc.date.available & dcterms.accrualMethod\\
dc.date.created & dcterms.accrualPeriodicity\\
dc.date.dateAccepted & dcterms.accrualPolicy\\
dc.date.dateCopyrighted & dcterms.audience\\
dc.date.dateSubmitted & dcterms.audience.educationLevel\\
dc.date.issued & dcterms.audience.mediator\\
dc.date.modified & dcterms.instructionalMethod\\
dc.date.valid & dcterms.provenance\\
\textbf{dc.description} & dcterms.rightsHolder\\
dc.description.abstract & geo.alt\\
dc.description.note & thesis.degree\\
dc.description.release & thesis.degree.discipline\\
dc.description.tableOfContents & thesis.degree.grantor\\
\textbf{dc.format} & thesis.degree.level\\
dc.format.extent & thesis.degree.name\\
dc.format.medium\\
\textbf{dc.identifier}\\
dc.identifier.bibliographicCitation\\
\textbf{dc.language}\\
\textbf{dc.publisher}\\
\textbf{dc.relation}\\
dc.relation.conformsTo\\
dc.relation.hasFormat\\
dc.relation.hasPart\\
dc.relation.hasVersion\\
dc.relation.isFormatOf\\
dc.relation.isPartOf\\
dc.relation.isReferencedBy\\
dc.relation.isReplacedBy\\
dc.relation.isRequiredBy\\
dc.relation.isVersionOf\\
dc.relation.references\\
dc.relation.replaces\\
dc.relation.requires\\
\end{tabular}
\end{scriptsize}
\end{table}
\FloatBarrier
\clearpage

\Cref{fig:fileProperties} shows the properties of a \gls{PDF} file when using an old version of Adobe Acrobat with the command: File$→$Properties. This figure shows the Title, Author, Subject, and Keyword fields (among other properties of this \gls{PDF} file). Because this file was generated in PDF 2.0 format, Acrobat says that you cannot edit the information, and it indicates this by displaying the information in gray.
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.9\textwidth]{README_notes/README-examiner-figures/New_thesis_template_document_properties-Screenshot_20221227_115745.png}}
  \end{center}
  \caption{PDF file properties}
  \label{fig:fileProperties}
\end{figure}
\FloatBarrier

\Cref{fig:fileProperties2} shows similar data for another \gls{PDF} file generated with an earlier \gls{PDF} version. Because this \gls{PDF} file uses PDF-1.5, Acrobat displays the information in dark letters, and it is possible to edit the metadata using Acrobat.
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.9\textwidth]{README_notes/README-examiner-figures/File-properties-Screenshot_20221225_135914.png}}
  \end{center}
  \caption{PDF file properties of another PDF file, in this case, the proposal template}
  \label{fig:fileProperties2}
\end{figure}
\FloatBarrier

The \gls{XMP} data is in a stream indicated in the \gls{PDF} as Metadata of the subtype \gls{XML}, as shown in \Cref{lst:pdfXMPStream}. In the listing, the actual length in bytes has been replaced by dddd.
\begin{lstlisting}[caption={PDF stream where the XMP is found}, label=lst:pdfXMPStream]
<< /Subtype /XML /Type /Metadata /Length dddd >>
stream
\end{lstlisting}

In the \gls{PDF} file, the \gls{XML} encoded metadata is between \texttt{<?xpacket begin="yyyy" id="xxxx"?>} and \texttt{<?xpacket end="w"?>} (where xxxx is some unique ID). It is important to note that the value for yyyy in the previous is a so-called \gls{BOM} with the value 0xFEFF. While this character is a valid \mbox{UTF-8} character, the \texttt{lstlisting} environment cannot handle this value; therefore, it has been replaced by the string ``BOM 0xFEFF''. An example of this is shown in \Cref{lst:pdfinfoOutput}.
\clearpage
\begin{lstlisting}[style={myXML}, caption={The first part of the XML metadata embedded in a PDF file (some reformatting has been done to fit the text in the borders)}, label={lst:pdfinfoOutput}]


<?xpacket begin="BOM 0xFEFF" id="W5M0MpCehiHzreSzNTczkc9d"?>
<x:xmpmeta xmlns:x="adobe:ns:meta/">
  <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
    <rdf:Description rdf:about=""
     xmlns:pdf="http://ns.adobe.com/pdf/1.3/"
     xmlns:xmpRights="http://ns.adobe.com/xap/1.0/rights/"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:photoshop="http://ns.adobe.com/photoshop/1.0/"
     xmlns:xmp="http://ns.adobe.com/xap/1.0/"
     xmlns:xmpMM="http://ns.adobe.com/xap/1.0/mm/"
     xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#"
     xmlns:pdfaid="http://www.aiim.org/pdfa/ns/id/"
     xmlns:pdfuaid="http://www.aiim.org/pdfua/ns/id/"
     xmlns:pdfx="http://ns.adobe.com/pdfx/1.3/"
     xmlns:pdfxid="http://www.npes.org/pdfx/ns/id/"
     xmlns:prism="http://prismstandard.org/namespaces/basic/3.0/"
     xmlns:jav="http://www.niso.org/schemas/jav/1.0/"
     xmlns:xmpTPg="http://ns.adobe.com/xap/1.0/t/pg/"
     xmlns:stFnt="http://ns.adobe.com/xap/1.0/sType/Font#"
     xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/"
     xmlns:pdfaExtension="http://www.aiim.org/pdfa/ns/extension/"
     xmlns:pdfaSchema="http://www.aiim.org/pdfa/ns/schema\#"
     xmlns:pdfaProperty="http://www.aiim.org/pdfa/ns/property#"
     xmlns:pdfaType="http://www.aiim.org/pdfa/ns/type#"
     xmlns:pdfaField="http://www.aiim.org/pdfa/ns/field#">
\end{lstlisting}

Some of these XML elements include "rdf" elements referring to the \gls{RDF}\footnote{\url{https://www.w3.org/RDF/}}.

The \gls{XMP} data utilizes a number of different schema and namespaces. These namespaces are shown as ``xmlns:xxxx''  in \Cref{lst:pdfinfoOutput}. One namespace is \texttt{xmlns:dc} and this refers to the scheme is `Dublin Core'' \footnote{see Dublin Core Metadata Initiative \url{https://www.dublincore.org/}}. The information about this namespace can be found at \url{http://purl.org/dc/elements/1.1/}. Each of the schema and namespace are described in the next part of the \gls{XML}, see \Cref{lst:pdfinfoOutputPart2}.

\begin{lstlisting}[style=myXML,
caption={Second part of the XML metadata embedded in a PDF file (some reformatting has been done to fit the text in the borders)}, label={lst:pdfinfoOutputPart2}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <pdfaExtension:schemas>
        <rdf:Bag>
          <rdf:li rdf:parseType="Resource">
            <pdfaSchema:schema>Adobe PDF Schema</pdfaSchema:schema>
            <pdfaSchema:prefix>pdf</pdfaSchema:prefix>
            <pdfaSchema:namespaceURI>http://ns.adobe.com/pdf/1.3/£\break{\ensuremath{\color{red}\hookrightarrow\space}}£</pdfaSchema:namespaceURI>
            <pdfaSchema:property>
              <rdf:Seq>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>Trapped</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>Indication if the document has been modified to include trapping information</pdfaProperty:description>
                </rdf:li>
              </rdf:Seq>
            </pdfaSchema:property>
          </rdf:li>
          <rdf:li rdf:parseType="Resource">
            <pdfaSchema:schema>XMP Media Management Schema</pdfaSchema:schema>
            <pdfaSchema:prefix>xmpMM</pdfaSchema:prefix>
            <pdfaSchema:namespaceURI>http://ns.adobe.com/xap/1.0/mm/£\break{\ensuremath{\color{red}\hookrightarrow\space}}£</pdfaSchema:namespaceURI>
            <pdfaSchema:property>
              <rdf:Seq>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>DocumentID</pdfaProperty:name>
                  <pdfaProperty:valueType>URI</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>UUID based identifier for all versions and renditions of a document</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>InstanceID</pdfaProperty:name>
                  <pdfaProperty:valueType>URI</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>UUID based identifier for specific incarnation of a document</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>VersionID</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>Document version identifier</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>RenditionClass</pdfaProperty:name>
                  <pdfaProperty:valueType>RenditionClass</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>The manner in which a document is rendered</pdfaProperty:description>
                </rdf:li>
              </rdf:Seq>
            </pdfaSchema:property>
          </rdf:li>
          <rdf:li rdf:parseType="Resource">
            <pdfaSchema:schema>IPTC Core Schema</pdfaSchema:schema>
            <pdfaSchema:prefix>Iptc4xmpCore</pdfaSchema:prefix>
            <pdfaSchema:namespaceURI>http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/£\break{\ensuremath{\color{red}\hookrightarrow\space}}£</pdfaSchema:namespaceURI>
            <pdfaSchema:property>
              <rdf:Seq>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>CreatorContactInfo</pdfaProperty:name>
                  <pdfaProperty:valueType>ContactInfo</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Document creator's contact information</pdfaProperty:description>
                </rdf:li>
              </rdf:Seq>
            </pdfaSchema:property>
            <pdfaSchema:valueType>
              <rdf:Seq>
                <rdf:li rdf:parseType="Resource">
                  <pdfaType:type>ContactInfo</pdfaType:type>
                  <pdfaType:namespaceURI>http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/£\break{\ensuremath{\color{red}\hookrightarrow\space}}£</pdfaType:namespaceURI>
                  <pdfaType:prefix>Iptc4xmpCore</pdfaType:prefix>
                  <pdfaType:description>Basic set of information to get in contact with a person</pdfaType:description>
                  <pdfaType:field>
                    <rdf:Seq>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiAdrCity</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information city</pdfaField:description>
                      </rdf:li>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiAdrCtry</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information country</pdfaField:description>
                      </rdf:li>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiAdrExtadr</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information address</pdfaField:description>
                      </rdf:li>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiAdrPcode</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information local postal code</pdfaField:description>
                      </rdf:li>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiAdrRegion</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information regional information such as state or province</pdfaField:description>
                      </rdf:li>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiEmailWork</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information email address(es)</pdfaField:description>
                      </rdf:li>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiTelWork</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information telephone number(s)</pdfaField:description>
                      </rdf:li>
                      <rdf:li rdf:parseType="Resource">
                        <pdfaField:name>CiUrlWork</pdfaField:name>
                        <pdfaField:valueType>Text</pdfaField:valueType>
                        <pdfaField:description>Contact information Web URL(s)</pdfaField:description>
                      </rdf:li>
                    </rdf:Seq>
                  </pdfaType:field>
                </rdf:li>
              </rdf:Seq>
            </pdfaSchema:valueType>
          </rdf:li>
          <rdf:li rdf:parseType="Resource">
            <pdfaSchema:schema>PRISM Basic Metadata</pdfaSchema:schema>
            <pdfaSchema:prefix>prism</pdfaSchema:prefix>
            <pdfaSchema:namespaceURI>http://prismstandard.org/namespaces/basic/3.0/£\break{\ensuremath{\color{red}\hookrightarrow\space}}£</pdfaSchema:namespaceURI>
            <pdfaSchema:property>
              <rdf:Seq>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>complianceProfile</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>PRISM specification compliance profile to which this document adheres</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>publicationName</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Publication name</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>aggregationType</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Publication type</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>bookEdition</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Edition of the book in which the document was published</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>volume</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Publication volume number</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>number</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Publication issue number within a volume</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>pageRange</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Page range for the document within the print version of its publication</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>issn</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>ISSN for the printed publication in which the document was published</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>eIssn</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>ISSN for the electronic publication in which the document was published</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>isbn</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>ISBN for the publication in which the document was published</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>doi</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Digital Object Identifier for the document</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>url</pdfaProperty:name>
                  <pdfaProperty:valueType>URL</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>URL at which the document can be found</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>byteCount</pdfaProperty:name>
                  <pdfaProperty:valueType>Integer</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>Approximate file size in octets</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>pageCount</pdfaProperty:name>
                  <pdfaProperty:valueType>Integer</pdfaProperty:valueType>
                  <pdfaProperty:category>internal</pdfaProperty:category>
                  <pdfaProperty:description>Number of pages in the print version of the document</pdfaProperty:description>
                </rdf:li>
                <rdf:li rdf:parseType="Resource">
                  <pdfaProperty:name>subtitle</pdfaProperty:name>
                  <pdfaProperty:valueType>Text</pdfaProperty:valueType>
                  <pdfaProperty:category>external</pdfaProperty:category>
                  <pdfaProperty:description>Document's subtitle</pdfaProperty:description>
                </rdf:li>
              </rdf:Seq>
            </pdfaSchema:property>
          </rdf:li>
        </rdf:Bag>
      </pdfaExtension:schemas>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart3} shows the third part of the \gls{XMP} data. In this part, we can see information in the \texttt{pdf} namespace. Information about this namespace can be found at \url{https://developer.adobe.com/xmp/docs/XMPNamespaces/pdf/}. The Adobe \gls{PDF} namespace has defined four names: pdf:Keywords, pdf:PDFVersion, pdf:Producer, and pdf:Trapped. In this listing, we can see two of these: pdf:Producer and pdf:Keywords. The latter of these is a comma-separated list of keywords.

\Needspace*{6\baselineskip}
\begin{lstlisting}[style=myXML,
caption={The \texttt{pdf}-prefix metadata embedded in a PDF file (some reformatting has been done to fit the text in the boarders)}, label={lst:pdfinfoOutputPart3}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <pdf:Producer>XeTeX version 0.999994</pdf:Producer>
      <pdf:Keywords>Canvas Learning Management System, Docker containers, Performance tuning, Canvas Lärplattform, Dockerbehållare, Prestandajustering</pdf:Keywords>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart4} shows the next part of the \gls{XMP} data. In this case, we see a new name prefix \texttt{xmpRights}, specifically the name \texttt{xmpRights:Marked}. This namespace is described at \url{https://developer.adobe.com/xmp/docs/XMPNamespaces/xmpRights/}. This namespace defines the following names: xmpRights:Certificate, xmpRights:Marked, xmpRights:Owner, xmpRights:UsageTerms, and xmpRights:WebStatement. In this case, xmpRights:Marked is marked as ``True'' which ``indicates that this is a rights-managed resource. When false, indicates that this is a public-domain resource. Omit if the state is unknown.''. So in this case, it is a right-managed resource.

\Needspace*{3\baselineskip}
\begin{lstlisting}[style=myXML,
caption={The \texttt{xmpRights:Marked} metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart4}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <xmpRights:Marked>True</xmpRights:Marked>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart5} shows the next part of the \gls{XMP} data. In this case, we can see an element from the \texttt{dc} namespace. The name \texttt{dc:format} indicates the format of the document. As per \url{https://www.dublincore.org/specifications/dublin-core/format-element/} in the case of an electronic document, the format is described using the Internet Media Types (\ie MIME values).
\Needspace*{3\baselineskip}
\begin{lstlisting}[style=myXML,
caption={The \texttt{dc:format} metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart5}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <dc:format>application/pdf</dc:format>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart6} shows the next part of the \gls{XMP} data. In this case, we can see another element from the \texttt{dc} namespace. More specifically, the element named \texttt{dc:title} and this contains the title of the document. This also illustrates another feature of \gls{XML} -- it is possible to have the title in several different languages. The \gls{RDF} tag \texttt{rdf:Alt} indicates that there are a list of alternatives. In this case, the items in the list are tagged with a language tag. The language tag \texttt{xml:lang="x-default"} is the default language of the document. This is followed by items that contain the English (tagged ``en'') and Swedish (tagged ``sv''). The language tags are an ISO 639-1 two-letter language code with an
optional ISO 3166-1 two-letter region code.
\begin{lstlisting}[style=myXML,
caption={The \texttt{dc:title>} metadata embedded in a PDF file (some reformatting has been done to fit the text in the boarders)}, label={lst:pdfinfoOutputPart6}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <dc:title>
        <rdf:Alt>
          <rdf:li xml:lang="x-default">This is the title in the language of the thesis: A subtitle in the language of the thesis</rdf:li>
          <rdf:li xml:lang="en">This is the title in the language of the thesis: A subtitle in the language of the thesis</rdf:li>
          <rdf:li xml:lang="sv">Detta är den svenska översättningen av titeln – Detta är den svenska översättningen av undertiteln</rdf:li>
        </rdf:Alt>
      </dc:title>
\end{lstlisting}

%% I currently do not support putting the abstracts in as meta data
\begin{comment}
\Cref{lst:pdfinfoOutputPart7} shows the \texttt{dc:description} metadata. These contain the abstracts in each of the languages used in the thesis. This is done using the same mechanism as described above for the titles. Note that is possible to use \LaTeX~macros in the abstracts, but the set of things that are supported by subsequent post-processing is limited. The \LaTeX{}~macros are hidden from expansion by replacing all instances of '\textbackslash' with '\textcent' (the cent symbol) using a new macro: \textbackslash replaceBS defined in \texttt{kththesis.cls}.
\begin{lstlisting}[style=myXML,
caption={The \texttt{dc:description} metadata embedded in a PDF file (some reformatting has been done to fit the text in the boarders)}, label={lst:pdfinfoOutputPart7}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <dc:description>
        <rdf:Alt>
          <rdf:li xml:lang="x-default">Detta är den svenska översättningen av titeln – Detta är den svenska översättningen av undertiteln</rdf:li>
          <rdf:li xml:lang="en">Detta är den svenska översättningen av titeln – Detta är den svenska översättningen av undertiteln</rdf:li>
          <rdf:li xml:lang="sv">Detta är den svenska översättningen av titeln – Detta är den svenska översättningen av undertiteln</rdf:li>
          <rdf:li xml:lang="en-US">abstract: "¢generalExpl{Enter your abstract here!}
Write an abstract that is about 250 and 350 words (1/2 A4-page)  with the following components:
% key parts of the abstract
¢begin{itemize}
  ¢item What is the topic area? (optional) Introduces the subject area for the project.
  ¢item Short problem statement
  ¢item Why was this problem worth a Bachelor's/Master’s thesis project? (¢ie, why is the problem both significant and of a suitable degree of difficulty for a Bachelor's/Master’s thesis project? Why has no one else solved it yet?)
  ¢item How did you solve the problem? What was your method/insight?
  ¢item Results/Conclusions/Consequences/Impact: What are your key results/¢linebreak[4]conclusions? What will others do based upon your results? What can be done now that you have finished - that could not be done before your thesis project was completed?
¢end{itemize}
"</rdf:li>
          <rdf:li xml:lang="sv">abstract: "¢generalExpl{Enter your Swedish abstract or summary here!}
¢sweExpl{Alla avhandlingar vid KTH ¢textbf{måste ha} ett abstrakt på både ¢textit{engelska} och ¢textit{svenska}.¢¢
Om du skriver din avhandling på svenska ska detta göras först (och placera det som det första abstraktet) - och du bör revidera det vid behov.}

¢engExpl{If you are writing your thesis in English, you can leave this until the draft version that goes to your opponent for the written opposition. In this way you can provide the English and Swedish abstract/summary information that can be used in the announcement for your oral presentation.¢¢If you are writing your thesis in English, then this section can be a summary targeted at a more general reader. However, if you are writing your thesis in Swedish, then the reverse is true – your abstract should be for your target audience, while an English summary can be written targeted at a more general audience.¢¢This means that the English abstract and Swedish sammnfattning
or Swedish abstract and English summary need not be literal translations of each other.}

¢warningExpl{Do not use the ¢textbackslash glspl¢{¢} command in an abstract that is not in English, as my programs do not know how to generate plurals in other languages. Instead you will need to spell these terms out or give the proper plural form. In fact, it is a good idea not to use the glossary commands at all in an abstract/summary in a language other than the language used in the ¢texttt{acronyms.tex file} - since the glossary package does ¢textbf{not} support use of more than one language.}

¢engExpl{The abstract in the language used for the thesis should be the first abstract, while the Summary/Sammanfattning in the other language can follow}"</rdf:li>
          <rdf:li xml:lang="fr-FR">abstract: "Résumé en français."</rdf:li>
          <rdf:li xml:lang="es-ES">abstract: "Résumé en espagnol."</rdf:li>
          <rdf:li xml:lang="it">abstract: "Sommario in italiano."</rdf:li>
          <rdf:li xml:lang="nb">abstract: "Sammendrag på norsk."</rdf:li>
          <rdf:li xml:lang="de-DE">abstract: "Zusammenfassung in Deutsch."</rdf:li>
          <rdf:li xml:lang="da">abstract: "Abstrakt på dansk."</rdf:li>
          <rdf:li xml:lang="nl">abstract: "Samenvatting in het Nederlands."</rdf:li>
          <rdf:li xml:lang="et">abstract: "Eesti keeles kokkuvõte."</rdf:li>
        </rdf:Alt>
      </dc:description>
\end{lstlisting}
\end{comment}

\Needspace*{32\baselineskip}
\Cref{lst:pdfinfoOutputPart8} shows the \texttt{dc:rights}, \texttt{dc:publisher}, \texttt{dc:date}, and \texttt{dc:type} elements. The \textbackslash bookinfomacro was extended to put the copyright information into the metadata. This metadata and the \texttt{xmpRights:Marked} value being \textbf{True} enables the display of the copyright data as shown in \Cref{fig:exampleCopyrightXMPdisplayed}.

\begin{lstlisting}[style=myXML,
caption={The \texttt{dc:rights}, \texttt{dc:publisher}, \texttt{dc:date}, and \texttt{dc:type} metadata embedded in a PDF file (some reformatting has been done to fit the text in the boarders)}, label={lst:pdfinfoOutputPart8}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <dc:rights>
        <rdf:Alt>
          <rdf:li xml:lang="en">Copyright (c) 2022 Fake A. Student, Jr. and Fake B. Student</rdf:li>
        </rdf:Alt>
      </dc:rights>
      <dc:publisher>
        <rdf:Bag>
          <rdf:li>KTH Royal Institute of Technology</rdf:li>
        </rdf:Bag>
      </dc:publisher>
      <dc:date>
        <rdf:Seq>
          <rdf:li>2022-12-27T10:22:34Z</rdf:li>
        </rdf:Seq>
      </dc:date>
      <dc:type>
        <rdf:Bag>
          <rdf:li>Text</rdf:li>
        </rdf:Bag>
      </dc:type>
\end{lstlisting}

 	
\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=0.99\textwidth]{README_notes/README-examiner-figures/Example-of-copyright-data-Screenshot_20221227_143035.png}
  \end{center}
  \caption{Example of the copyright information being displayed}
  \label{fig:exampleCopyrightXMPdisplayed}
\end{figure}

\Cref{lst:pdfinfoOutputPart9} shows the \texttt{dc:creator} metadata. In this case the comma separated list of authors has been rendered as an \texttt{rdf:Seq} which is an \textbf{ordered} list of items.

\Needspace*{8\baselineskip}
\begin{lstlisting}[style=myXML,
caption={The \texttt{dc:creator} metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart9}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <dc:creator>
        <rdf:Seq>
          <rdf:li>Fake A. Student, Jr.</rdf:li>
          <rdf:li>Fake B. Student</rdf:li>
        </rdf:Seq>
      </dc:creator>
\end{lstlisting}
\clearpage

\Cref{lst:pdfinfoOutputPart10} shows the \texttt{dc:subject} metadata. In this case the comma separated list of keywords has been rendered as an \texttt{rdf:Bag} which is an \textbf{unordered} list of items.
\begin{lstlisting}[style=myXML,
caption={The \texttt{dc:subject} metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart10}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <dc:subject>
        <rdf:Bag>
          <rdf:li>Canvas Learning Management System</rdf:li>
          <rdf:li>Docker containers</rdf:li>
          <rdf:li>Performance tuning</rdf:li>
          <rdf:li>Canvas Lärplattform</rdf:li>
          <rdf:li>Dockerbehållare</rdf:li>
          <rdf:li>Prestandajustering</rdf:li>
        </rdf:Bag>
      </dc:subject>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart11} shows the \texttt{dc:source} and \texttt{dc:language} metadata. The value of \texttt{dc:source} was not set explicitly, so this seems to have been derived in some way. Additionally, the \texttt{dc:language} \texttt{rdf:Bag} was automatically computed and includes all of the languages used via \textsc{babel} or \textsc{polyglossia} in the thesis.
\begin{lstlisting}[style=myXML,
caption={The \texttt{dc:source} and \texttt{dc:language} metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart11}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <dc:source>output.tex</dc:source>
      <dc:language>
        <rdf:Bag>
          <rdf:li>fr-FR</rdf:li>
          <rdf:li>es-ES</rdf:li>
          <rdf:li>nb</rdf:li>
          <rdf:li>de-DE</rdf:li>
          <rdf:li>sv</rdf:li>
          <rdf:li>it</rdf:li>
          <rdf:li>da</rdf:li>
          <rdf:li>nl</rdf:li>
          <rdf:li>et</rdf:li>
          <rdf:li>en-US</rdf:li>
        </rdf:Bag>
      </dc:language>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart12} shows the \texttt{xmp}-prefix elements in the file. This namespace is supposed to be defined at \url{http://ns.adobe.com/xap/1.0/}; however, this URL is not longer valid but the Adobe XMP Basic namespace is described at url{https://developer.adobe.com/xmp/docs/XMPNamespaces/xmp/}. In this specific case, the file provides the \texttt{CreateDate}, \texttt{xmp:ModifyDate}, \texttt{xmp:MetadataDate}, and \texttt{xmp:CreatorTool}. For the last of these the value is shown as ``LaTeX with hyperref<'' even though the \XeLaTeX~engine had been used.
\begin{lstlisting}[style=myXML,
caption={The final set of metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart12}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <xmp:CreateDate>2022-12-27T10:22:34</xmp:CreateDate>
      <xmp:ModifyDate>2022-12-27T10:22:34Z</xmp:ModifyDate>
      <xmp:MetadataDate>2022-12-27T10:22:34Z</xmp:MetadataDate>
      <xmp:CreatorTool>LaTeX with hyperref</xmp:CreatorTool>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart13} shows the \texttt{xmpMM}-prefix metadata. The information about this namespace should be at \url{http://ns.adobe.com/xap/1.0/mm/}, however, this URL is no longer valid but the description of the XMP Media Management namespace is available at \url{https://developer.adobe.com/xmp/docs/XMPNamespaces/xmpMM/}.
\begin{lstlisting}[style=myXML,
caption={The \texttt{xmpMM}-prefix metadata embedded in a PDF file (two of the lines have been manually broken to fit the test in the margins)}, label={lst:pdfinfoOutputPart13}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <xmpMM:DocumentID>uuid:d7a82bbb-620a-439b-ac90-5413339b620a£\break£</xmpMM:DocumentID>
      <xmpMM:InstanceID>uuid:620005f7-f75f-4dce-a820-a8888d18205f£\break£</xmpMM:InstanceID>
      <xmpMM:VersionID>1</xmpMM:VersionID>
      <xmpMM:RenditionClass>default</xmpMM:RenditionClass>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart14} shows the \texttt{Iptc4xmpCore}-prefix metadata. The IPTC Core Schema namespace used by the IPTC Photo Metadata standards is described briefly at \url{http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/}. A full description is available at \url{https://www.iptc.org/std/Iptc4xmpCore/1.0/specification/Iptc4xmpCore_1.0-spec-XMPSchema_8.pdf}. The \texttt{Iptc4xmpCore:CreatorContactInfo} is supposed to provide enough information to enable someone reading the file to be able to contact the creator of the content. For the purposes of the thesis I have identified the authors using the KTH\_id, since one students have completed their studies at kTH their acocunts are deactivated; hence, an e-mail address is no longer meaningful.
\begin{lstlisting}[style=myXML,
caption={The \texttt{Iptc4xmpCore}-prefix metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart14}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <Iptc4xmpCore:CreatorContactInfo rdf:parseType="Resource">
        <Iptc4xmpCore:CiEmailWork>author: u100001,secondauthor: u100002</Iptc4xmpCore:CiEmailWork>
      </Iptc4xmpCore:CreatorContactInfo>
\end{lstlisting}

\Cref{lst:pdfinfoOutputPart15} shows the \texttt{prism}-prefix metadata. The Publishing Requirements for Industry Standard Metadata (PRISM) namespace should be described at \url{http://prismstandard.org/namespaces/basic/3.0/}; however, this URL is no longer valid but the PRISM Basic Metadata Specification can be found at \url{https://www.w3.org/Submission/2020/SUBM-prism-20200910/prism-basic.html}.
\begin{lstlisting}[style=myXML,
caption={The \texttt{prism}-prefix metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart15}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
      <prism:complianceProfile>three</prism:complianceProfile>
      <prism:subtitle xml:lang="en">A subtitle in the language of the thesis</prism:subtitle>
      <prism:aggregationType>report</prism:aggregationType>
      <prism:volume>TRITA-EECS-EX</prism:volume>
      <prism:number>2022:0000</prism:number>
      <prism:pageCount>322</prism:pageCount>
      <xmpTPg:NPages>322</xmpTPg:NPages>
\end{lstlisting}

\begin{lstlisting}[style=myXML,
caption={The final part of the metadata embedded in a PDF file}, label={lst:pdfinfoOutputPart16}]
£$\ldots$ {\color{red} continuation of the above listing}£ 
    </rdf:Description>
  </rdf:RDF>
</x:xmpmeta>
\end{lstlisting}

\Needspace*{14\baselineskip}
\subsection{Extending the set of elements for theses}
\label{sec:newMetadataForTheses}
Even with all of the various schema included in XMP, there is a lot of metadata that is needed for DiVA that can not yet easily be included and embedded in XMP. Thus, for the present, the extra metadata needs to be collected and processed via some mechanism other than XMP.

For XMP, there are some specific areas that might be of interest in the future:
\begin{itemize}
  \item Adding new dc elements (§\,\ref{sec:newDCelements}) 
  \item Adding references to the metadata (§\,\ref{sec:addingReferences}), and 
  \item Adding citation data to the metadata (§\,\ref{sec:addingCitation})
\end{itemize}

\subsubsection{Adding new dc elements}
\label{sec:newDCelements}
In \Cref{tab:dublicCoreDigitalCommons} on \pageref{tab:dublicCoreDigitalCommons} we saw five elements that are perhaps worth adding, specifically:
\texttt{thesis.degree}, \texttt{thesis.degree.discipline}, \linebreak[4]\texttt{thesis.degree.grantor}, \texttt{thesis.degree.level}, and \linebreak[4] \texttt{thesis.degree.name}. It may be worth adding these to the XMP data for a thesis in the future. For some discussion of these elements, please see the discussion of EDT‐MS metadata elements in the paper by Ivanović, Ivanović, and Surla entitled ``A data model of theses and dissertations compatible with {CERIF}, {Dublin} {Core} and {EDT}‐{MS}''\cite{ivanovic_data_2012}. ETD-MS is defined in ``ETD-MS v1.1: an Interoperability Metadata Standard for Electronic Theses and Dissertations''\,\cite{hickey_pavani_suleman_2010} and available at \url{https://ndltd.org/wp-content/uploads/2021/04/etd-ms-v1.1.html}.




\subsubsection{Adding references to the metadata}
\label{sec:addingReferences}
Increasingly, there is an interest in being able to easily know what references have been cited by a thesis. Part of this interest is to be able to compute citation maps (who cites whom) and to examine the types of sources that are cited.

There are several possibilities for storing information about references. One is the element \texttt{dc.relation.references}. Another possibility is to use the \texttt{dcterms:references} element refinement of \texttt{dc:relation} as proposed in 1998 by Ann Apps of the DCMI Citations Working Group (\url{https://www.dublincore.org/groups/citation/}).

\Needspace*{9\baselineskip}
More recently, a new schema was proposed by CrossRef, see \url{https://www.crossref.org/documentation/schema-library/markup-guide-metadata-segments/references/}. Note that the focus of this work is to facilitate depositing with CrossRef the list of references used in a publication. Their set of elements is shown in \Cref{tab:crossRefElementsForCitationTagging}\footnote{\url{https://www.crossref.org/documentation/schema-library/markup-guide-metadata-segments/references/\#00178}}. Note that while the focus seems to be on journal articles, they also have a ``Metadata best practices'' website with lots of examples of metadata for different types of documents, see \url{https://www.crossref.org/documentation/principles-practices/best-practices/}.

\begin{table}[!ht]
    \caption{CrossRef elements for citation tagging}
    \label{tab:crossRefElementsForCitationTagging}
    \begin{tabular}{l}
      \textbf{Element}\\
      \hline
issn\\
journal\_title\\
author\\
volume\\
issue\\
first\_page\\
cYear\\
article\_title\\
isbn\\
series\_title\\
volume\_title\\
edition\_number\\
article\_title\\
std\_designator\\
standards\_body\_name\\
standards\_body\_acronym\\
component\_number\\
unstructured\_citation\\
doi\\
\end{tabular}
\end{table}

\subsubsection{Adding citation data to the metadata}
\label{sec:addingCitation}
There is also a desire by many to include bibliographic citation information into the XMP so that the \gls{PDF} carries this data and one does \emph{not} need to access some other source to find this information. The element \texttt{DCTERMS.bibliographicCitation} is proposed for this purpose in a document by Ann Apps, ``Guidelines for Encoding Bibliographic Citation Information in Dublin Core™ Metadata''\,\cite{Ann_Apps_2005}.

\Needspace*{3\baselineskip}
Note that to include the URN and \gls{DiVA} identifiers assigned by \gls{DiVA}, you first need to create a \gls{DiVA} entry and then use the assigned values to update the \gls{XMP} information in the \gls{PDF} file \textit{before} uploading the full text to \gls{DiVA}.

\subsubsection{Adding abstracts via the dc.description}
\label{sec:addingAbstractsInXMP}
The code shown in \Cref{lst:LuaForAbstractinXMP} can be used to add the abstracts to the XMP data. While this code works, it has \textbf{not} been added as a feature in the current template, but is a candidate for a future addition.

Note that region codes have been used for several of the languages, this is to distinguish the abstract entries from alternate titles, which also seem to end up in the same part of the XMP.

Unfortunately, it is not possible to add language alternates for keywords as \textit{hyoerxmp} does not support language alternatives for keywords. Instead, it expects all the keywords to be a single comma-separated list; see the documentation for the package for the reason behind this.

\begin{lstlisting}[language={[5.2]Lua}, caption={Using Lua it is possible to add the abstracts to the XMP data}, label=lst:LuaForAbstractinXMP]
% --- LUA BACKEND ---
\begin{luacode*}
-- This uses the global data table thesisData

-- This function will generate all the XMP metadata
function generate_xmp_data()
  local xmp_lang_map = {
    eng="en-US",
    swe="sv-SE",
    fre="fr-FR",
    spa="es-ES",
    ita="it",
    nno="nn",
    nob="nb",
    nor="no",
    ger="de-DE",
    dan="da",
    dut="nl",
    est="et",
    ukr="uk",
    lat="la",
    fin="fi",
    ice="is",
    yid="yi",
    lit="lt",
    pol="pl",
    por="pt",
    per="fa",
    rum="ro",
    hin="hi",
    hun="hu",
    bul="bg",
    alb="sq",
    cat="ca",
    chi="zh",
    ara="ar",
    bel="be",
    rus="ru",
    vie="vi",
    scc="sr", -- deprecated B code
    cze="cs",
    gre="el",
    ara="ar",
    tur="tr",
    lav="lv",
    jpn="ja",
    kur="ku",
    ckb="ku",
    heb="he",
    slo="sk",
    
  }

  -- Iterate through the abstracts
  if thesisData.abstracts then
    for lang_code, content in pairs(thesisData.abstracts) do
      local xmp_tag = xmp_lang_map[lang_code]
      if xmp_tag then
        -- Call the LaTeX helper with the corrected key
        tex.sprint("\\StoreXMPAbstract{" .. xmp_tag .. "}{" .. content .. "}")
      end
    end
  end
\end{luacode*}
% --- LATEX FRONTEND ---

% Corrected helper commands using the right keys for hyperxmp
\newcommand{\StoreXMPAbstract}[2]{%
  % Use 'pdfsubject' for the abstract/description
  \XMPLangAlt{#1}{pdfsubject={#2}}%
}

% This command will trigger the process in the preamble
%\directlua{generate_xmp_data()}
% add this commend before the end of the document.
\end{lstlisting}

\section{Some enhancements}
\label{sec:someEhnahncements}
Enhancements were made to the template and supporting programs to avoid the user having to enter information on the command line and to make the information more available for a future DiVA entry. The enhancements described in \Cref{sec:betterSupportForMathInAbstracts} are to better support mathematical expressions in abstracts. \Cref{sec:AcronymsInAbstracts} describes support for acronyms in abstracts. \Cref{sec:URLSinAbstracts} describes the state of support for URLs in abstracts.

\subsection{Enhancements to template and supporting programs}
\label{sec:enhancementsToTemplate}
Add better support for the subject area (or areas in the case of a student doing both a Civ. Ing. Degree and a Master’s degree). 
\generalExpl{Not relevant for the third-cycle template.}

\subsection{Better support for mathematical expressions in abstracts}
\label{sec:betterSupportForMathInAbstracts}
\LaTeX~in the abstracts is passed through to the pseudo JSON in the “For DIVA” text at the end of the thesis. When preparing this text for Cortina calendar entries or for the announcement in the Canvas course room (and for the calendar event in the course room) some simple \LaTeX~commands are converted to \gls{HTML}. As few abstracts (in the many abstracts that I looked at in DiVA) have equations I have only done these few transformations. However, if there were to be more use of equations, then there is probably a need to support them for the different platforms (Cortina (see Appendix~\ref{sec:BetterSupportforMathinCortina}), DiVA (see Appendix~\ref{sec:SupportForMathematicsInDiVA}), and Canvas (see Appendix~\ref{sec:betterSupportMathInCortinaAndCourseCalendar})).


\subsubsection{Better support for mathematics in Canvas course announcement and course calendar}
\label{sec:betterSupportMathInCortinaAndCourseCalendar}
As of 2021-06-18, MathJAX and URLs are now supported in the Canvas course room announcement and calendar.
Using the Overleaf project: \url{https://www.overleaf.com/read/qsyddnhhvkgr} to provide a test source document. The results can be seen in \Cref{fig:equationsInAnnouncement}. These results and the results shown in Appendix~\ref{sec:BetterSupportforMathinCortina} were generated using the commands in \Cref{lst:jsonToCalendar3}.
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/announcement_with_equation.png}}
  \end{center}
  \caption{Examples of equations in an announcement}
  \label{fig:equationsInAnnouncement}
\end{figure}
\FloatBarrier
\Needspace*{8\baselineskip}
\begin{lstlisting}[language={bash}, caption={Commands to produce the JSON and make the calendar entries and announcement}, label=lst:jsonToCalendar3]
./extract_pseudo_JSON-from_PDF.py --pdf abstracts_with_equations_in_them.pdf --json eqtest.json
./JSON_to_calendar.py -c 11 --config config-test.json --json eqtest.json
\end{lstlisting}

\FloatBarrier

Note that block/display math are displayed in the Canvas summary for the announcements cause Canvas to stop summarizing the abstract. The cause for this is not yet known, but has been reported to e-learning ([\#ID:KTH-INC-3677258\#]) and I have blogged about it in the Canvas Community. An example of the equation being displayed in the summary of the announcement is shown in \Cref{fig:announcementSummary}. The announcement is shown in \Cref{fig:announcementWithEquation} while \Cref{lst:HTMLannouncement} shows the \gls{HTML} for this announcement.

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/Announcement_summary.png}}
  \end{center}
  \caption{Announcement summary}
  \label{fig:announcementSummary}
\end{figure}
\FloatBarrier

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/announcement_with_equation.png}}
  \end{center}
  \caption{Announcement with equation}
  \label{fig:announcementWithEquation}
\end{figure}
\FloatBarrier
\Needspace*{18\baselineskip}
\begin{lstlisting}[language={HTML}, caption={HTML for the announcement}, label=lst:HTMLannouncement]
<h2 lang="en">Abstract</h2>
<p>All theses at KTH are required to have an abstract in both <i>English</i> and <i>Swedish</i>.</p>
<p>Exchange students many want to include one or more abstracts in the language(s) used in their home institutions to avoid the need to write another thesis when returning to their home institution.</p>
<p><span class="math-tex">\(\pi \cdot r\)</span> or <span class="math-tex">\[ \int_{a}^{b} x^2 \,dx \]</span></p>
<p>Some more text: A<sup>*</sup>, A<sup>&reg;</sup>, and A&trade;.</p>
<p><strong>Keywords:</strong> <em>Canvas Learning Management System, Docker containers, Performance tuning </em></p>
\end{lstlisting}


Via XXXXX at IT-support, I raised the question about why the block equations were appearing in the summary of the announcement.

The response from Instructure support regarding the block equations showing up in the summary of the announcements was\footnote{Note that the URLs have been added in parenthesis.}:
\begin{quote}
Thank you for reaching back out.  I did some testing on this and I have a few things to point out and some follow up questions.

First off, the syntax of the block equation isn't the officially supported format.  The inline equation is correct with the \textbackslash(...\textbackslash) delimiters, but the block equation should be formatted with dollar signs, as \$\$...\$\$.  I see the square bracket delimiters \textbackslash[...\textbackslash] are working currently, but this is not the officially supported format and may not always work.  Information on this can be found in these release notes (\url{https://community.canvaslms.com/t5/Canvas-Releases/Canvas-Release-Notes-2021-02-20/ta-p/434781\#toc-hId-698876024}).

Regardless of that, I wanted to get clarification on the issue at hand.  When I open the announcement, I see both the inline and block equations, but I see only the block equation when viewing it on the main Announcements page.  Is this specifically what you're reporting?  (sandbox screenshot for reference (\url{https://share.getcloudapp.com/jkuPOKRD}))  If so, this is because the Announcements page only shows a snippet of the text, so an inline equation beyond the point where the text is truncated isn't treated any differently than the rest of the text not shown.  It is interesting that Canvas decides to show the block equation in this view.  Having that removed from the preview would best be submitted as a feature request (\url{https://community.canvaslms.com/t5/forums/postpage/board-id/ideas/search-before-post-mode/true} ).

If the issues you're reporting are when the full announcement is open, I'm not seeing the same behavior on this end.  If that's the case, can you provide a screenshot of what you're seeing?  And does the behavior persist in a different browser?

Let me know if I've misinterpreted anything or if there are any other questions as well.  We'll be happy to help.  Thanks and have a great day!"
\end{quote}

The response from someone at Instructure shows that Instructure got the same behavior from the block equations in the snippets of the announcements.  A screenshot of this behavior is shown in \Cref{fig:screenSHotOfBlockEquation}. However, their solution for this is to suggest that we submit a feature request. 

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/block_equation_in_Canvas.png}}
  \end{center}
  \caption{The screenshot mentioned above}
  \label{fig:screenSHotOfBlockEquation}
\end{figure}
\FloatBarrier



\subsubsection{Better support for mathematics in Cortina}
\label{sec:BetterSupportforMathinCortina}

YYYYYY\footnote{An employee who wished to remain unnamed.} indicated that CORTINA supports mathematical expressions using a class name of “math-tex” and gave an example:
%% <span class=\"math-tex\">\\(x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}\\)</span>
\begin{quote}
$<$span class=\textbackslash"math-tex\textbackslash"$>$\textbackslash\textbackslash(x = {-b \textbackslash\textbackslash pm \textbackslash\textbackslash sqrt\{b\^{}2-4ac\} \textbackslash\textbackslash over 2a}\textbackslash\textbackslash)$<$/span$>$
\end{quote}


\noindent He also noted that Cortina does not allow images in paragraphs, so the solutions for Cortina and DiVA have to be different.

An important note about the above example is that \textbackslash over is deprecated and one should use \textbackslash frac{}{} or one of its variance instead; hence, I used this version of the equation in my source \LaTeX~file.

\Cref{fig:cortinaExample1} shows the entry in the Cortina calendar, while \Cref{fig:cortinaExample2} and \Cref{fig:cortinaExample3} show zoomed in views of the equations.
\clearpage
\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=0.6\textwidth]{README_notes/README-examiner-figures/Cortina_exaample1.png}}
  \end{center}
  \caption{Equations in Cortina calendar entry}
  \label{fig:cortinaExample1}
\end{figure}
\FloatBarrier
\clearpage

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/cortina-eqn-zoom1.png}}
  \end{center}
  \caption{Zoom in on part of the Cortina calendar entry}
  \label{fig:cortinaExample2}
\end{figure}
\FloatBarrier
\clearpage

\begin{figure}[!ht]
  \begin{center}
    \fbox{\includegraphics[width=1\textwidth]{README_notes/README-examiner-figures/cortina-eqn-zoom2.png}}
  \end{center}
  \caption{Zoom in on the lower part of the Cortina calendar entry}
  \label{fig:cortinaExample3}
\end{figure}
\FloatBarrier
 

\subsubsection{Support for mathematics in DiVA}
\label{sec:SupportForMathematicsInDiVA}
In contrast to Canvas and Cortina, DiVA uses pictures (although these can have a \LaTeX~expression as an “alt” description of the image contents).
The code does not (yet) support the addition of equations to the DiVA entry of the abstracts.
The current DiVA user interface seems to strip out the math-tex classes, \ie 

% <span class='math-tex'>\[ \int_{a}^{b} x^2 \,dx \]</span> 
\begin{quote}
$<$span class=\textbackslash"math-tex\textbackslash"$>$\textbackslash [ \textbackslash int\_\{a\}\^{}\{b\} x\^{}  \textbackslash ,dx \textbackslash ] $<$/span$>$
\end{quote}

\noindent becomes simply:
% \[ \int_{a}^{b} x^2 \,dx \]
\begin{quote}
\textbackslash [ \textbackslash int\_\{a\}\^{}\{b\} x\^{}2  \textbackslash ,dx \textbackslash ]
\end{quote}
\noindent However, I do not know what happens when this is later displayed by DiVA, \ie whether it will appear as an equation or not.

Fortunately, one can use the picture support as shown in the example below to generate \texttt{\textbackslash widehat\{Err\}} over Err:
\begin{quote}
<img src="http://www.diva-portal.org/cgi-bin/mimetex.cgi?\%5Cwidehat\%7BErr\%7D" data-classname="equation" data-title="" />
\end{quote}
\warningExpl{This is an area where this likey to be a change for the new Cora-based DiVA.}

\subsection{Acronyms in abstracts}
\label{sec:AcronymsInAbstracts}

As students may use acronyms in abstracts, there is support for the commands: \textbackslash gls{}, \textbackslash glspl{}, \textbackslash Gls{}, \textbackslash Glspl{}, \textbackslash acrlong{}, \textbackslash acrshort{}, and \textbackslash acrfull{}. There is also an optional argument to the extraction program to specify the name of the file with definitions of acronyms using the \texttt{\textbackslash newacronyms\{label\}\{acronym\}\{phrase\}} form of definitions. This optional argument is shown in \Cref{lst:specifyingAcronymsFile}. Note that expanding acronyms are handled independently for the abstracts, so that they are spelled out on first use in each abstract. Note also that there is no support for multiple languages for 
    the phrase that is used, \ie the expansion simply uses the phrase defined in the \texttt{\textbackslash newacronyms}/*/ definition.
\Needspace*{4\baselineskip}
\begin{lstlisting}[language={bash}, caption={Specifying acronyms file}, label=lst:specifyingAcronymsFile]
./extract_pseudo_JSON-from_PDF.py --pdf xxxx.pdf --json xxxx.json --acronyms acronyms.tex
\end{lstlisting}


Additionally, the commands (from \texttt{defines.tex}) are supported in abstracts: \textbackslash ie, \textbackslash eg, \textbackslash etc, \textbackslash etal, \textbackslash first, \textbackslash second, \textbackslash third, \ldots . Now that all the acronyms are spelled out, there is no problem with them when making a calendar entry or \gls{MODS} file.

\subsection{URLs in abstracts}
\label{sec:URLSinAbstracts}
Currently, URLs in abstracts are supported in Canvas course room announcements and the Canvas calendar, but \textit{not} in the Cortina calendar – where the URL is simply shown as text.


\section{Future work and work in progress}
\label{sec:futurework}
There are several areas where the template, supporting programs, and documentation can be enhanced. The programs and notebooks can be found in \fname{https://github.com/gqmaguirejr/Canvas-tools} or\linebreak[4]
\fname{https://github.com/gqmaguirejr/E-learning}.

\subsection{Automating creation of custom\_configuration.tex file}
\label{sec:automatingConfiguration}

To help collect information for the \fname{custom\_configuration.tex} file, I have written some programs.

One of these programs is \fname{extract\_data\_from\_ISP.py}. It extracts some information from a PDF file of the student's \gls{ISP} and generates a JSON file. This is in an early stage, but it shows what can be done to extract data from a \gls{PDF} file of an \gls{ISP}.

The program \fname{ISP\_JSON\_to\_configuration\_info.py} takes the JSON produced by \fname{extract\_data\_from\_ISP.py} and produces much of the information for the \fname{custom\_configuration.tex} file (with respect to the information available at the time the writing of the thesis starts).

To get additional information for the author and supervisors, the program uses information from either a Canvas course room \textbf{or} requires Canvas administrative rights to be able to look up the user's KTHID using the Canvas \gls{API} and the user's email address. In addition, the program utilizes the KTH Profile \gls{API} to obtain further information about each person's organization, given an email address (if they are affiliated with KTH).

\warningExpl{This program requires that you have a KTH API key.}

\subsection{Automating creation of list of publications}
\label{sec:automatingPublicationsList}

The Jupyter notebook
\fname{Compute\_publications\_list\_from\_DiVA-Notebook-20250907.ipynb} uses data from \fname{fordiva.json} and \fname{references.bib} files to look up the student's publications in DiVA and generate the LaTeX that might be used in a list of publications in a third-cycle thesis.

This could be used for the ``List of Publications'' for a compilation thesis or for a list of papers and contributions in a monograph thesis. Note that the author will need to edit the resulting list to indicate which publications are included in a compilation thesis and which papers have not been included. The author may also need to move items from one category to another.

\subsection{Helping students find the DiVA IDs of previous publications}
\label{sec:getdivaIDs}
The Jupyter notebook
\fname{citations-to-DiVA-Notebook-20250811-all.ipynb} use data from the \fname{citedtags.bib} and \fname{fordiva.json} files look up DiVA IDs for these publications.

This information is valuable when the student is entering the metadata for their thesis in DIVA.


\subsection{JSON\_to\_Cora\_DiVA}
\label{sec:JSONtoCoraDiVA}

\warningExpl{Implemented JSON\_to\_Cora\_DiVA remains as future work.}
 

\subsection{Better exploiting unicode}
\label{sec:betterExploitingUnicode}

The current design store the \LaTeX{} commands in abstract \textit{without} expanding the \LaTeX{} macros This makes it possible to post-process these commands and make content that is suited for making announcements of the oral presentation, making calendar entries for this presentation, and generating the abstracts for the \gls{MODS} file for \gls{DiVA}. However,  if one wants to take the full leap to unicode, this is perhaps not a good design choice - as it requires that all of the processing that \LaTeX{} could do of the unicode is not done and that the programs that extract the unexpanded contents will have to keep changing to keep up with want \LaTeX{} macros are used. 

There might seem to be two alternatives:
\begin{enumerate}
    \item Keep modifying the extraction programs as needed or
    \item Only allow the use of \LaTeX{} macros that expand into unicode; thus, not allowing environments and commands such as \textbackslash textbf\{\}, \textbackslash textif\{\}, etc. that do not translate directly into characters that can be written in unicode.
\end{enumerate}

In the second alternative, one might think about translating the string inside a \textbackslash textbf\{\} into unicode characters in the Bold, Latin, uppercase \& lowercase range, \ie U+1D400 to U+1D433 (there is a similar transformation possible for Greek). The characters are defined in the \textsc{unicode-math} package. Logically, this would be similar to redefining \textbackslash textbf\{\} as \textbackslash mathtextbf\{\}\footnote{\textbackslash mathtextbf\{\} cannot be used directly as it only works in math mode.}.  

For \texttt{\textbackslash textit\{\}} one could utilize the Italic, Latin, uppercase and lowercase range, \ie U+1D434 to U+1D467 (there is a similar transformation possible for Greek). Similar transformations are possible for \textbackslash texttt\{\}
using Typewriter, Latin, uppercase \& lowercase and for \textbackslash textsc\{\}

Additionally, there is a  Bold italic, Latin, uppercase \& lowercase range, \ie U+1D468 to U+1D49B.

However, the above two alternatives are not actual alternatives -- as the \LaTeX{} commands do not get expanded at all. One possibility is to utilize the expanded output in the DiVA metadata for abstracts. Also note that these character ranges are for mathematics (hence, they use mathematical glyphs, \ie the block Mathematical Alphanumeric Symbols).

This suggests a third alternative: have all of the contents (for titles, subtitles, keywords, and abstracts) be directly in unicode (or as characters specified as described in section ``Configure the title, subtitle, alternate title, and alternate subtitle'' in the file \texttt{README\_3rd\_cycle\_author.tex}). See also \Cref{sec:generatingPlainText}. Perhaps some limited use of some macros can be allowed, as long as they can easily be processed into \gls{HTML} with unicode contents.

This third alternative does \textbf{not} address the issue of equations. As noted earlier, this will depend on whether the new Cora-based DiVA will support MathJax or similar (see \Cref{sec:betterMathsupportinDiVA}). Although perhaps just leaving the equations in place is the correct solution. However, limiting abstracts to unicode text with possible \LaTeX{} equations seems to be too limited. Therefore, some subset of \LaTeX{} has to be allowed, basically limited to what can be easily transformed to \gls{HTML}, \ie the \textit{current} solution!

\warningExpl{One can split the text into math and text blocks - as done in my LaTeXtoHTML notebook.}

\subsection{Better support for mathematical expressions in DiVA}
\label{sec:betterMathsupportinDiVA}
With the future introduction of the new Cora-based DiVA, there may be better support for mathematical expressions via MathJax. This should enable the \LaTeX{} expressions to just be passed through to \gls{DiVA} as MathJax runs in the user's browser.
\warningExpl{This does raise a question of what happens to these expressions in titles and subtitles when they have to be printed on the student's diploma!}


\subsection{Further automation to generate additional parts of the custom\_configuration.tex file}
\label{sec:furtherAutomationForConfig}

There is an open question of the extent to which the National Subject Category information, the UN's Sustainable Development Goals (SDGs) list, and English and Swedish keywords can be automatically extracted or guessed (perhaps with the help of a large language model).
\warningExpl{This needs further research and prototyping. Note that my earlier experiments with detecting national subject category information for first- and second-cycle theses using the University of Linköping's tool yielded good correlation with the manually assigned codes and the top 5 codes generated by the tool. The tool performed badly on theses written in Swedish; I suspect that this is because it had limited training data for such theses.}

\clearpage

\ifinswedish
\printglossary[style=mylong, type=\acronymtype, title={Lista över akronymer
och förkortningar}]
\else
%\printglossary[style=mylong, type=\acronymtype, title={List of Acronyms and abbreviations}]
\printnoidxglossaries
\fi
\clearpage

% --- print the bibliography ---
% Print the bibliography (and make it appear in the table of contents)

% Specify the title of the references page
% This will work for both BibLaTeX and BibTeX.
% It works for BibTeX because the thesis format is basically that of a Report.
\renewcommand{\bibname}{References}

\ifbiblatex
    %\typeout{Biblatex current language is \currentlang}

    \printbibliography[heading=bibintoc, title={References}]
\else
   
    \phantomsection  % make it include a hyperref - see https://tex.stackexchange.com/a/98995
    \addcontentsline{toc}{chapter}{References}
    \bibliography{references}
\fi

\end{document}

